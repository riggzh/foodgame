function init(e){var t=!1,a=!1;window.location.search&&("0d9753e2fe5a15db2668f70016e565ca7d717c67278ea6c689881ac4"==lcode(window.location.search)&&(t=!0),"12efa26026978758fbbbd57a70747902dba7f1a434d8dbb8cde98373"==lcode(window.location.search)&&(a=!0));var i=generateData(e,t);initRecipeTable(i,t),initChefTable(i),initKitchenwareTable(i),initQuestTable(i),(t||a)&&(initCalTables(e,i),$(".nav-tabs li").removeClass("hidden")),initInfo(i),$(".loading").addClass("hidden"),$(".main-function").removeClass("hidden")}function initRecipeTable(e,t){var a=[{data:"recipeId"},{data:"name"},{data:{_:"rarity",display:"rarityDisp"}},{data:"stirfry"},{data:"boil"},{data:"cut"},{data:"fry"},{data:"roast"},{data:"steam"},{data:{_:"ingredientsVal",display:"ingredientsDisp"}},{data:"price"},{data:{_:"time",display:"timeDisp"}},{data:"limit"},{data:"totalPrice"},{data:{_:"totalTime",display:"totalTimeDisp"}},{data:"efficiency"},{data:"ingredientsEff"},{data:"origin"},{data:"unlock"},{data:"guestsDisp"},{data:{_:"levelGuestsVal",display:"levelGuestsDisp"}},{data:"godRune"},{data:"quality"}];for(var i in e.chefs)$("#chk-recipe-show-chef").append("<option value='"+i+"'>"+e.chefs[i].name+"</option>"),$("#recipe-table thead tr").append("<th>"+e.chefs[i].name+"</th>").append("<th>效率</th>"),a.push({data:{_:"chefs."+i+".qualityVal",display:"chefs."+i+".qualityDisp"}}),a.push({data:"chefs."+i+".efficiency"});var c=$("#recipe-table").DataTable({data:e.recipes,columns:a,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"第 _PAGE_ 页 共 _PAGES_ 页 _TOTAL_ 个菜谱",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 个菜谱中过滤)"},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>"});$("#pane-recipes div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="菜名 材料 贵客 符文"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,t,a){if(e.nTable!=document.getElementById("recipe-table"))return!0;var i=$("#chk-recipe-rarity-1").prop("checked"),c=$("#chk-recipe-rarity-2").prop("checked"),l=$("#chk-recipe-rarity-3").prop("checked"),r=$("#chk-recipe-rarity-4").prop("checked"),s=$("#chk-recipe-rarity-5").prop("checked"),n=Math.floor(t[2])||0;return!!(i&&1==n||c&&2==n||l&&3==n||r&&4==n||s&&5==n)}),$.fn.dataTableExt.afnFiltering.push(function(e,t,a){return e.nTable!=document.getElementById("recipe-table")||!!($("#chk-recipe-skill-stirfry").prop("checked")&&(Math.floor(t[3])||0)>0||$("#chk-recipe-skill-boil").prop("checked")&&(Math.floor(t[4])||0)>0||$("#chk-recipe-skill-cut").prop("checked")&&(Math.floor(t[5])||0)>0||$("#chk-recipe-skill-fry").prop("checked")&&(Math.floor(t[6])||0)>0||$("#chk-recipe-skill-roast").prop("checked")&&(Math.floor(t[7])||0)>0||$("#chk-recipe-skill-steam").prop("checked")&&(Math.floor(t[8])||0)>0)}),$.fn.dataTableExt.afnFiltering.push(function(e,t,a){if(e.nTable!=document.getElementById("recipe-table"))return!0;var i=Math.floor($("#input-recipe-price").val()),c=Math.floor(t[10])||0;return""==$("#input-recipe-price").val()||i<c}),$.fn.dataTableExt.afnFiltering.push(function(e,t,a){if(e.nTable!=document.getElementById("recipe-table"))return!0;var i=$("#chk-recipe-guest").prop("checked"),c=t[19];return!!(!i||i&&c)}),$.fn.dataTableExt.afnFiltering.push(function(e,t,a){if(e.nTable!=document.getElementById("recipe-table"))return!0;for(var i=$("#input-recipe-guest-rune").val(),c=[20,21],l=0,r=c.length;l<r;l++)if(t[c[l]].indexOf(i)!==-1)return!0;return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,t,a){if(e.nTable!=document.getElementById("recipe-table"))return!0;for(var i=$("#pane-recipes .search-box input").val(),c=[0,1,9,19],l=0,r=c.length;l<r;l++)if(t[c[l]].indexOf(i)!==-1)return!0;return!1}),$("#chk-recipe-show-chef").selectpicker().on("changed.bs.select",function(){initRecipeShow(c,e,t)}),$(".chk-recipe-show").click(function(){initRecipeShow(c,e,t)}),$("#chk-recipe-show-all").click(function(){$(".btn:not(.hidden) .chk-recipe-show:checked").length==$(".btn:not(.hidden) .chk-recipe-show").length?$(".btn:not(.hidden) .chk-recipe-show").prop("checked",!1):$(".btn:not(.hidden) .chk-recipe-show").prop("checked",!0),initRecipeShow(c,e,t)}),$('.chk-recipe-rarity input[type="checkbox"]').click(function(){c.draw()}),$(".chk-recipe-skill").click(function(){$(this).prop("checked")&&$("#chk-recipe-single-skill").prop("checked")&&$(".chk-recipe-skill").not(this).prop("checked",!1),c.draw()}),$("#chk-recipe-single-skill").change(function(){$(this).prop("checked")&&$(".chk-recipe-skill:checked").length>1&&($(".chk-recipe-skill").prop("checked",!1),c.draw())}),$("#chk-recipe-skill-all").click(function(){$("#chk-recipe-single-skill").prop("checked")&&$("#chk-recipe-single-skill").bootstrapToggle("off"),$(".chk-recipe-skill").prop("checked",!0),c.draw()}),$("#input-recipe-price").keyup(function(){c.draw()}),$("#input-recipe-guest-rune").keyup(function(){$("#chk-recipe-show-level-guest").prop("checked")||($("#chk-recipe-show-level-guest").prop("checked",!0),initRecipeShow(c,e,t)),c.draw()}),$("#chk-recipe-guest").click(function(){c.draw()}),$("#pane-recipes .search-box input").keyup(function(){c.draw()}),t&&($("#chk-recipe-show-origin").prop("checked",!1),$("#chk-recipe-show-unlock").prop("checked",!1),$("#chk-recipe-show-quality").prop("checked",!0).parent(".btn").removeClass("hidden")),initRecipeShow(c,e,t)}function initChefTable(e){var t=[{data:{_:"chefId",display:"chefIdDisp"}},{data:"name"},{data:{_:"rarity",display:"rarityDisp"}},{data:"stirfry"},{data:"boil"},{data:"cut"},{data:"fry"},{data:"roast"},{data:"steam"},{data:{_:"specialSkillVal",display:"specialSkillDisp"}},{data:"meat"},{data:"wheat"},{data:"veg"},{data:"fish"},{data:"sex"},{data:"origin"}];for(var a in e.recipes)$("#chk-chef-show-recipe").append("<option value='"+a+"'>"+e.recipes[a].name+"</option>"),$("#chef-table thead tr").append("<th>"+e.recipes[a].name+"</th>"),t.push({data:{_:"recipes."+a+".qualityVal",display:"recipes."+a+".qualityDisp"}});var i=$("#chef-table").DataTable({data:e.chefs,columns:t,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"第 _PAGE_ 页 共 _PAGES_ 页 _TOTAL_ 个厨师",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 个厨师中过滤)"},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>"});$("#pane-chefs div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="名字 技能 来源"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,t,a){if(e.nTable!=document.getElementById("chef-table"))return!0;var i=$("#chk-chef-rarity-1").prop("checked"),c=$("#chk-chef-rarity-2").prop("checked"),l=$("#chk-chef-rarity-3").prop("checked"),r=$("#chk-chef-rarity-4").prop("checked"),s=$("#chk-chef-rarity-5").prop("checked"),n=Math.floor(t[2])||0;return!!(i&&1==n||c&&2==n||l&&3==n||r&&4==n||s&&5==n)}),$.fn.dataTableExt.afnFiltering.push(function(e,t,a){if(e.nTable!=document.getElementById("chef-table"))return!0;var i=Math.floor($("#input-chef-stirfry").val()),c=Math.floor(t[3])||0,l=Math.floor($("#input-chef-boil").val()),r=Math.floor(t[4])||0,s=Math.floor($("#input-chef-cut").val()),n=Math.floor(t[5])||0,o=Math.floor($("#input-chef-fry").val()),d=Math.floor(t[6])||0,h=Math.floor($("#input-chef-roast").val()),p=Math.floor(t[7])||0,u=Math.floor($("#input-chef-steam").val()),f=Math.floor(t[8])||0;return i<=c&&l<=r&&s<=n&&o<=d&&h<=p&&u<=f}),$.fn.dataTableExt.afnFiltering.push(function(e,t,a){if(e.nTable!=document.getElementById("chef-table"))return!0;var i=$("#chk-chef-sex-male").prop("checked"),c=$("#chk-chef-sex-female").prop("checked"),l=t[14];return!!(i&&"男"==l||c&&"女"==l)}),$.fn.dataTableExt.afnFiltering.push(function(e,t,a){if(e.nTable!=document.getElementById("chef-table"))return!0;for(var i=$("#pane-chefs .search-box input").val(),c=[1,9,15],l=0,r=c.length;l<r;l++)if(t[c[l]].indexOf(i)!==-1)return!0;return!1}),$("#chk-chef-show-recipe").selectpicker().on("changed.bs.select",function(){initChefShow(i,e)}),$(".chk-chef-show").click(function(){initChefShow(i,e)}),$("#chk-chef-show-all").click(function(){$(".chk-chef-show:checked").length==$(".chk-chef-show").length?$(".chk-chef-show").prop("checked",!1):$(".chk-chef-show").prop("checked",!0),initChefShow(i,e)}),$('.chk-chef-rarity input[type="checkbox"]').click(function(){i.draw()}),$(".input-chef-skill").keyup(function(){i.draw()}),$("#btn-chef-skill-clear").click(function(){$(".input-chef-skill").val(""),i.draw()}),$('.chk-chef-sex input[type="checkbox"]').click(function(){i.draw()}),$("#pane-chefs .search-box input").keyup(function(){i.draw()}),initChefShow(i,e)}function initKitchenwareTable(e){var t=[{data:"kitchenwareId"},{data:"name"},{data:{_:"rarity",display:"rarityDisp"}},{data:{_:"skillVal",display:"skillDisp"}},{data:"origin"}],a=$("#kitchenware-table").DataTable({data:e.kitchenware,columns:t,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"第 _PAGE_ 页 共 _PAGES_ 页 _TOTAL_ 个厨具",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 个厨具中过滤)"},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>"});$("#pane-kitchenware div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="名字 技能 来源"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,t,a){if(e.nTable!=document.getElementById("kitchenware-table"))return!0;var i=t[3];return!!($("#chk-kitchenware-skill-stirfry-price").prop("checked")&&i.indexOf("炒类料理")>=0||$("#chk-kitchenware-skill-boil-price").prop("checked")&&i.indexOf("煮类料理")>=0||$("#chk-kitchenware-skill-cut-price").prop("checked")&&i.indexOf("切类料理")>=0||$("#chk-kitchenware-skill-fry-price").prop("checked")&&i.indexOf("炸类料理")>=0||$("#chk-kitchenware-skill-roast-price").prop("checked")&&i.indexOf("烤类料理")>=0||$("#chk-kitchenware-skill-steam-price").prop("checked")&&i.indexOf("蒸类料理")>=0||$("#chk-kitchenware-skill-meet-price").prop("checked")&&i.indexOf("肉类料理")>=0||$("#chk-kitchenware-skill-wheat-price").prop("checked")&&i.indexOf("面类料理")>=0||$("#chk-kitchenware-skill-veg-price").prop("checked")&&i.indexOf("蔬菜料理")>=0||$("#chk-kitchenware-skill-fish-price").prop("checked")&&i.indexOf("水产料理")>=0||$("#chk-kitchenware-skill-sell-price").prop("checked")&&i.indexOf("金币获得")>=0||$("#chk-kitchenware-skill-stirfry-skill").prop("checked")&&i.indexOf("炒技法")>=0||$("#chk-kitchenware-skill-boil-skill").prop("checked")&&i.indexOf("煮技法")>=0||$("#chk-kitchenware-skill-cut-skill").prop("checked")&&i.indexOf("切技法")>=0||$("#chk-kitchenware-skill-fry-skill").prop("checked")&&i.indexOf("炸技法")>=0||$("#chk-kitchenware-skill-roast-skill").prop("checked")&&i.indexOf("烤技法")>=0||$("#chk-kitchenware-skill-steam-skill").prop("checked")&&i.indexOf("蒸技法")>=0||$("#chk-kitchenware-skill-all-skill").prop("checked")&&i.indexOf("全技法")>=0||$("#chk-kitchenware-skill-guest").prop("checked")&&i.indexOf("稀有客人")>=0||$("#chk-kitchenware-skill-time").prop("checked")&&i.indexOf("开业时间")>=0||$("#chk-kitchenware-skill-ingredient-get").prop("checked")&&i.indexOf("素材获得")>=0||$("#chk-kitchenware-skill-meet-skill").prop("checked")&&i.indexOf("肉类采集")>=0||$("#chk-kitchenware-skill-wheat-skill").prop("checked")&&i.indexOf("面类采集")>=0||$("#chk-kitchenware-skill-veg-skill").prop("checked")&&i.indexOf("蔬菜采集")>=0||$("#chk-kitchenware-skill-fish-skill").prop("checked")&&i.indexOf("水产采集")>=0||$("#chk-kitchenware-skill-ingredient-skill").prop("checked")&&i.indexOf("全采集")>=0)}),$.fn.dataTableExt.afnFiltering.push(function(e,t,a){if(e.nTable!=document.getElementById("kitchenware-table"))return!0;for(var i=$("#pane-kitchenware .search-box input").val(),c=[1,3,4],l=0,r=c.length;l<r;l++)if(t[c[l]].indexOf(i)!==-1)return!0;return!1}),$(".chk-kitchenware-show").click(function(){initKitchenwareShow(a)}),$("#chk-kitchenware-show-all").click(function(){$(".chk-kitchenware-show:checked").length==$(".chk-kitchenware-show").length?$(".chk-kitchenware-show").prop("checked",!1):$(".chk-kitchenware-show").prop("checked",!0),initKitchenwareShow(a)}),$(".chk-kitchenware-skill").click(function(){$(this).prop("checked")&&$("#chk-kitchenware-single-skill").prop("checked")&&$(".chk-kitchenware-skill").not(this).prop("checked",!1),a.draw()}),$("#chk-kitchenware-single-skill").change(function(){$(this).prop("checked")&&$(".chk-kitchenware-skill:checked").length>1&&($(".chk-kitchenware-skill").prop("checked",!1),a.draw())}),$("#chk-kitchenware-skill-all").click(function(){$("#chk-kitchenware-single-skill").prop("checked")&&$("#chk-kitchenware-single-skill").bootstrapToggle("off"),$(".chk-kitchenware-skill").prop("checked",!0),a.draw()}),$("#pane-kitchenware .search-box input").keyup(function(){a.draw()}),initKitchenwareShow(a)}function initQuestTable(e){var t=[{data:"questId"},{data:"goal"},{data:{_:"rewardsVal",display:"rewardsDisp"}}],a=getQuestsData(e.quests,$("#select-quest-type").val()),i=$("#quest-table").DataTable({data:a,columns:t,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"第 _PAGE_ 页 共 _PAGES_ 页 _TOTAL_ 个任务",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 个任务中过滤)"},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>"});$("#pane-quest div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="编号 任务 奖励"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,t,a){if(e.nTable!=document.getElementById("quest-table"))return!0;for(var i=$("#pane-quest .search-box input").val(),c=[0,1,2],l=0,r=c.length;l<r;l++)if(t[c[l]].indexOf(i)!==-1)return!0;return!1}),$("#pane-quest .search-box input").keyup(function(){i.draw()}),$("#select-quest-type").change(function(){var t=getQuestsData(e.quests,$(this).val());i.clear().rows.add(t).draw()})}function initCalTables(e,t){initCalRules(t),initCalRecipesTable(t),initCalChefsTable(t),initCalIngredientsTable(t),initCalResultsTable(t),initCalSelfSelect(t),$.fn.dataTable.ext.order["dom-selected"]=function(e,t){return this.api().column(t,{order:"index"}).nodes().map(function(e,t){return $(e).parent("tr").hasClass("selected")?"1":"0"})},$("#pane-cal-results-common").remove()}function initCalRules(e){var t=new Worker("js/cal.js");t.onmessage=function(e){$("#select-cal-rule").append(e.data)},t.postMessage({mode:"get-rules-options"});var a;$("#btn-cal-rule-load").click(function(){var t=Math.floor($("#select-cal-rule").val());return t?($("#input-rule-id").val(t),$("#btn-cal-rule-load").prop("disabled",!0),$("#pane-cal-rules .cal-results-progress").removeClass("hidden"),"undefined"!=typeof a&&(a.terminate(),a=void 0),a=new Worker("js/cal.js"),a.onmessage=function(a){$("#cal-recipes-table").DataTable().clear().rows.add(a.data.recipes).draw(!1),$("#cal-recipes-table").DataTable().rows().select(),$("#cal-chefs-table").DataTable().clear().rows.add(a.data.chefs).draw(!1),$("#cal-chefs-table").DataTable().rows().select(),$("#cal-ingredients-table").DataTable().clear().rows.add(a.data.ingredients).draw(!1),$("#cal-ingredients-table").DataTable().rows().select();var i,c=getChefsOptions(a.data.chefs),l=getRecipesOptions(a.data.recipes),r=getKitchenwareOptions(e.kitchenware);$("#cal-self-select-table").DataTable().MakeCellsEditable("destroy"),$("#cal-self-select-table").DataTable().MakeCellsEditable({columns:[1,10,20,24],inputTypes:[{column:1,type:"list",options:c},{column:10,type:"list",options:l},{column:24,type:"list",options:r}],onUpdate:function(a,c,l){"undefined"!=typeof i&&(i.terminate(),i=void 0),i=new Worker("js/cal.js"),i.onmessage=function(e){a.clear().rows.add(e.data).draw(!1),$(a.body()).removeClass("processing")};var r=$("#cal-recipes-table").DataTable().data().toArray(),s=$("#cal-chefs-table").DataTable().data().toArray(),n=$("#cal-ingredients-table").DataTable().data().toArray(),o=a.data().toArray();i.postMessage({mode:"custom",rule:t,recipes:r,chefs:s,ingredients:n,kitchenware:e.kitchenware,custom:o})},waitUpdate:!0}),$("#pane-cal-rules .cal-results-progress").addClass("hidden"),$("#btn-cal-rule-load").prop("disabled",!1)},void a.postMessage({mode:"get-rules-data",rule:t,data:e})):void alert("请选择规则")})}function initCalRecipesTable(e){var t=[{data:void 0,defaultContent:"",className:"select-checkbox",orderDataType:"dom-selected",width:"30px"},{data:"recipeId"},{data:"name"},{data:{_:"rarity",display:"rarityDisp"}},{data:"stirfry"},{data:"boil"},{data:"cut"},{data:"fry"},{data:"roast"},{data:"steam"},{data:{_:"ingredientsVal",display:"ingredientsDisp"}},{data:"price"},{data:"limit"},{data:"totalPrice"},{data:"origin"},{data:"addition",className:"cal-td-input-addition",width:"38px"}],a=$("#cal-recipes-table").DataTable({data:new Array,columns:t,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"共 _MAX_ 个菜谱",infoEmpty:"没有数据",infoFiltered:"",select:{rows:{_:"选择了 %d 个菜谱",0:"选择了 %d 个菜谱",1:"选择了 %d 个菜谱"}}},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},autoWidth:!1,createdRow:function(e,t,a){$(e).addClass("rarity-"+t.rarity)}});$("#pane-cal-recipes div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="菜名 材料"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,t,a){if(e.nTable!=document.getElementById("cal-recipes-table"))return!0;for(var i=$("#pane-cal-recipes .search-box input").val(),c=[2,10],l=0,r=c.length;l<r;l++)if(t[c[l]].indexOf(i)!==-1)return!0;return!1}),a.MakeCellsEditable({columns:[15]}),$(".chk-cal-recipes-show").click(function(){initCalRecipesShow(a)}),$('.chk-cal-recipes-rarity input[type="checkbox"]').click(function(){var e=$(this).attr("data-rarity");$(this).prop("checked")?a.rows(".rarity-"+e).select():a.rows(".rarity-"+e).deselect()}),$("#pane-cal-recipes .search-box input").keyup(function(){a.draw()}),$("#btn-cal-recipes-select-all").click(function(){$('.chk-cal-recipes-rarity input[type="checkbox"]').prop("checked",!0),a.rows().select()}),$("#btn-cal-recipes-deselect-all").click(function(){$('.chk-cal-recipes-rarity input[type="checkbox"]').prop("checked",!1),a.rows().deselect()}),initCalRecipesShow(a)}function initCalChefsTable(e){var t=[{data:void 0,defaultContent:"",className:"select-checkbox",orderDataType:"dom-selected",width:"30px"},{data:{_:"chefId",display:"chefIdDisp"}},{data:"name"},{data:{_:"rarity",display:"rarityDisp"}},{data:"stirfry"},{data:"boil"},{data:"cut"},{data:"fry"},{data:"roast"},{data:"steam"},{data:{_:"specialSkillVal",display:"specialSkillDisp"}},{data:"sex"},{data:"origin"},{data:"addition",className:"cal-td-input-addition",width:"38px"},{data:"kitchenwareName",className:"cal-td-select-kitchenware",width:"101px"}],a=$("#cal-chefs-table").DataTable({data:new Array,columns:t,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"共 _MAX_ 个厨师",infoEmpty:"没有数据",infoFiltered:"",select:{rows:{_:"选择了 %d 个厨师",0:"选择了 %d 个厨师",1:"选择了 %d 个厨师"}}},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},autoWidth:!1,createdRow:function(e,t,a){$(e).addClass("rarity-"+t.rarity)}});$("#pane-cal-chefs div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="名字 性别"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,t,a){if(e.nTable!=document.getElementById("cal-chefs-table"))return!0;for(var i=$("#pane-cal-chefs .search-box input").val(),c=[2,11],l=0,r=c.length;l<r;l++)if(t[c[l]].indexOf(i)!==-1)return!0;return!1});var i=getKitchenwareOptions(e.kitchenware);a.MakeCellsEditable({columns:[13,14],inputTypes:[{column:14,type:"list",options:i}]}),$(".chk-cal-chefs-show").click(function(){initCalChefsShow(a)}),$('.chk-cal-chefs-rarity input[type="checkbox"]').click(function(){var e=$(this).attr("data-rarity");$(this).prop("checked")?a.rows(".rarity-"+e).select():a.rows(".rarity-"+e).deselect()}),$("#btn-cal-chefs-kitchenware-clear").click(function(){a.rows().every(function(e,t,a){this.cell(e,".cal-td-select-kitchenware").data("")})}),$("#pane-cal-chefs .search-box input").keyup(function(){a.draw()}),$("#btn-cal-chefs-select-all").click(function(){$('.chk-cal-chefs-rarity input[type="checkbox"]').prop("checked",!0),a.rows().select()}),$("#btn-cal-chefs-deselect-all").click(function(){$('.chk-cal-chefs-rarity input[type="checkbox"]').prop("checked",!1),a.rows().deselect()}),initCalChefsShow(a)}function initCalIngredientsTable(e){var t=[{data:void 0,defaultContent:"",className:"select-checkbox",orderDataType:"dom-selected",width:"30px"},{data:"ingredientId"},{data:"name"},{data:{_:"rarity",display:"rarityDisp"}},{data:"origin"},{data:"addition",className:"cal-td-input-addition",width:"38px"}],a=$("#cal-ingredients-table").DataTable({data:new Array,columns:t,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"共 _MAX_ 个食材",infoEmpty:"没有数据",infoFiltered:"",select:{rows:{_:"选择了 %d 个食材",0:"选择了 %d 个食材",1:"选择了 %d 个食材"}}},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},order:[[4,"desc"]],autoWidth:!1,createdRow:function(e,t,a){$(e).addClass("origin-"+t.originVal)}});$("#pane-cal-ingredients div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="名字 来源"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,t,a){if(e.nTable!=document.getElementById("cal-ingredients-table"))return!0;for(var i=$("#pane-cal-ingredients .search-box input").val(),c=[2,4],l=0,r=c.length;l<r;l++)if(t[c[l]].indexOf(i)!==-1)return!0;return!1}),a.MakeCellsEditable({columns:[5]}),$(".chk-cal-ingredients-show").click(function(){initCalIngredientsShow(a)}),$('.chk-cal-ingredients-origin input[type="checkbox"]').click(function(){var e=$(this).attr("data-origin");$(this).prop("checked")?a.rows(".origin-"+e).select():a.rows(".origin-"+e).deselect()}),$("#pane-cal-ingredients .search-box input").keyup(function(){a.draw()}),$("#btn-cal-ingredients-select-all").click(function(){$('.chk-cal-ingredients-origin input[type="checkbox"]').prop("checked",!0),a.rows().select()}),$("#btn-cal-ingredients-deselect-all").click(function(){$('.chk-cal-ingredients-origin input[type="checkbox"]').prop("checked",!1),a.rows().deselect()}),initCalIngredientsShow(a)}function initCalResultsTable(e){$("#cal-recipes-results-place").html($("#pane-cal-results-common").html()),$("#cal-recipes-results-place .cal-results-table").prop("id","cal-recipes-results-table"),$("#cal-recipes-results-place .chk-cal-results-show-selected").bootstrapToggle(),$("#cal-all-results-place").html($("#pane-cal-results-common").html()),$("#cal-all-results-place .cal-results-table").prop("id","cal-all-results-table"),$("#cal-all-results-place .chk-cal-results-show-selected").bootstrapToggle(),$("#cal-optimal-results-place").html($("#pane-cal-results-common").html()),$("#cal-optimal-results-place .cal-results-table").prop("id","cal-optimal-results-table"),$("#cal-optimal-results-place .chk-cal-results-show-selected").remove(),initCalResultTableCommon("recipes",new Array,$("#pane-cal-recipes-results")),initCalResultTableCommon("all",new Array,$("#pane-cal-all-results")),initCalResultTableCommon("optimal",new Array,$("#pane-cal-optimal-results"));var t,a,i;$(".btn-cal-results-cal").click(function(){var c=Math.floor($("#input-rule-id").val());if(!c)return void alert("请加载规则");var l,r,s=$(this).closest(".pane-cal-results");if("pane-cal-all-results"==s.prop("id"))r="all",l=a;else if("pane-cal-optimal-results"==s.prop("id"))r="optimal",l=i;else{if("pane-cal-recipes-results"!=s.prop("id"))return;r="recipes",l=t}if("undefined"!=typeof l&&(l.terminate(),l=void 0),$(this).hasClass("stop"))return s.find(".cal-results-progress").addClass("hidden"),s.find(".btn-cal-results-cal.start").prop("disabled",!1),void s.find(".btn-cal-results-cal.stop").prop("disabled",!0);s.find(".btn-cal-results-cal.start").prop("disabled",!0),s.find(".btn-cal-results-cal.stop").prop("disabled",!1),s.find(".cal-results-wrapper").addClass("hidden"),s.find(".cal-results-progress .progress-bar").css("width","0%"),s.find(".cal-results-progress .progress-bar span").text("预处理中"),s.find(".cal-results-progress").removeClass("hidden"),l=new Worker("js/cal.js"),"all"==r?a=l:"optimal"==r?i=l:"recipes"==r&&(t=l),l.onmessage=function(e){e.data.progress?(s.find(".cal-results-progress .progress-bar").css("width",e.data.progress.value+"%"),s.find(".cal-results-progress .progress-bar span").text(e.data.progress.display)):e.data.menu?(e.data.message?s.find(".selected-sum").html(e.data.message):s.find(".selected-sum").html("点击可选择"),"all"==r?(s.find(".chk-cal-results-show-selected").prop("checked",!1),$("#cal-all-results-table").DataTable().clear().rows.add(e.data.menu).draw(!1)):"optimal"==r?($("#cal-optimal-results-table").DataTable().clear().rows.add(e.data.menu).draw(!1),$("#cal-optimal-results-table").DataTable().rows().select()):"recipes"==r&&(s.find(".chk-cal-results-show-selected").prop("checked",!1),$("#cal-recipes-results-table").DataTable().clear().rows.add(e.data.menu).draw(!1)),s.find(".cal-results-wrapper").removeClass("hidden")):e.data.done&&(s.find(".btn-cal-results-cal.stop").prop("disabled",!0),s.find(".btn-cal-results-cal.start").prop("disabled",!1),s.find(".cal-results-progress").addClass("hidden"))};var n=$("#cal-recipes-table").DataTable().rows({selected:!0}).data().toArray(),o=$("#cal-chefs-table").DataTable().rows({selected:!0}).data().toArray(),d=$("#cal-ingredients-table").DataTable().rows({selected:!0}).data().toArray(),h=Math.floor($("#input-cal-all-results-show-top").val());l.postMessage({mode:r,rule:c,recipes:n,chefs:o,ingredients:d,kitchenware:e.kitchenware,allLimit:h})})}function initCalResultTableCommon(e,t,a){var i=[{data:void 0,defaultContent:"",className:"select-checkbox",orderDataType:"dom-selected",width:"30px"},{data:"chef.name",className:"cal-td-chef-name",defaultContent:""},{data:{_:"chef.rarity",display:"chef.rarityDisp"},defaultContent:""},{data:"chef.sex",defaultContent:""},{data:"chef.stirfry",defaultContent:""},{data:"chef.boil",defaultContent:""},{data:"chef.cut",defaultContent:""},{data:"chef.fry",defaultContent:""},{data:"chef.roast",defaultContent:""},{data:"chef.steam",defaultContent:""},{data:"recipe.data.name",className:"cal-td-recipe-name",defaultContent:""},{data:{_:"recipe.data.rarity",display:"recipe.data.rarityDisp"},defaultContent:""},{data:"recipe.data.stirfry",defaultContent:""},{data:"recipe.data.boil",defaultContent:""},{data:"recipe.data.cut",defaultContent:""},{data:"recipe.data.fry",defaultContent:""},{data:"recipe.data.roast",defaultContent:""},{data:"recipe.data.steam",defaultContent:""},{data:{_:"recipe.data.ingredientsVal",display:"recipe.data.ingredientsDisp"},defaultContent:""},{data:"recipe.data.price",defaultContent:""},{data:"recipe.quantity",className:"cal-td-quantity",defaultContent:"",width:"38px"},{data:{_:"recipe.qualityVal",display:"recipe.qualityDisp"},defaultContent:""},{data:{_:"recipe.qualityAddition",display:"recipe.qualityAdditionDisp"},defaultContent:""},{data:{_:"recipe.chefSkillAddition",display:"recipe.chefSkillAdditionDisp"},defaultContent:""},{data:"kitchenware.disp",className:"cal-td-kitchenware-name",defaultContent:""},{data:{_:"recipe.equipSkillAddition",display:"recipe.equipSkillAdditionDisp"},defaultContent:""},{data:{_:"recipe.otherAddition",display:"recipe.otherAdditionDisp"},defaultContent:""},{data:"recipe.totalPrice",defaultContent:""},{data:"recipe.realTotalPrice",defaultContent:""},{data:"recipe.bonusScore",defaultContent:""},{data:"recipe.totalScore",defaultContent:""}],c=!0;"optimal"!=e&&"self-select"!=e||(c=!1);var l=[[30,"desc"]];"self-select"==e&&(l=[]);var r=a.find(".cal-results-table").DataTable({data:t,columns:i,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 条",zeroRecords:"没有找到",info:"共 _TOTAL_ 条",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 条中过滤)",select:{rows:{_:"选择了 %d 条",0:"选择了 %d 条",1:"选择了 %d 条"}}},paging:c,pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-12'<'selected-sum'>>><'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},autoWidth:!1,order:l});if(a.find(".selected-sum").html("点击可选择"),"all"==e||"recipes"==e){a.find("div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="厨师 菜名 材料"></label>'),a.find(".search-box input").keyup(function(){r.draw()}),a.find(".chk-cal-results-show-selected").prop("checked",!1);var s="",n="";a.find(".chk-cal-results-show-selected").change(function(){$(this).prop("checked")?(s=a.find(".search-box input").val(),a.find(".search-box input").val(n)):(n=a.find(".search-box input").val(),a.find(".search-box input").val(s)),r.draw()})}return r.on("select deselect",function(t,i,c,l){if("row"===c){var s=i.rows({selected:!0}).indexes(),n=i.cells(s,27).data().reduce(function(e,t){return e+t},0),o="原售价："+n;if("all"==e||"optimal"==e||"self-select"==e){var d=i.cells(s,28).data().reduce(function(e,t){return e+t},0);o+=" 实售价："+d}var h=i.cells(s,29).data().reduce(function(e,t){return e+t},0);o+=" 规则分："+h;var p=i.cells(s,30).data().reduce(function(e,t){return e+t},0);o+=" 总得分："+p,a.find(".selected-sum").html(o),"all"!=e&&"recipes"!=e||a.find(".chk-cal-results-show-selected").prop("checked")&&r.draw()}}),a.find(".chk-cal-results-show").click(function(){initCalResultsShow(e,r,a)}),a.find(".chk-cal-results-show-all").click(function(){a.find(".btn:not(.hidden) .chk-cal-results-show:checked").length==a.find(".btn:not(.hidden) .chk-cal-results-show").length?a.find(".btn:not(.hidden) .chk-cal-results-show").prop("checked",!1):a.find(".btn:not(.hidden) .chk-cal-results-show").prop("checked",!0),initCalResultsShow(e,r,a)}),"all"==e?($.fn.dataTableExt.afnFiltering.push(function(e,t,a){if(e.nTable!=document.getElementById("cal-all-results-table"))return!0;for(var i=$("#pane-cal-all-results .search-box input").val(),c=[1,10,18],l=0,r=c.length;l<r;l++)if(t[c[l]].indexOf(i)!==-1)return!0;return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,t,a){if(e.nTable!=document.getElementById("cal-all-results-table"))return!0;if($("#pane-cal-all-results .chk-cal-results-show-selected").prop("checked")){var i=e.aoData[a].nTr;return!!$(i).hasClass("selected")}return!0})):"recipes"==e&&($.fn.dataTableExt.afnFiltering.push(function(e,t,a){if(e.nTable!=document.getElementById("cal-recipes-results-table"))return!0;for(var i=$("#pane-cal-recipes-results .search-box input").val(),c=[1,10,18],l=0,r=c.length;l<r;l++)if(t[c[l]].indexOf(i)!==-1)return!0;return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,t,a){if(e.nTable!=document.getElementById("cal-recipes-results-table"))return!0;if($("#pane-cal-recipes-results .chk-cal-results-show-selected").prop("checked")){var i=e.aoData[a].nTr;return!!$(i).hasClass("selected")}return!0})),initCalResultsShow(e,r,a),r}function initCalSelfSelect(e){$("#cal-self-select-place").html($("#pane-cal-results-common").html()),$("#cal-self-select-place .cal-results-table").prop("id","cal-self-select-table"),$("#cal-self-select-place .chk-cal-results-show-selected").remove(),$("#cal-self-select-place .chk-cal-results-show-chef-kitchenware").prop("checked",!0);
for(var t=new Array,a=0;a<9;a++){var i=new Object;i.chef=new Object,i.recipe=new Object,i.recipe.data=new Object,i.kitchenware=new Object,t.push(i)}initCalResultTableCommon("self-select",t,$("#pane-cal-self-select"));$("#pane-cal-self-select").find(".cal-results-wrapper").removeClass("hidden")}function generateData(e,t){var a=new Object;a.history=e.history;var i=new Array;for(var c in e.ingredients){var l=e.ingredients[c];l.rarityDisp=getRarityDisp(e.ingredients[c].rarity),l.originVal=getOriginVal(e.ingredients[c].origin),l.addition="",i.push(l)}a.ingredients=i;var r=new Array;for(var c in e.kitchenware)if(e.kitchenware[c].name){var s=e.kitchenware[c];s.rarityDisp=getRarityDisp(e.kitchenware[c].rarity),s.cal=isCalKitchenware(e.kitchenware[c].skill);var n=getSkillInfo(e.kitchenware[c].skill);s.skillVal=n.skillVal,s.skillDisp=n.skillDisp,r.push(s)}a.kitchenware=r;var o=new Array;for(var c in e.quests)if(!(e.quests[c].questId>400)&&e.quests[c].goal){var d=e.quests[c],h="",p="";for(var u in e.quests[c].rewards)h+=e.quests[c].rewards[u].name,e.quests[c].rewards[u].quantity&&(h+="*"+e.quests[c].rewards[u].quantity),h+=" ",p+=e.quests[c].rewards[u].name;d.rewardsVal=p,d.rewardsDisp=h,o.push(d)}a.quests=o;var f=new Array;for(var c in e.chefs)if(e.chefs[c].name){var k=e.chefs[c];k.recipes=new Array,k.stirfry=e.chefs[c].stirfry||"",k.boil=e.chefs[c].boil||"",k.cut=e.chefs[c].cut||"",k.fry=e.chefs[c].fry||"",k.roast=e.chefs[c].roast||"",k.steam=e.chefs[c].steam||"",k.meat=e.chefs[c].meat||"",k.wheat=e.chefs[c].wheat||"",k.veg=e.chefs[c].veg||"",k.fish=e.chefs[c].fish||"",k.addition="",k.kitchenwareName="",k.chefIdDisp=e.chefs[c].chefId+" - "+(e.chefs[c].chefId+2),k.rarityDisp=getRarityDisp(e.chefs[c].rarity);var n=getSkillInfo(e.chefs[c].skill);k.specialSkillVal=n.skillVal,k.specialSkillDisp=n.skillDisp,f.push(k)}a.chefs=f;var m=new Array;for(var c in e.recipes)if(e.recipes[c].name){var b=new Object;b=e.recipes[c],b.stirfry=e.recipes[c].stirfry||"",b.boil=e.recipes[c].boil||"",b.cut=e.recipes[c].cut||"",b.fry=e.recipes[c].fry||"",b.roast=e.recipes[c].roast||"",b.steam=e.recipes[c].steam||"",b.price=e.recipes[c].price||"",b.limit=e.recipes[c].limit||"",b.addition="",b.timeDisp=secondsToTime(e.recipes[c].time),b.rarityDisp=getRarityDisp(e.recipes[c].rarity);var w=0,$=0,v=0;e.recipes[c].price>0&&e.recipes[c].time>0&&(v=3600*e.recipes[c].price/e.recipes[c].time,e.recipes[c].limit>0&&(w=e.recipes[c].price*e.recipes[c].limit,$=e.recipes[c].time*e.recipes[c].limit)),b.totalPrice=w?w:"",b.totalTime=$,b.totalTimeDisp=secondsToTime($),b.efficiency=v?Math.floor(v):"";var y=getIngredientsInfo(e.recipes[c]);b.ingredientsVal=y.ingredientsVal,b.ingredientsDisp=y.ingredientsDisp;var x=0;e.recipes[c].time>0&&(x=3600*y.ingredientsCount/e.recipes[c].time),b.ingredientsEff=x?Math.floor(x):"";var T="",C="";for(g in e.recipes[c].guests)if(e.recipes[c].guests[g].guest){if(t&&("优"==e.recipes[c].quality&&"优"==e.recipes[c].guests[g].quality||"特"==e.recipes[c].quality&&"神"!=e.recipes[c].guests[g].quality||"神"==e.recipes[c].quality))continue;T+=e.recipes[c].guests[g].quality+"-"+e.recipes[c].guests[g].guest+"<br>",C+=e.recipes[c].guests[g].guest}b.levelGuestsVal=C,b.levelGuestsDisp=T;var D="";for(var _ in e.guests)for(var E in e.guests[_].gifts)if(e.recipes[c].name==e.guests[_].gifts[E].recipe){D+=e.guests[_].name+"-"+e.guests[_].gifts[E].rune+"<br>";break}b.guestsDisp=D,b.chefs=new Array;for(var u in a.chefs){var M=getQualityInfo(e.recipes[c],a.chefs[u]),O=0;if(M.qualityVal>0){var q=getSkillAddition(e.recipes[c],a.chefs[u].skill,a.ingredients);v>0&&(O=(1+M.qualityAddition+q)*v)}var A=new Object;A.qualityVal=M.qualityVal,A.qualityDisp=M.qualityDisp,A.efficiency=Math.floor(O)||"",b.chefs.push(A);var S=new Object;S.qualityVal=M.qualityVal,S.qualityDisp=M.qualityDisp,a.chefs[u].recipes.push(S)}m.push(b)}return a.recipes=m,a}function getQuestsData(e,t){var a=new Array;for(var i in e)e[i].type==t&&a.push(e[i]);return a}function getIngredientsInfo(e){var t=new Object,a="",i="",c=0;for(var l in e.ingredients)e.ingredients[l].name&&(a+=e.ingredients[l].name+"*"+e.ingredients[l].quantity+" ",i+=e.ingredients[l].name,c+=e.ingredients[l].quantity);return t.ingredientsDisp=a,t.ingredientsVal=i,t.ingredientsCount=c,t}function getRarityDisp(e){for(var t="",a=0;a<e;a++)t+="&#x2605;";return t}function isCalKitchenware(e){var t=!1;for(var a in e)if(e[a].type.indexOf("料理")>=0||e[a].type.indexOf("金币获得")>=0||e[a].type.indexOf("技法")>=0)return!0;return t}function getOriginVal(e){var t=0;return"菜棚"==e?t=1:"菜地"==e?t=2:"森林"==e?t=3:"鸡舍"==e?t=4:"猪圈"==e?t=5:"牧场"==e?t=6:"作坊"==e?t=7:"鱼塘"==e&&(t=8),t}function getKitchenwareOptions(e){var t=new Array,a=new Object;a.display="无厨具",a.subtext="",a.tokens="",a.value="",t.push(a);for(var i in e){var c=getSkillInfo(e[i].skill),l=c.skillDisp.replace("<br>"," "),a=new Object;a.display=e[i].name,a.subtext=l,a.tokens=e[i].name+l,a.value=e[i].name,t.push(a)}return t}function getChefsOptions(e){var t=new Array,a=new Object;a.display="无厨师",a.value="",t.push(a);for(var i in e){var a=new Object;a.display=e[i].name,a.value=e[i].name,t.push(a)}return t}function getRecipesOptions(e){var t=new Array,a=new Object;a.display="无菜谱",a.value="",t.push(a);for(var i in e){var a=new Object;a.display=e[i].name,a.value=e[i].name,t.push(a)}return t}function initRecipeShow(e,t,a){e.column(0).visible($("#chk-recipe-show-id").prop("checked"),!1),e.column(2).visible($("#chk-recipe-show-rarity").prop("checked"),!1);var i=$("#chk-recipe-show-skill").prop("checked");e.column(3).visible(i,!1),e.column(4).visible(i,!1),e.column(5).visible(i,!1),e.column(6).visible(i,!1),e.column(7).visible(i,!1),e.column(8).visible(i,!1),e.column(9).visible($("#chk-recipe-show-ingredients").prop("checked"),!1),e.column(10).visible($("#chk-recipe-show-price").prop("checked"),!1),e.column(11).visible($("#chk-recipe-show-time").prop("checked"),!1),e.column(12).visible($("#chk-recipe-show-limit").prop("checked"),!1),e.column(13).visible($("#chk-recipe-show-total-price").prop("checked"),!1),e.column(14).visible($("#chk-recipe-show-total-time").prop("checked"),!1),e.column(15).visible($("#chk-recipe-show-efficiency").prop("checked"),!1),e.column(16).visible($("#chk-recipe-show-ingredients-efficiency").prop("checked"),!1),e.column(17).visible($("#chk-recipe-show-origin").prop("checked"),!1),e.column(18).visible($("#chk-recipe-show-unlock").prop("checked"),!1),e.column(19).visible($("#chk-recipe-show-guest").prop("checked"),!1),e.column(20).visible($("#chk-recipe-show-level-guest").prop("checked"),!1),e.column(21).visible($("#chk-recipe-show-god-rune").prop("checked"),!1),a?e.column(22).visible($("#chk-recipe-show-quality").prop("checked"),!1):e.column(22).visible(!1,!1);for(var c=$("#chk-recipe-show-chef").val(),l=0;l<t.chefs.length;l++)e.column(23+2*l).visible(c.indexOf(l.toString())>-1,!1),e.column(24+2*l).visible(c.indexOf(l.toString())>-1,!1);e.columns.adjust().draw(!1)}function initChefShow(e,t){e.column(0).visible($("#chk-chef-show-id").prop("checked"),!1),e.column(2).visible($("#chk-chef-show-rarity").prop("checked"),!1);var a=$("#chk-chef-show-skill").prop("checked");e.column(3).visible(a,!1),e.column(4).visible(a,!1),e.column(5).visible(a,!1),e.column(6).visible(a,!1),e.column(7).visible(a,!1),e.column(8).visible(a,!1),e.column(9).visible($("#chk-chef-show-special-skill").prop("checked"),!1);var i=$("#chk-chef-show-harvest").prop("checked");e.column(10).visible(i,!1),e.column(11).visible(i,!1),e.column(12).visible(i,!1),e.column(13).visible(i,!1),e.column(14).visible($("#chk-chef-show-sex").prop("checked"),!1),e.column(15).visible($("#chk-chef-show-origin").prop("checked"),!1);for(var c=$("#chk-chef-show-recipe").val(),l=0;l<t.recipes.length;l++)e.column(16+l).visible(c.indexOf(l.toString())>-1,!1);e.columns.adjust().draw(!1)}function initKitchenwareShow(e){e.column(0).visible($("#chk-kitchenware-show-id").prop("checked"),!1),e.column(2).visible($("#chk-kitchenware-show-rarity").prop("checked"),!1),e.column(3).visible($("#chk-kitchenware-show-special-skill").prop("checked"),!1),e.column(4).visible($("#chk-kitchenware-show-origin").prop("checked"),!1),e.columns.adjust().draw(!1)}function initCalRecipesShow(e){e.column(1).visible($("#chk-cal-recipes-show-id").prop("checked"),!1),e.column(3).visible($("#chk-cal-recipes-show-rarity").prop("checked"),!1);var t=$("#chk-cal-recipes-show-skill").prop("checked");e.column(4).visible(t,!1),e.column(5).visible(t,!1),e.column(6).visible(t,!1),e.column(7).visible(t,!1),e.column(8).visible(t,!1),e.column(9).visible(t,!1),e.column(10).visible($("#chk-cal-recipes-show-ingredient").prop("checked"),!1),e.column(11).visible($("#chk-cal-recipes-show-price").prop("checked"),!1),e.column(12).visible($("#chk-cal-recipes-show-limit").prop("checked"),!1),e.column(13).visible($("#chk-cal-recipes-show-total-price").prop("checked"),!1),e.column(14).visible($("#chk-cal-recipes-show-origin").prop("checked"),!1),e.columns.adjust().draw(!1)}function initCalChefsShow(e){e.column(1).visible($("#chk-cal-chefs-show-id").prop("checked"),!1),e.column(3).visible($("#chk-cal-chefs-show-rarity").prop("checked"),!1);var t=$("#chk-cal-chefs-show-skill").prop("checked");e.column(4).visible(t,!1),e.column(5).visible(t,!1),e.column(6).visible(t,!1),e.column(7).visible(t,!1),e.column(8).visible(t,!1),e.column(9).visible(t,!1),e.column(10).visible($("#chk-cal-chefs-show-special-skill").prop("checked"),!1),e.column(11).visible($("#chk-cal-chefs-show-sex").prop("checked"),!1),e.column(12).visible($("#chk-cal-chefs-show-origin").prop("checked"),!1),e.columns.adjust().draw(!1)}function initCalIngredientsShow(e){e.column(1).visible($("#chk-cal-ingredients-show-id").prop("checked"),!1),e.column(3).visible($("#chk-cal-ingredients-show-rarity").prop("checked"),!1),e.column(4).visible($("#chk-cal-ingredients-show-origin").prop("checked"),!1),e.columns.adjust().draw(!1)}function initCalResultsShow(e,t,a){"recipes"==e&&(a.find(".chk-cal-results-show-chef-rarity").prop("checked",!1).closest(".btn").addClass("hidden"),a.find(".chk-cal-results-show-chef-sex").prop("checked",!1).closest(".btn").addClass("hidden"),a.find(".chk-cal-results-show-chef-skill").prop("checked",!1).closest(".btn").addClass("hidden"),a.find(".chk-cal-results-show-recipe-quality").prop("checked",!1).closest(".btn").addClass("hidden"),a.find(".chk-cal-results-show-chef-kitchenware").prop("checked",!1).closest(".btn").addClass("hidden"),a.find(".chk-cal-results-show-chef-kitchenware-addition").prop("checked",!1).closest(".btn").addClass("hidden"),a.find(".chk-cal-results-show-recipe-real-total-price").prop("checked",!1).closest(".btn").addClass("hidden"),t.column(1).visible(!1,!1),t.column(22).visible(!1,!1),t.column(23).visible(!1,!1)),t.column(2).visible(a.find(".chk-cal-results-show-chef-rarity").prop("checked"),!1),t.column(3).visible(a.find(".chk-cal-results-show-chef-sex").prop("checked"),!1);var i=a.find(".chk-cal-results-show-chef-skill").prop("checked");t.column(4).visible(i,!1),t.column(5).visible(i,!1),t.column(6).visible(i,!1),t.column(7).visible(i,!1),t.column(8).visible(i,!1),t.column(9).visible(i,!1),t.column(11).visible(a.find(".chk-cal-results-show-recipe-rarity").prop("checked"),!1);var c=a.find(".chk-cal-results-show-recipe-skill").prop("checked");t.column(12).visible(c,!1),t.column(13).visible(c,!1),t.column(14).visible(c,!1),t.column(15).visible(c,!1),t.column(16).visible(c,!1),t.column(17).visible(c,!1),t.column(18).visible(a.find(".chk-cal-results-show-recipe-ingredient").prop("checked"),!1),t.column(21).visible(a.find(".chk-cal-results-show-recipe-quality").prop("checked"),!1),t.column(24).visible(a.find(".chk-cal-results-show-chef-kitchenware").prop("checked"),!1),t.column(25).visible(a.find(".chk-cal-results-show-chef-kitchenware-addition").prop("checked"),!1),t.column(26).visible(a.find(".chk-cal-results-show-bonus-addition").prop("checked"),!1),t.column(27).visible(a.find(".chk-cal-results-show-recipe-total-price").prop("checked"),!1),t.column(28).visible(a.find(".chk-cal-results-show-recipe-real-total-price").prop("checked"),!1),t.column(29).visible(a.find(".chk-cal-results-show-bonus-score").prop("checked"),!1),t.columns.adjust().draw(!1)}function initInfo(e){$("#pagination-history").pagination({dataSource:e.history,callback:function(e,t){var a=historyTemplate(e);$("#data-history").html(a)},pageSize:10,showPageNumbers:!1,showNavigator:!0,showPrevious:!0,showNext:!0})}function historyTemplate(e){var t="";return $.each(e,function(e,a){t+="<p>"+a+"</p>"}),t}function secondsToTime(e){e=Number(e);var t=Math.floor(e/3600/24),a=Math.floor(e/3600%24),i=Math.floor(e/60%60),c=Math.floor(e%60),l="";return t>0&&(l+=t+"天"),a>0&&(l+=a+"小时"),i>0&&(l+=i+"分"),c>0&&(l+=c+"秒"),l}function getInputHtml(e,t,a){var i,c,l;switch(l={type:"input",html:null},t.inputTypes&&$.each(t.inputTypes,function(t,a){a.column==e&&(i=a,c=i.type.toLowerCase())}),c){case"list":l.html="<select data-live-search='true' data-width='fit' data-dropdown-align-right='auto' data-live-search-placeholder='查找' data-none-results-text='没有找到'>",$.each(i.options,function(e,t){l.html=l.html+"<option value='"+t.value+"'",t.tokens&&(l.html+=" data-tokens='"+t.tokens+"'"),t.subtext&&(l.html+=" data-subtext='"+t.subtext+"'"),a==t.value&&(l.html+=" selected"),l.html+=">"+t.display+"</option>"}),l.html=l.html+"</select>",l.type=c;break;default:l.html="<input class='form-control' value='"+a+"'></input>"}return l}function sanitizeCellValue(e){return"undefined"==typeof e||null===e||e.length<1?"":(isNaN(e)&&(e=e.replace(/'/g,"&#39;")),e)}$(function(){$.ajax({cache:!1,success:function(e){init(e)},url:"data/data.json"})}),$.fn.dataTable.Api.register("MakeCellsEditable()",function(e){var t=this.table();$.fn.extend({updateEditableCell:function(e,t){var a=$(e).closest("table").DataTable().table(),i=a.row($(e).parents("tr")),c=a.cell($(e).closest("td")),l=$(e),r=l.val();c.data(r),t.onUpdate&&t.onUpdate(a,i,c)}}),"destroy"===e&&($(t.body()).off("click","td"),t=null),null!=t&&$(t.body()).on("click","td",function(){if(!$(t.body()).hasClass("processing")){var a=t.cell(this).index().column;if(e.columns&&e.columns.indexOf(a)>-1||!e.columns){var i=t.cell(this).node(),c=t.cell(this).data();if(c=sanitizeCellValue(c),!$(i).find("input").length&&!$(i).find("select").length){e.waitUpdate&&$(t.body()).addClass("processing");var l=getInputHtml(a,e,c);$(i).html(l.html),"input"==l.type?$(i).find("input").select().focus().on("focusout",function(){$(this).updateEditableCell(this,e)}):"list"==l.type&&$(i).find("select").selectpicker("toggle").on("hidden.bs.select",function(t){$(this).updateEditableCell(this,e)})}}}})});