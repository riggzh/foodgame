$(function(){$.ajax({cache:!1,success:function(e){init(e)},url:"data/data.json"})});var private=!1;function init(e){(window.location.search&&"0d9753e2fe5a15db2668f70016e565ca7d717c67278ea6c689881ac4"==lcode(window.location.search)&&(private=!0),private)?$.ajax({cache:!1,success:function(a){initTables(generateData(e,a))},error:function(){initTables(generateData(e))},url:"data/data2.json"}):initTables(generateData(e))}function initTables(e){initRecipeTable(e),initChefTable(e),initEquipTable(e),initQuestTable(e),initImportExport(),private&&(initCalTables(e),$(".nav-tabs li").removeClass("hidden")),initInfo(e),$(".loading").addClass("hidden"),$(".main-function").removeClass("hidden")}function initRecipeTable(e){var a,t=[{data:"recipeId"},{data:"name"},{data:{_:"rarity",display:"rarityDisp"}},{data:"stirfry"},{data:"boil"},{data:"knife"},{data:"fry"},{data:"bake"},{data:"steam"},{data:{_:"materialsVal",display:"materialsDisp"}},{data:"price"},{data:{_:"time",display:"timeDisp"}},{data:"limit"},{data:"totalPrice"},{data:{_:"totalTime",display:"totalTimeDisp"}},{data:"efficiency"},{data:"materialsEff"},{data:"origin"},{data:"unlock"},{data:"tagsDisp",defaultContent:""},{data:"guestsDisp"},{data:{_:"rankGuestsVal",display:"rankGuestsDisp"}},{data:"godAntique"},{data:"rank",width:"31px"},{data:"got",width:"31px"}];for(a in e.chefs)$("#chk-recipe-show-chef").append("<option value='"+a+"'>"+e.chefs[a].name+"</option>"),$("#recipe-table thead tr").append("<th>"+e.chefs[a].name+"</th>").append("<th>效率</th>"),t.push({data:{_:"chefs."+a+".rankVal",display:"chefs."+a+".rankDisp"}}),t.push({data:"chefs."+a+".efficiency"});a++,$("#recipe-table thead tr").append("<th>最佳厨师</th>").append("<th>最大效率</th>"),t.push({data:"chefs."+a+".qualityDisp"}),t.push({data:"chefs."+a+".efficiency"});var i=$("#recipe-table").DataTable({data:e.recipes,columns:t,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"第 _PAGE_ 页 共 _PAGES_ 页 _TOTAL_ 个菜谱",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 个菜谱中过滤)"},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",deferRender:!0,order:[],autoWidth:!1});$("#pane-recipes div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="菜名 材料 贵客 符文"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("recipe-table"))return!0;var i=$("#chk-recipe-rarity-1").prop("checked"),c=$("#chk-recipe-rarity-2").prop("checked"),l=$("#chk-recipe-rarity-3").prop("checked"),s=$("#chk-recipe-rarity-4").prop("checked"),r=$("#chk-recipe-rarity-5").prop("checked"),n=Math.floor(a[2])||0;return!!(i&&1==n||c&&2==n||l&&3==n||s&&4==n||r&&5==n)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){return e.nTable!=document.getElementById("recipe-table")||!!($("#chk-recipe-skill-stirfry").prop("checked")&&(Math.floor(a[3])||0)>0||$("#chk-recipe-skill-boil").prop("checked")&&(Math.floor(a[4])||0)>0||$("#chk-recipe-skill-knife").prop("checked")&&(Math.floor(a[5])||0)>0||$("#chk-recipe-skill-fry").prop("checked")&&(Math.floor(a[6])||0)>0||$("#chk-recipe-skill-bake").prop("checked")&&(Math.floor(a[7])||0)>0||$("#chk-recipe-skill-steam").prop("checked")&&(Math.floor(a[8])||0)>0)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("recipe-table"))return!0;var i=Math.floor($("#input-recipe-price").val()),c=Math.floor(a[10])||0;return""==$("#input-recipe-price").val()||i<c}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("recipe-table"))return!0;var i=$("#chk-recipe-guest").prop("checked"),c=a[20];return!!(!i||i&&c)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("recipe-table"))return!0;var i=$("#chk-recipe-no-origin").prop("checked"),c=a[17];return!!(i||!i&&c)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("recipe-table"))return!0;for(var i=$("#input-recipe-guest-antique").val(),c=[21,22],l=0,s=c.length;l<s;l++)if(-1!==a[c[l]].indexOf(i))return!0;return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("recipe-table"))return!0;var i=$("#chk-recipe-got").prop("checked"),c=a[24];return!!(!i||i&&c)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("recipe-table"))return!0;for(var i=$("#pane-recipes .search-box input").val(),c=[0,1,9,19,20],l=0,s=c.length;l<s;l++)if(-1!==a[c[l]].indexOf(i))return!0;return!1});var c=getRankOptions(),l=getGotOptions();i.MakeCellsEditable({columns:[23,24],inputTypes:[{column:23,type:"list",options:c},{column:24,type:"list",options:l}],onUpdate:function(e,a,t){var i=a.data(),c=getRankGuestInfo(i,i.rank);i.rankGuestsVal=c.rankGuestsVal,i.rankGuestsDisp=c.rankGuestsDisp,a.data(i),e.draw(!1);var l=generateExportData();try{localStorage.setItem("data",l)}catch(e){}}}),$("#chk-recipe-show-chef").selectpicker().on("changed.bs.select",function(){initRecipeShow(i,e)}),$(".chk-recipe-show").click(function(){initRecipeShow(i,e)}),$("#chk-recipe-show-all").click(function(){$(".btn:not(.hidden) .chk-recipe-show:checked").length==$(".btn:not(.hidden) .chk-recipe-show").length?$(".btn:not(.hidden) .chk-recipe-show").prop("checked",!1):$(".btn:not(.hidden) .chk-recipe-show").prop("checked",!0),initRecipeShow(i,e)}),$('.chk-recipe-rarity input[type="checkbox"]').click(function(){i.draw()}),$(".chk-recipe-skill").click(function(){$(this).prop("checked")&&$("#chk-recipe-single-skill").prop("checked")&&$(".chk-recipe-skill").not(this).prop("checked",!1),i.draw()}),$("#chk-recipe-single-skill").change(function(){$(this).prop("checked")&&$(".chk-recipe-skill:checked").length>1&&($(".chk-recipe-skill").prop("checked",!1),i.draw())}),$("#chk-recipe-skill-all").click(function(){$("#chk-recipe-single-skill").prop("checked")&&$("#chk-recipe-single-skill").bootstrapToggle("off"),$(".chk-recipe-skill").prop("checked",!0),i.draw()}),$("#input-recipe-price").keyup(function(){i.draw()}),$("#input-recipe-guest-antique").keyup(function(){$("#chk-recipe-show-rank-guest").prop("checked")||($("#chk-recipe-show-rank-guest").prop("checked",!0),initRecipeShow(i,e)),i.draw()}),$("#chk-recipe-guest").click(function(){i.draw()}),$("#chk-recipe-filter-guest").click(function(){i.rows().every(function(e,a,t){var i=this.data(),c=getRankGuestInfo(i,i.rank);i.rankGuestsVal=c.rankGuestsVal,i.rankGuestsDisp=c.rankGuestsDisp,this.data(i)}),i.draw()}),$("#chk-recipe-got").click(function(){i.draw()}),$("#chk-recipe-no-origin").click(function(){i.draw()}),$("#pane-recipes .search-box input").keyup(function(){i.draw()}),private&&($("#chk-recipe-show-origin").prop("checked",!1),$("#chk-recipe-show-unlock").prop("checked",!1),$("#chk-recipe-show-tags").parent(".btn").removeClass("hidden"),$("#chk-recipe-no-origin").closest(".box").removeClass("hidden")),initRecipeShow(i,e)}function initChefTable(e){var a=[{data:{_:"chefId",display:"chefIdDisp"}},{data:"name"},{data:{_:"rarity",display:"rarityDisp"}},{data:"stirfry"},{data:"boil"},{data:"knife"},{data:"fry"},{data:"bake"},{data:"steam"},{data:{_:"specialSkillVal",display:"specialSkillDisp"}},{data:"meat"},{data:"creation"},{data:"veg"},{data:"fish"},{data:"sex"},{data:"origin"},{data:"tagsDisp",defaultContent:""},{data:"got",width:"31px"}];for(var t in e.recipes)$("#chk-chef-show-recipe").append("<option value='"+t+"'>"+e.recipes[t].name+"</option>"),$("#chef-table thead tr").append("<th>"+e.recipes[t].name+"</th>"),a.push({data:{_:"recipes."+t+".rankVal",display:"recipes."+t+".rankDisp"}});var i=$("#chef-table").DataTable({data:e.chefs,columns:a,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"第 _PAGE_ 页 共 _PAGES_ 页 _TOTAL_ 个厨师",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 个厨师中过滤)"},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",deferRender:!0,order:[],autoWidth:!1});$("#pane-chefs div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="名字 技能 来源"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("chef-table"))return!0;var i=$("#chk-chef-rarity-1").prop("checked"),c=$("#chk-chef-rarity-2").prop("checked"),l=$("#chk-chef-rarity-3").prop("checked"),s=$("#chk-chef-rarity-4").prop("checked"),r=$("#chk-chef-rarity-5").prop("checked"),n=Math.floor(a[2])||0;return!!(i&&1==n||c&&2==n||l&&3==n||s&&4==n||r&&5==n)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("chef-table"))return!0;var i=Math.floor($("#input-chef-stirfry").val()),c=Math.floor(a[3])||0,l=Math.floor($("#input-chef-boil").val()),s=Math.floor(a[4])||0,r=Math.floor($("#input-chef-knife").val()),n=Math.floor(a[5])||0,o=Math.floor($("#input-chef-fry").val()),p=Math.floor(a[6])||0,d=Math.floor($("#input-chef-bake").val()),h=Math.floor(a[7])||0,u=Math.floor($("#input-chef-steam").val()),f=Math.floor(a[8])||0;return i<=c&&l<=s&&r<=n&&o<=p&&d<=h&&u<=f}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("chef-table"))return!0;var i=$("#chk-chef-sex-male").prop("checked"),c=$("#chk-chef-sex-female").prop("checked"),l=a[14];return!!(i&&"男"==l||c&&"女"==l)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("chef-table"))return!0;var i=$("#chk-chef-no-origin").prop("checked"),c=a[15];return!!(i||!i&&c)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("chef-table"))return!0;var i=$("#chk-chef-got").prop("checked"),c=a[17];return!!(!i||i&&c)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("chef-table"))return!0;for(var i=$("#pane-chefs .search-box input").val(),c=[1,9,15,16],l=0,s=c.length;l<s;l++)if(-1!==a[c[l]].indexOf(i))return!0;return!1});var c=getGotOptions();i.MakeCellsEditable({columns:[17],inputTypes:[{column:17,type:"list",options:c}],onUpdate:function(e,a,t){e.draw(!1);try{localStorage.setItem("data",generateExportData())}catch(e){}}}),$("#chk-chef-show-recipe").selectpicker().on("changed.bs.select",function(){initChefShow(i,e)}),$(".chk-chef-show").click(function(){initChefShow(i,e)}),$("#chk-chef-show-all").click(function(){$(".chk-chef-show:checked").length==$(".chk-chef-show").length?$(".chk-chef-show").prop("checked",!1):$(".chk-chef-show").prop("checked",!0),initChefShow(i,e)}),$('.chk-chef-rarity input[type="checkbox"]').click(function(){i.draw()}),$(".input-chef-skill").keyup(function(){i.draw()}),$("#btn-chef-skill-clear").click(function(){$(".input-chef-skill").val(""),i.draw()}),$('.chk-chef-sex input[type="checkbox"]').click(function(){i.draw()}),$("#chk-chef-got").click(function(){i.draw()}),$("#chk-chef-no-origin").click(function(){i.draw()}),$("#pane-chefs .search-box input").keyup(function(){i.draw()}),private&&($("#chk-chef-show-tags").parent(".btn").removeClass("hidden"),$("#chk-chef-no-origin").closest(".box").removeClass("hidden")),initChefShow(i,e)}function initEquipTable(e){var a=$("#equip-table").DataTable({data:e.equips,columns:[{data:"equipId"},{data:"name"},{data:{_:"rarity",display:"rarityDisp"}},{data:{_:"skillVal",display:"skillDisp"}},{data:"origin"}],language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"第 _PAGE_ 页 共 _PAGES_ 页 _TOTAL_ 个厨具",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 个厨具中过滤)"},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",deferRender:!0});$("#pane-equips div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="名字 技能 来源"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("equip-table"))return!0;var i=a[3];return!!($("#chk-equip-skill-stirfry-price").prop("checked")&&i.indexOf("炒类料理")>=0||$("#chk-equip-skill-boil-price").prop("checked")&&i.indexOf("煮类料理")>=0||$("#chk-equip-skill-knife-price").prop("checked")&&i.indexOf("切类料理")>=0||$("#chk-equip-skill-fry-price").prop("checked")&&i.indexOf("炸类料理")>=0||$("#chk-equip-skill-bake-price").prop("checked")&&i.indexOf("烤类料理")>=0||$("#chk-equip-skill-steam-price").prop("checked")&&i.indexOf("蒸类料理")>=0||$("#chk-equip-skill-meat-price").prop("checked")&&i.indexOf("肉类料理")>=0||$("#chk-equip-skill-creation-price").prop("checked")&&i.indexOf("面类料理")>=0||$("#chk-equip-skill-veg-price").prop("checked")&&i.indexOf("蔬菜料理")>=0||$("#chk-equip-skill-fish-price").prop("checked")&&i.indexOf("水产料理")>=0||$("#chk-equip-skill-sell-price").prop("checked")&&i.indexOf("金币获得")>=0||$("#chk-equip-skill-stirfry-skill").prop("checked")&&i.indexOf("炒技法")>=0||$("#chk-equip-skill-boil-skill").prop("checked")&&i.indexOf("煮技法")>=0||$("#chk-equip-skill-knife-skill").prop("checked")&&i.indexOf("切技法")>=0||$("#chk-equip-skill-fry-skill").prop("checked")&&i.indexOf("炸技法")>=0||$("#chk-equip-skill-bake-skill").prop("checked")&&i.indexOf("烤技法")>=0||$("#chk-equip-skill-steam-skill").prop("checked")&&i.indexOf("蒸技法")>=0||$("#chk-equip-skill-all-skill").prop("checked")&&i.indexOf("全技法")>=0||$("#chk-equip-skill-guest").prop("checked")&&i.indexOf("稀有客人")>=0||$("#chk-equip-skill-time").prop("checked")&&i.indexOf("开业时间")>=0||$("#chk-equip-skill-material-get").prop("checked")&&i.indexOf("素材获得")>=0||$("#chk-equip-skill-meat-skill").prop("checked")&&i.indexOf("肉类采集")>=0||$("#chk-equip-skill-creation-skill").prop("checked")&&i.indexOf("面类采集")>=0||$("#chk-equip-skill-veg-skill").prop("checked")&&i.indexOf("蔬菜采集")>=0||$("#chk-equip-skill-fish-skill").prop("checked")&&i.indexOf("水产采集")>=0||$("#chk-equip-skill-material-skill").prop("checked")&&i.indexOf("全采集")>=0)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("equip-table"))return!0;var i=$("#chk-equip-no-origin").prop("checked"),c=a[4];return!!(i||!i&&c)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("equip-table"))return!0;for(var i=$("#pane-equips .search-box input").val(),c=[1,3,4],l=0,s=c.length;l<s;l++)if(-1!==a[c[l]].indexOf(i))return!0;return!1}),$(".chk-equip-show").click(function(){initEquipShow(a)}),$("#chk-equip-show-all").click(function(){$(".chk-equip-show:checked").length==$(".chk-equip-show").length?$(".chk-equip-show").prop("checked",!1):$(".chk-equip-show").prop("checked",!0),initEquipShow(a)}),$(".chk-equip-skill").click(function(){$(this).prop("checked")&&$("#chk-equip-single-skill").prop("checked")&&$(".chk-equip-skill").not(this).prop("checked",!1),a.draw()}),$("#chk-equip-single-skill").change(function(){$(this).prop("checked")&&$(".chk-equip-skill:checked").length>1&&($(".chk-equip-skill").prop("checked",!1),a.draw())}),$("#chk-equip-skill-all").click(function(){$("#chk-equip-single-skill").prop("checked")&&$("#chk-equip-single-skill").bootstrapToggle("off"),$(".chk-equip-skill").prop("checked",!0),a.draw()}),$("#chk-equip-no-origin").click(function(){a.draw()}),$("#pane-equips .search-box input").keyup(function(){a.draw()}),private&&$("#chk-equip-no-origin").closest(".box").removeClass("hidden"),initEquipShow(a)}function initQuestTable(e){var a=getQuestsData(e.quests,$("#select-quest-type").val()),t=$("#quest-table").DataTable({data:a,columns:[{data:"questId"},{data:"goal"},{data:{_:"rewardsVal",display:"rewardsDisp"}}],language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"第 _PAGE_ 页 共 _PAGES_ 页 _TOTAL_ 个任务",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 个任务中过滤)"},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",deferRender:!0});$("#pane-quest div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="编号 任务 奖励"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("quest-table"))return!0;for(var i=$("#pane-quest .search-box input").val(),c=[0,1,2],l=0,s=c.length;l<s;l++)if(-1!==a[c[l]].indexOf(i))return!0;return!1}),$("#pane-quest .search-box input").keyup(function(){t.draw()}),$("#select-quest-type").change(function(){var a=getQuestsData(e.quests,$(this).val());t.clear().rows.add(a).draw()})}function initImportExport(){$("#btn-export").click(function(){$("#input-export-import").val(generateExportData())}),$("#btn-import").click(function(){$(this).prop("disabled",!0),importData($("#input-export-import").val())?$("#input-export-import").val(""):alert("格式有误"),$(this).prop("disabled",!1)})}function importData(e){var a;try{a=JSON.parse(e)}catch(e){return!1}var t=$("#recipe-table").DataTable().data().toArray();for(var i in t)for(var c in a.recipes)if(t[i].recipeId==a.recipes[c].id){if(a.recipes[c].hasOwnProperty("rank")){t[i].rank=a.recipes[c].rank;var l=getRankGuestInfo(t[i],t[i].rank);t[i].rankGuestsVal=l.rankGuestsVal,t[i].rankGuestsDisp=l.rankGuestsDisp}a.recipes[c].hasOwnProperty("got")&&(t[i].got=a.recipes[c].got);break}$("#recipe-table").DataTable().clear().rows.add(t).draw();var s=$("#chef-table").DataTable().data().toArray();for(var i in s)for(var c in a.chefs)if(s[i].chefId==a.chefs[c].id){a.chefs[c].hasOwnProperty("got")&&(s[i].got=a.chefs[c].got);break}$("#chef-table").DataTable().clear().rows.add(s).draw();try{localStorage.setItem("data",generateExportData())}catch(e){}return!0}function generateExportData(){var e=new Object,a=new Array,t=$("#recipe-table").DataTable().data().toArray();for(var i in t){var c=new Object;c.id=t[i].recipeId,c.rank=t[i].rank,c.got=t[i].got,a.push(c)}e.recipes=a;var l=new Array,s=$("#chef-table").DataTable().data().toArray();for(var i in s){var r=new Object;r.id=s[i].chefId,r.got=s[i].got,l.push(r)}return e.chefs=l,JSON.stringify(e)}function initCalTables(e){initCalRules(e),initCalRecipesTable(e),initCalChefsTable(e),initCalEquipsTable(e),initCalMaterialsTable(e),initCalResultsTable(e),initCalSelfSelect(e),$.fn.dataTable.ext.order["dom-selected"]=function(e,a){return this.api().column(a,{order:"index"}).nodes().map(function(e,a){return $(e).parent("tr").hasClass("selected")?"1":"0"})},$("#pane-cal-results-common").remove()}function initCalRules(e){var a,t=new Worker("js/cal.js");t.onmessage=function(e){$("#select-cal-rule").append(e.data)},t.postMessage({mode:"get-rules-options"}),$("#btn-cal-rule-load").click(function(){var t=Math.floor($("#select-cal-rule").val());t?($("#input-rule-id").val(t),$("#btn-cal-rule-load").prop("disabled",!0),$("#pane-cal-rules .cal-results-progress").removeClass("hidden"),void 0!==a&&(a.terminate(),a=void 0),(a=new Worker("js/cal.js")).onmessage=function(a){var i;$("#cal-recipes-table").DataTable().clear().rows.add(a.data.recipes).draw(),$("#cal-recipes-table").DataTable().rows().select(),$("#cal-chefs-table").DataTable().clear().rows.add(a.data.chefs).draw(),$("#cal-chefs-table").DataTable().rows().select(),$("#cal-materials-table").DataTable().clear().rows.add(a.data.materials).draw(),$("#cal-materials-table").DataTable().rows().select(),$("#cal-equips-table").DataTable().clear().rows.add(a.data.equips).draw(),$("#cal-equips-table").DataTable().rows().select();var c=getChefsOptions(a.data.chefs),l=getRecipesOptions(a.data.recipes),s=getEquipsOptions(e.equips);$("#cal-self-select-table").DataTable().MakeCellsEditable("destroy"),$("#cal-self-select-table").DataTable().MakeCellsEditable({columns:[1,10,20,24],inputTypes:[{column:1,type:"list",search:!0,options:c},{column:10,type:"list",search:!0,options:l},{column:24,type:"list",search:!0,options:s}],onUpdate:function(a,c,l){void 0!==i&&(i.terminate(),i=void 0),(i=new Worker("js/cal.js")).onmessage=function(e){a.clear().rows.add(e.data).draw(),$(a.body()).removeClass("processing")};var s=$("#cal-recipes-table").DataTable().data().toArray(),r=$("#cal-chefs-table").DataTable().data().toArray(),n=$("#cal-equips-table").DataTable().data().toArray(),o=$("#cal-materials-table").DataTable().data().toArray(),p=a.data().toArray();i.postMessage({mode:"custom",rule:t,recipes:s,chefs:r,equips:n,materials:o,odata:e,custom:p})},waitUpdate:!0}),$("#pane-cal-rules .cal-results-progress").addClass("hidden"),$("#btn-cal-rule-load").prop("disabled",!1)},a.postMessage({mode:"get-rules-data",rule:t,odata:e})):alert("请选择规则")})}function initCalRecipesTable(e){var a=[{data:void 0,defaultContent:"",className:"select-checkbox",orderDataType:"dom-selected",width:"30px"},{data:"recipeId"},{data:"name"},{data:{_:"rarity",display:"rarityDisp"}},{data:"stirfry"},{data:"boil"},{data:"knife"},{data:"fry"},{data:"bake"},{data:"steam"},{data:{_:"materialsVal",display:"materialsDisp"}},{data:"price"},{data:"limit"},{data:"totalPrice"},{data:"origin"},{data:"tagsDisp",defaultContent:""},{data:"addition",className:"cal-td-input-addition",width:"38px"}],t=$("#cal-recipes-table").DataTable({data:new Array,columns:a,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"共 _MAX_ 个菜谱",infoEmpty:"没有数据",infoFiltered:"",select:{rows:{_:"选择了 %d 个菜谱",0:"选择了 %d 个菜谱",1:"选择了 %d 个菜谱"}}},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},autoWidth:!1,createdRow:function(e,a,t){$(e).addClass("rarity-"+a.rarity)}});$("#pane-cal-recipes div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="菜名 材料"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("cal-recipes-table"))return!0;for(var i=$("#pane-cal-recipes .search-box input").val(),c=[2,10,15],l=0,s=c.length;l<s;l++)if(-1!==a[c[l]].indexOf(i))return!0;return!1}),t.MakeCellsEditable({columns:[16]}),$(".chk-cal-recipes-show").click(function(){initCalRecipesShow(t)}),$('.chk-cal-recipes-rarity input[type="checkbox"]').click(function(){var e=$(this).attr("data-rarity");$(this).prop("checked")?t.rows(".rarity-"+e).select():t.rows(".rarity-"+e).deselect()}),$("#pane-cal-recipes .search-box input").keyup(function(){t.draw()}),$("#btn-cal-recipes-select-all").click(function(){$('.chk-cal-recipes-rarity input[type="checkbox"]').prop("checked",!0),t.rows().select()}),$("#btn-cal-recipes-deselect-all").click(function(){$('.chk-cal-recipes-rarity input[type="checkbox"]').prop("checked",!1),t.rows().deselect()}),initCalRecipesShow(t)}function initCalChefsTable(e){var a=[{data:void 0,defaultContent:"",className:"select-checkbox",orderDataType:"dom-selected",width:"30px"},{data:{_:"chefId",display:"chefIdDisp"}},{data:"name"},{data:{_:"rarity",display:"rarityDisp"}},{data:"stirfry"},{data:"boil"},{data:"knife"},{data:"fry"},{data:"bake"},{data:"steam"},{data:{_:"specialSkillVal",display:"specialSkillDisp"}},{data:"sex"},{data:"origin"},{data:"tagsDisp",defaultContent:""},{data:"addition",className:"cal-td-input-addition",width:"38px"},{data:"equipName",className:"cal-td-select-equip",width:"101px"}],t=$("#cal-chefs-table").DataTable({data:new Array,columns:a,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"共 _MAX_ 个厨师",infoEmpty:"没有数据",infoFiltered:"",select:{rows:{_:"选择了 %d 个厨师",0:"选择了 %d 个厨师",1:"选择了 %d 个厨师"}}},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},autoWidth:!1,createdRow:function(e,a,t){$(e).addClass("rarity-"+a.rarity)}});$("#pane-cal-chefs div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="名字 性别"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("cal-chefs-table"))return!0;for(var i=$("#pane-cal-chefs .search-box input").val(),c=[2,11,13],l=0,s=c.length;l<s;l++)if(-1!==a[c[l]].indexOf(i))return!0;return!1});var i=getEquipsOptions(e.equips);t.MakeCellsEditable({columns:[14,15],inputTypes:[{column:15,type:"list",search:!0,options:i}]}),$(".chk-cal-chefs-show").click(function(){initCalChefsShow(t)}),$('.chk-cal-chefs-rarity input[type="checkbox"]').click(function(){var e=$(this).attr("data-rarity");$(this).prop("checked")?t.rows(".rarity-"+e).select():t.rows(".rarity-"+e).deselect()}),$("#btn-cal-chefs-equip-clear").click(function(){t.rows().every(function(e,a,t){this.cell(e,".cal-td-select-equip").data("")})}),$("#pane-cal-chefs .search-box input").keyup(function(){t.draw()}),$("#btn-cal-chefs-select-all").click(function(){$('.chk-cal-chefs-rarity input[type="checkbox"]').prop("checked",!0),t.rows().select()}),$("#btn-cal-chefs-deselect-all").click(function(){$('.chk-cal-chefs-rarity input[type="checkbox"]').prop("checked",!1),t.rows().deselect()}),initCalChefsShow(t)}function initCalEquipsTable(e){var a=[{data:void 0,defaultContent:"",className:"select-checkbox",orderDataType:"dom-selected",width:"30px"},{data:"equipId"},{data:"name"},{data:{_:"rarity",display:"rarityDisp"}},{data:{_:"skillVal",display:"skillDisp"}},{data:"origin"}],t=$("#cal-equips-table").DataTable({data:new Array,columns:a,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"共 _MAX_ 个厨具",infoEmpty:"没有数据",infoFiltered:"",select:{rows:{_:"选择了 %d 个厨具",0:"选择了 %d 个厨具",1:"选择了 %d 个厨具"}}},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},order:[[4,"desc"]],autoWidth:!1,createdRow:function(e,a,t){$(e).addClass("rarity-"+a.rarity)}});$("#pane-cal-equips div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="名字 技能 来源"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("cal-equips-table"))return!0;for(var i=$("#pane-cal-equips .search-box input").val(),c=[2,4,5],l=0,s=c.length;l<s;l++)if(-1!==a[c[l]].indexOf(i))return!0;return!1}),$(".chk-cal-equips-show").click(function(){initCalEquipsShow(t)}),$('.chk-cal-equips-rarity input[type="checkbox"]').click(function(){var e=$(this).attr("data-rarity");$(this).prop("checked")?t.rows(".rarity-"+e).select():t.rows(".rarity-"+e).deselect()}),$("#pane-cal-equips .search-box input").keyup(function(){t.draw()}),$("#btn-cal-equips-select-all").click(function(){$('.chk-cal-equips-origin input[type="checkbox"]').prop("checked",!0),t.rows().select()}),$("#btn-cal-equips-deselect-all").click(function(){$('.chk-cal-equips-origin input[type="checkbox"]').prop("checked",!1),t.rows().deselect()}),initCalEquipsShow(t)}function initCalMaterialsTable(e){var a=[{data:void 0,defaultContent:"",className:"select-checkbox",orderDataType:"dom-selected",width:"30px"},{data:"materialId"},{data:"name"},{data:{_:"rarity",display:"rarityDisp"}},{data:"origin"},{data:"quantity",className:"cal-td-input-quantity",width:"38px"},{data:"addition",className:"cal-td-input-addition",width:"38px"}],t=$("#cal-materials-table").DataTable({data:new Array,columns:a,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"共 _MAX_ 个食材",infoEmpty:"没有数据",infoFiltered:"",select:{rows:{_:"选择了 %d 个食材",0:"选择了 %d 个食材",1:"选择了 %d 个食材"}}},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},order:[[4,"desc"]],autoWidth:!1,createdRow:function(e,a,t){$(e).addClass("origin-"+a.originVal)}});$("#pane-cal-materials div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="名字 来源"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("cal-materials-table"))return!0;for(var i=$("#pane-cal-materials .search-box input").val(),c=[2,4],l=0,s=c.length;l<s;l++)if(-1!==a[c[l]].indexOf(i))return!0;return!1}),t.MakeCellsEditable({columns:[5,6]}),$(".chk-cal-materials-show").click(function(){initCalMaterialsShow(t)}),$('.chk-cal-materials-origin input[type="checkbox"]').click(function(){var e=$(this).attr("data-origin");$(this).prop("checked")?t.rows(".origin-"+e).select():t.rows(".origin-"+e).deselect()}),$("#pane-cal-materials .search-box input").keyup(function(){t.draw()}),$("#btn-cal-materials-select-all").click(function(){$('.chk-cal-materials-origin input[type="checkbox"]').prop("checked",!0),t.rows().select()}),$("#btn-cal-materials-deselect-all").click(function(){$('.chk-cal-materials-origin input[type="checkbox"]').prop("checked",!1),t.rows().deselect()}),initCalMaterialsShow(t)}function initCalResultsTable(e){var a,t,i;$("#cal-recipes-results-place").html($("#pane-cal-results-common").html()),$("#cal-recipes-results-place .cal-results-table").prop("id","cal-recipes-results-table"),$("#cal-recipes-results-place .chk-cal-results-show-selected").bootstrapToggle(),$("#cal-all-results-place").html($("#pane-cal-results-common").html()),$("#cal-all-results-place .cal-results-table").prop("id","cal-all-results-table"),$("#cal-all-results-place .chk-cal-results-show-selected").bootstrapToggle(),$("#cal-optimal-results-place").html($("#pane-cal-results-common").html()),$("#cal-optimal-results-place .cal-results-table").prop("id","cal-optimal-results-table"),$("#cal-optimal-results-place .chk-cal-results-show-selected").remove(),initCalResultTableCommon("recipes",new Array,$("#pane-cal-recipes-results")),initCalResultTableCommon("all",new Array,$("#pane-cal-all-results")),initCalResultTableCommon("optimal",new Array,$("#pane-cal-optimal-results")),$(".btn-cal-results-cal").click(function(){var c=Math.floor($("#input-rule-id").val());if(c){var l,s,r=$(this).closest(".pane-cal-results");if("pane-cal-all-results"==r.prop("id"))s="all",l=t;else if("pane-cal-optimal-results"==r.prop("id"))s="optimal",l=i;else{if("pane-cal-recipes-results"!=r.prop("id"))return;s="recipes",l=a}if(void 0!==l&&(l.terminate(),l=void 0),$(this).hasClass("stop"))return r.find(".cal-results-progress").addClass("hidden"),r.find(".btn-cal-results-cal.start").prop("disabled",!1),void r.find(".btn-cal-results-cal.stop").prop("disabled",!0);r.find(".btn-cal-results-cal.start").prop("disabled",!0),r.find(".btn-cal-results-cal.stop").prop("disabled",!1),r.find(".cal-results-wrapper").addClass("hidden"),r.find(".cal-results-progress .progress-bar").css("width","0%"),r.find(".cal-results-progress .progress-bar span").text("预处理中"),r.find(".cal-results-progress").removeClass("hidden"),l=new Worker("js/cal.js"),"all"==s?t=l:"optimal"==s?i=l:"recipes"==s&&(a=l),l.onmessage=function(e){e.data.progress?(r.find(".cal-results-progress .progress-bar").css("width",e.data.progress.value+"%"),r.find(".cal-results-progress .progress-bar span").text(e.data.progress.display)):e.data.menu?(e.data.message?r.find(".selected-sum").html(e.data.message):r.find(".selected-sum").html("点击可选择"),"all"==s?(r.find(".chk-cal-results-show-selected").prop("checked",!1),$("#cal-all-results-table").DataTable().clear().rows.add(e.data.menu).draw()):"optimal"==s?($("#cal-optimal-results-table").DataTable().clear().rows.add(e.data.menu).draw(),$("#cal-optimal-results-table").DataTable().rows().select()):"recipes"==s&&(r.find(".chk-cal-results-show-selected").prop("checked",!1),$("#cal-recipes-results-table").DataTable().clear().rows.add(e.data.menu).draw()),r.find(".cal-results-wrapper").removeClass("hidden")):e.data.done&&(r.find(".btn-cal-results-cal.stop").prop("disabled",!0),r.find(".btn-cal-results-cal.start").prop("disabled",!1),r.find(".cal-results-progress").addClass("hidden"))};var n=$("#cal-recipes-table").DataTable().rows({selected:!0}).data().toArray(),o=$("#cal-chefs-table").DataTable().rows({selected:!0}).data().toArray(),p=$("#cal-equips-table").DataTable().rows({selected:!0}).data().toArray(),d=$("#cal-materials-table").DataTable().rows({selected:!0}).data().toArray(),h=Math.floor($("#input-cal-all-results-show-top").val()),u=$("#chk-cal-results-equips").prop("checked");l.postMessage({mode:s,rule:c,recipes:n,chefs:o,equips:p,materials:d,odata:e,allLimit:h,autoEquips:u})}else alert("请加载规则")})}function initCalResultTableCommon(e,a,t){var i=[{data:void 0,defaultContent:"",className:"select-checkbox",orderDataType:"dom-selected",width:"30px"},{data:"chef.name",className:"cal-td-chef-name",defaultContent:""},{data:{_:"chef.rarity",display:"chef.rarityDisp"},defaultContent:""},{data:"chef.sex",defaultContent:""},{data:"chef.stirfry",defaultContent:""},{data:"chef.boil",defaultContent:""},{data:"chef.knife",defaultContent:""},{data:"chef.fry",defaultContent:""},{data:"chef.bake",defaultContent:""},{data:"chef.steam",defaultContent:""},{data:"recipe.data.name",className:"cal-td-recipe-name",defaultContent:""},{data:{_:"recipe.data.rarity",display:"recipe.data.rarityDisp"},defaultContent:""},{data:"recipe.data.stirfry",defaultContent:""},{data:"recipe.data.boil",defaultContent:""},{data:"recipe.data.knife",defaultContent:""},{data:"recipe.data.fry",defaultContent:""},{data:"recipe.data.bake",defaultContent:""},{data:"recipe.data.steam",defaultContent:""},{data:{_:"recipe.data.materialsVal",display:"recipe.data.materialsDisp"},defaultContent:""},{data:"recipe.data.price",defaultContent:""},{data:"recipe.quantity",className:"cal-td-quantity",defaultContent:"",width:"38px"},{data:{_:"recipe.rankVal",display:"recipe.rankDisp"},defaultContent:""},{data:{_:"recipe.rankAddition",display:"recipe.rankAdditionDisp"},defaultContent:""},{data:{_:"recipe.chefSkillAddition",display:"recipe.chefSkillAdditionDisp"},defaultContent:""},{data:"equip.disp",className:"cal-td-equip-name",defaultContent:""},{data:{_:"recipe.equipSkillAddition",display:"recipe.equipSkillAdditionDisp"},defaultContent:""},{data:{_:"recipe.otherAddition",display:"recipe.otherAdditionDisp"},defaultContent:""},{data:"recipe.totalPrice",defaultContent:""},{data:"recipe.realTotalPrice",defaultContent:""},{data:"recipe.bonusScore",defaultContent:""},{data:"recipe.totalScore",defaultContent:""}],c=!0;"optimal"!=e&&"self-select"!=e||(c=!1);var l=[[30,"desc"]];"self-select"==e&&(l=[]);var s=t.find(".cal-results-table").DataTable({data:a,columns:i,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 条",zeroRecords:"没有找到",info:"共 _TOTAL_ 条",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 条中过滤)",select:{rows:{_:"选择了 %d 条",0:"选择了 %d 条",1:"选择了 %d 条"}}},paging:c,pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-12'<'selected-sum'>>><'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},autoWidth:!1,order:l});if(t.find(".selected-sum").html("点击可选择"),"all"==e||"recipes"==e){t.find("div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="厨师 菜名 材料"></label>'),t.find(".search-box input").keyup(function(){s.draw()}),t.find(".chk-cal-results-show-selected").prop("checked",!1);var r="",n="";t.find(".chk-cal-results-show-selected").change(function(){$(this).prop("checked")?(r=t.find(".search-box input").val(),t.find(".search-box input").val(n)):(n=t.find(".search-box input").val(),t.find(".search-box input").val(r)),s.draw()})}return s.on("select deselect",function(a,i,c,l){if("row"===c){var r=i.rows({selected:!0}).indexes(),n="原售价："+i.cells(r,27).data().reduce(function(e,a){return e+a},0);if("all"==e||"optimal"==e||"self-select"==e)n+=" 实售价："+i.cells(r,28).data().reduce(function(e,a){return e+a},0);n+=" 规则分："+i.cells(r,29).data().reduce(function(e,a){return e+a},0),n+=" 总得分："+i.cells(r,30).data().reduce(function(e,a){return e+a},0),t.find(".selected-sum").html(n),"all"!=e&&"recipes"!=e||t.find(".chk-cal-results-show-selected").prop("checked")&&s.draw()}}),t.find(".chk-cal-results-show").click(function(){initCalResultsShow(e,s,t)}),t.find(".chk-cal-results-show-all").click(function(){t.find(".btn:not(.hidden) .chk-cal-results-show:checked").length==t.find(".btn:not(.hidden) .chk-cal-results-show").length?t.find(".btn:not(.hidden) .chk-cal-results-show").prop("checked",!1):t.find(".btn:not(.hidden) .chk-cal-results-show").prop("checked",!0),initCalResultsShow(e,s,t)}),"all"==e?($.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("cal-all-results-table"))return!0;for(var i=$("#pane-cal-all-results .search-box input").val(),c=[1,10,18],l=0,s=c.length;l<s;l++)if(-1!==a[c[l]].indexOf(i))return!0;return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("cal-all-results-table"))return!0;if($("#pane-cal-all-results .chk-cal-results-show-selected").prop("checked")){var i=e.aoData[t].nTr;return!!$(i).hasClass("selected")}return!0})):"recipes"==e&&($.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("cal-recipes-results-table"))return!0;for(var i=$("#pane-cal-recipes-results .search-box input").val(),c=[1,10,18],l=0,s=c.length;l<s;l++)if(-1!==a[c[l]].indexOf(i))return!0;return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("cal-recipes-results-table"))return!0;if($("#pane-cal-recipes-results .chk-cal-results-show-selected").prop("checked")){var i=e.aoData[t].nTr;return!!$(i).hasClass("selected")}return!0})),initCalResultsShow(e,s,t),s}function initCalSelfSelect(e){$("#cal-self-select-place").html($("#pane-cal-results-common").html()),$("#cal-self-select-place .cal-results-table").prop("id","cal-self-select-table"),$("#cal-self-select-place .chk-cal-results-show-selected").remove(),$("#cal-self-select-place .chk-cal-results-show-chef-equip").prop("checked",!0);for(var a=new Array,t=0;t<9;t++){var i=new Object;i.chef=new Object,i.recipe=new Object,i.recipe.data=new Object,i.equip=new Object,a.push(i)}initCalResultTableCommon("self-select",a,$("#pane-cal-self-select"));$("#pane-cal-self-select").find(".cal-results-wrapper").removeClass("hidden")}function generateData(e,a){var t;try{var i=localStorage.getItem("data");t=JSON.parse(i)}catch(e){}a&&(e.equips=e.equips.concat(a.equips),e.quests=e.quests.concat(a.quests),e.recipes=e.recipes.concat(a.recipes),e.chefs=e.chefs.concat(a.chefs));var c=new Object;c.history=e.history;var l=new Array;for(var s in e.materials){var r=e.materials[s];r.rarityDisp=getRarityDisp(e.materials[s].rarity),r.originVal=getOriginVal(e.materials[s].origin),r.addition="",r.quantity="",l.push(r)}c.materials=l;var n=new Array;for(var s in e.equips)if(e.equips[s].name){var o=e.equips[s];o.rarityDisp=getRarityDisp(e.equips[s].rarity),o.cal=isCalEquip(e.equips[s].skill);var p=getSkillInfo(e.equips[s].skill);o.skillVal=p.skillVal,o.skillDisp=p.skillDisp,n.push(o)}c.equips=n;var d=new Array;for(var s in e.quests)if(e.quests[s].goal){var h=e.quests[s],u="",f="";for(var k in e.quests[s].rewards)u+=e.quests[s].rewards[k].name,e.quests[s].rewards[k].quantity&&(u+="*"+e.quests[s].rewards[k].quantity),u+=" ",f+=e.quests[s].rewards[k].name;h.rewardsVal=f,h.rewardsDisp=u,d.push(h)}c.quests=d;var m=new Array;for(var s in e.chefs)if(e.chefs[s].name){var b=e.chefs[s];b.recipes=new Array,b.stirfry=e.chefs[s].stirfry||"",b.boil=e.chefs[s].boil||"",b.knife=e.chefs[s].knife||"",b.fry=e.chefs[s].fry||"",b.bake=e.chefs[s].bake||"",b.steam=e.chefs[s].steam||"",b.meat=e.chefs[s].meat||"",b.creation=e.chefs[s].creation||"",b.veg=e.chefs[s].veg||"",b.fish=e.chefs[s].fish||"",b.addition="",b.equipName="",b.chefIdDisp=e.chefs[s].chefId-2+" - "+e.chefs[s].chefId,b.rarityDisp=getRarityDisp(e.chefs[s].rarity);p=getSkillInfo(e.chefs[s].skill);if(b.specialSkillVal=p.skillVal,b.specialSkillDisp=p.skillDisp,a)for(var k in a.chefsTags)e.chefs[s].chefId==a.chefsTags[k].chefId&&(b.tags=a.chefsTags[k].tags,b.tagsDisp=getTagsDisp(a.chefsTags[k].tags,a.tags));if(b.got="",t)for(var k in t.chefs)if(e.chefs[s].chefId==t.chefs[k].id){t.chefs[k].hasOwnProperty("got")&&(b.got=t.chefs[k].got);break}m.push(b)}c.chefs=m;var g=new Array;for(var s in e.recipes)if(e.recipes[s].name){var $=new Object;if(($=e.recipes[s]).stirfry=e.recipes[s].stirfry||"",$.boil=e.recipes[s].boil||"",$.knife=e.recipes[s].knife||"",$.fry=e.recipes[s].fry||"",$.bake=e.recipes[s].bake||"",$.steam=e.recipes[s].steam||"",$.price=e.recipes[s].price||"",$.limit=e.recipes[s].limit||"",$.addition="",$.timeDisp=secondsToTime(e.recipes[s].time),$.rarityDisp=getRarityDisp(e.recipes[s].rarity),a)for(var k in a.recipesTags)e.recipes[s].recipeId==a.recipesTags[k].recipeId&&($.tags=a.recipesTags[k].tags,$.tagsDisp=getTagsDisp(a.recipesTags[k].tags,a.tags));if($.rank="",$.got="",t)for(var k in t.recipes)if(e.recipes[s].recipeId==t.recipes[k].id){t.recipes[k].hasOwnProperty("rank")&&($.rank=t.recipes[k].rank),t.recipes[k].hasOwnProperty("got")&&($.got=t.recipes[k].got);break}var w=0,v=0,y=0;e.recipes[s].price>0&&e.recipes[s].time>0&&(y=3600*e.recipes[s].price/e.recipes[s].time,e.recipes[s].limit>0&&(w=e.recipes[s].price*e.recipes[s].limit,v=e.recipes[s].time*e.recipes[s].limit)),$.totalPrice=w||"",$.totalTime=v,$.totalTimeDisp=secondsToTime(v),$.efficiency=y?Math.floor(y):"";var x=getMaterialsInfo(e.recipes[s]);$.materialsVal=x.materialsVal,$.materialsDisp=x.materialsDisp;var T=0;e.recipes[s].time>0&&(T=3600*x.materialsCount/e.recipes[s].time),$.materialsEff=T?Math.floor(T):"";var q=getRankGuestInfo(e.recipes[s],$.rank);$.rankGuestsVal=q.rankGuestsVal,$.rankGuestsDisp=q.rankGuestsDisp;var C="";for(var D in e.guests)for(var E in e.guests[D].gifts)if(e.recipes[s].name==e.guests[D].gifts[E].recipe){C+=e.guests[D].name+"-"+e.guests[D].gifts[E].antique+"<br>";break}$.guestsDisp=C,$.chefs=new Array;var O=0,_="";for(var k in c.chefs){var M,I=getRankInfo(e.recipes[s],c.chefs[k]),A=0;if(I.rankVal>0){var S=getSkillAddition(e.recipes[s],c.chefs[k].skill,c.materials);y>0&&(A=(1+I.rankAddition+S)*y)}O<A?(O=A,_=c.chefs[k].name+"["+I.rankDisp+"]"):O===A&&(_+=","+c.chefs[k].name+"["+I.rankDisp+"]"),(M=new Object).rankVal=I.rankVal,M.rankDisp=I.rankDisp,M.efficiency=Math.floor(A)||"",$.chefs.push(M);var R=new Object;R.rankVal=I.rankVal,R.rankDisp=I.rankDisp,c.chefs[k].recipes.push(R)}(M=new Object).qualityDisp=O?_:"-",M.efficiency=Math.floor(O)||"",$.chefs.push(M),g.push($)}return c.recipes=g,c}function getQuestsData(e,a){var t=new Array;for(var i in e)e[i].type==a&&t.push(e[i]);return t}function getMaterialsInfo(e){var a=new Object,t="",i="",c=0;for(var l in e.materials)e.materials[l].name&&(t+=e.materials[l].name+"*"+e.materials[l].quantity+" ",i+=e.materials[l].name,c+=e.materials[l].quantity);return a.materialsDisp=t,a.materialsVal=i,a.materialsCount=c,a}function getRarityDisp(e){for(var a="",t=0;t<e;t++)a+="&#x2605;";return a}function getTagsDisp(e,a){var t="";for(var i in e)for(var c in a)if(e[i]==a[c].Id){t+=a[c].name+" ";break}return t}function isCalEquip(e){for(var a in e)if(e[a].type.indexOf("料理")>=0||e[a].type.indexOf("金币获得")>=0||e[a].type.indexOf("技法")>=0)return!0;return!1}function getOriginVal(e){var a=0;return"菜棚"==e?a=1:"菜地"==e?a=2:"森林"==e?a=3:"鸡舍"==e?a=4:"猪圈"==e?a=5:"牧场"==e?a=6:"作坊"==e?a=7:"鱼塘"==e&&(a=8),a}function getRankGuestInfo(e,a){var t="",i="",c=$("#chk-recipe-filter-guest").prop("checked");for(var l in e.guests)c&&("优"==a&&"优"==e.guests[l].rank||"特"==a&&"神"!=e.guests[l].rank||"神"==a)||(t+=e.guests[l].rank+"-"+e.guests[l].guest+"<br>",i+=e.guests[l].guest);var s=new Object;return s.rankGuestsVal=i,s.rankGuestsDisp=t,s}function getRankOptions(){var e=new Array,a=new Object;return a.display="",a.value="",e.push(a),(a=new Object).display="优",a.value="优",e.push(a),(a=new Object).display="特",a.value="特",e.push(a),(a=new Object).display="神",a.value="神",e.push(a),e}function getGotOptions(){var e=new Array,a=new Object;return a.display="否",a.value="",e.push(a),(a=new Object).display="是",a.value="是",e.push(a),e}function getEquipsOptions(e){var a=new Array,t=new Object;for(var i in t.display="无厨具",t.subtext="",t.tokens="",t.value="",a.push(t),e){var c=getSkillInfo(e[i].skill).skillDisp.replace("<br>"," ");(t=new Object).display=e[i].name,t.subtext=c,t.tokens=e[i].name+c,t.value=e[i].name,a.push(t)}return a}function getChefsOptions(e){var a=new Array,t=new Object;for(var i in t.display="无厨师",t.value="",a.push(t),e){(t=new Object).display=e[i].name,t.value=e[i].name,a.push(t)}return a}function getRecipesOptions(e){var a=new Array,t=new Object;for(var i in t.display="无菜谱",t.value="",a.push(t),e){(t=new Object).display=e[i].name,t.value=e[i].name,a.push(t)}return a}function initRecipeShow(e,a){e.column(0).visible($("#chk-recipe-show-id").prop("checked"),!1),e.column(2).visible($("#chk-recipe-show-rarity").prop("checked"),!1);var t=$("#chk-recipe-show-skill").prop("checked");e.column(3).visible(t,!1),e.column(4).visible(t,!1),e.column(5).visible(t,!1),e.column(6).visible(t,!1),e.column(7).visible(t,!1),e.column(8).visible(t,!1),e.column(9).visible($("#chk-recipe-show-materials").prop("checked"),!1),e.column(10).visible($("#chk-recipe-show-price").prop("checked"),!1),e.column(11).visible($("#chk-recipe-show-time").prop("checked"),!1),e.column(12).visible($("#chk-recipe-show-limit").prop("checked"),!1),e.column(13).visible($("#chk-recipe-show-total-price").prop("checked"),!1),e.column(14).visible($("#chk-recipe-show-total-time").prop("checked"),!1),e.column(15).visible($("#chk-recipe-show-efficiency").prop("checked"),!1),e.column(16).visible($("#chk-recipe-show-materials-efficiency").prop("checked"),!1),e.column(17).visible($("#chk-recipe-show-origin").prop("checked"),!1),e.column(18).visible($("#chk-recipe-show-unlock").prop("checked"),!1),private?e.column(19).visible($("#chk-recipe-show-tags").prop("checked"),!1):e.column(19).visible(!1,!1),e.column(20).visible($("#chk-recipe-show-guest").prop("checked"),!1),e.column(21).visible($("#chk-recipe-show-rank-guest").prop("checked"),!1),e.column(22).visible($("#chk-recipe-show-god-antique").prop("checked"),!1),e.column(23).visible($("#chk-recipe-show-rank").prop("checked"),!1),e.column(24).visible($("#chk-recipe-show-got").prop("checked"),!1);for(var i=$("#chk-recipe-show-chef").val(),c=0;c<a.chefs.length;c++)e.column(25+2*c).visible(i.indexOf(c.toString())>-1,!1),e.column(26+2*c).visible(i.indexOf(c.toString())>-1,!1);e.columns.adjust().draw(!1)}function initChefShow(e,a){e.column(0).visible($("#chk-chef-show-id").prop("checked"),!1),e.column(2).visible($("#chk-chef-show-rarity").prop("checked"),!1);var t=$("#chk-chef-show-skill").prop("checked");e.column(3).visible(t,!1),e.column(4).visible(t,!1),e.column(5).visible(t,!1),e.column(6).visible(t,!1),e.column(7).visible(t,!1),e.column(8).visible(t,!1),e.column(9).visible($("#chk-chef-show-special-skill").prop("checked"),!1);var i=$("#chk-chef-show-harvest").prop("checked");e.column(10).visible(i,!1),e.column(11).visible(i,!1),e.column(12).visible(i,!1),e.column(13).visible(i,!1),e.column(14).visible($("#chk-chef-show-sex").prop("checked"),!1),e.column(15).visible($("#chk-chef-show-origin").prop("checked"),!1),private?e.column(16).visible($("#chk-chef-show-tags").prop("checked"),!1):e.column(16).visible(!1,!1),e.column(17).visible($("#chk-chef-show-got").prop("checked"),!1);for(var c=$("#chk-chef-show-recipe").val(),l=0;l<a.recipes.length;l++)e.column(18+l).visible(c.indexOf(l.toString())>-1,!1);e.columns.adjust().draw(!1)}function initEquipShow(e){e.column(0).visible($("#chk-equip-show-id").prop("checked"),!1),e.column(2).visible($("#chk-equip-show-rarity").prop("checked"),!1),e.column(3).visible($("#chk-equip-show-special-skill").prop("checked"),!1),e.column(4).visible($("#chk-equip-show-origin").prop("checked"),!1),e.columns.adjust().draw(!1)}function initCalRecipesShow(e){e.column(1).visible($("#chk-cal-recipes-show-id").prop("checked"),!1),e.column(3).visible($("#chk-cal-recipes-show-rarity").prop("checked"),!1);var a=$("#chk-cal-recipes-show-skill").prop("checked");e.column(4).visible(a,!1),e.column(5).visible(a,!1),e.column(6).visible(a,!1),e.column(7).visible(a,!1),e.column(8).visible(a,!1),e.column(9).visible(a,!1),e.column(10).visible($("#chk-cal-recipes-show-material").prop("checked"),!1),e.column(11).visible($("#chk-cal-recipes-show-price").prop("checked"),!1),e.column(12).visible($("#chk-cal-recipes-show-limit").prop("checked"),!1),e.column(13).visible($("#chk-cal-recipes-show-total-price").prop("checked"),!1),e.column(14).visible($("#chk-cal-recipes-show-origin").prop("checked"),!1),e.column(15).visible($("#chk-cal-recipes-show-tags").prop("checked"),!1),e.columns.adjust().draw(!1)}function initCalChefsShow(e){e.column(1).visible($("#chk-cal-chefs-show-id").prop("checked"),!1),e.column(3).visible($("#chk-cal-chefs-show-rarity").prop("checked"),!1);var a=$("#chk-cal-chefs-show-skill").prop("checked");e.column(4).visible(a,!1),e.column(5).visible(a,!1),e.column(6).visible(a,!1),e.column(7).visible(a,!1),e.column(8).visible(a,!1),e.column(9).visible(a,!1),e.column(10).visible($("#chk-cal-chefs-show-special-skill").prop("checked"),!1),e.column(11).visible($("#chk-cal-chefs-show-sex").prop("checked"),!1),e.column(12).visible($("#chk-cal-chefs-show-origin").prop("checked"),!1),e.column(13).visible($("#chk-cal-chefs-show-tags").prop("checked"),!1),e.columns.adjust().draw(!1)}function initCalEquipsShow(e){e.column(1).visible($("#chk-cal-equips-show-id").prop("checked"),!1),e.column(3).visible($("#chk-cal-equips-show-rarity").prop("checked"),!1),e.column(4).visible($("#chk-cal-equips-show-special-skill").prop("checked"),!1),e.column(5).visible($("#chk-cal-equips-show-origin").prop("checked"),!1),e.columns.adjust().draw(!1)}function initCalMaterialsShow(e){e.column(1).visible($("#chk-cal-materials-show-id").prop("checked"),!1),e.column(3).visible($("#chk-cal-materials-show-rarity").prop("checked"),!1),e.column(4).visible($("#chk-cal-materials-show-origin").prop("checked"),!1),e.columns.adjust().draw(!1)}function initCalResultsShow(e,a,t){"recipes"==e&&(t.find(".chk-cal-results-show-chef-rarity").prop("checked",!1).closest(".btn").addClass("hidden"),t.find(".chk-cal-results-show-chef-sex").prop("checked",!1).closest(".btn").addClass("hidden"),t.find(".chk-cal-results-show-chef-skill").prop("checked",!1).closest(".btn").addClass("hidden"),t.find(".chk-cal-results-show-recipe-rank").prop("checked",!1).closest(".btn").addClass("hidden"),t.find(".chk-cal-results-show-chef-equip").prop("checked",!1).closest(".btn").addClass("hidden"),t.find(".chk-cal-results-show-chef-equip-addition").prop("checked",!1).closest(".btn").addClass("hidden"),t.find(".chk-cal-results-show-recipe-real-total-price").prop("checked",!1).closest(".btn").addClass("hidden"),a.column(1).visible(!1,!1),a.column(22).visible(!1,!1),a.column(23).visible(!1,!1)),a.column(2).visible(t.find(".chk-cal-results-show-chef-rarity").prop("checked"),!1),a.column(3).visible(t.find(".chk-cal-results-show-chef-sex").prop("checked"),!1);var i=t.find(".chk-cal-results-show-chef-skill").prop("checked");a.column(4).visible(i,!1),a.column(5).visible(i,!1),a.column(6).visible(i,!1),a.column(7).visible(i,!1),a.column(8).visible(i,!1),a.column(9).visible(i,!1),a.column(11).visible(t.find(".chk-cal-results-show-recipe-rarity").prop("checked"),!1);var c=t.find(".chk-cal-results-show-recipe-skill").prop("checked");a.column(12).visible(c,!1),a.column(13).visible(c,!1),a.column(14).visible(c,!1),a.column(15).visible(c,!1),a.column(16).visible(c,!1),a.column(17).visible(c,!1),a.column(18).visible(t.find(".chk-cal-results-show-recipe-material").prop("checked"),!1),a.column(21).visible(t.find(".chk-cal-results-show-recipe-rank").prop("checked"),!1),a.column(24).visible(t.find(".chk-cal-results-show-chef-equip").prop("checked"),!1),a.column(25).visible(t.find(".chk-cal-results-show-chef-equip-addition").prop("checked"),!1),a.column(26).visible(t.find(".chk-cal-results-show-bonus-addition").prop("checked"),!1),a.column(27).visible(t.find(".chk-cal-results-show-recipe-total-price").prop("checked"),!1),a.column(28).visible(t.find(".chk-cal-results-show-recipe-real-total-price").prop("checked"),!1),a.column(29).visible(t.find(".chk-cal-results-show-bonus-score").prop("checked"),!1),a.columns.adjust().draw(!1)}function initInfo(e){$("#pagination-history").pagination({dataSource:e.history,callback:function(e,a){var t=historyTemplate(e);$("#data-history").html(t)},pageSize:10,showPageNumbers:!1,showNavigator:!0,showPrevious:!0,showNext:!0})}function historyTemplate(e){var a="";return $.each(e,function(e,t){a+="<p>"+t+"</p>"}),a}function secondsToTime(e){e=Number(e);var a=Math.floor(e/3600/24),t=Math.floor(e/3600%24),i=Math.floor(e/60%60),c=Math.floor(e%60),l="";return a>0&&(l+=a+"天"),t>0&&(l+=t+"小时"),i>0&&(l+=i+"分"),c>0&&(l+=c+"秒"),l}function getInputHtml(e,a,t){var i,c,l;switch(l={type:"input",html:null},a.inputTypes&&$.each(a.inputTypes,function(a,t){t.column==e&&(c=(i=t).type.toLowerCase())}),c){case"list":var s="data-live-search='false'";i.search&&(s="data-live-search='true'"),l.html="<select "+s+" data-width='fit' data-dropdown-align-right='auto' data-live-search-placeholder='查找' data-none-results-text='没有找到' data-none-selected-text=''>",$.each(i.options,function(e,a){l.html=l.html+"<option value='"+a.value+"'",a.tokens&&(l.html+=" data-tokens='"+a.tokens+"'"),a.subtext&&(l.html+=" data-subtext='"+a.subtext+"'"),t==a.value&&(l.html+=" selected"),l.html+=">"+a.display+"</option>"}),l.html=l.html+"</select>",l.type=c;break;default:l.html="<input class='form-control' value='"+t+"'></input>"}return l}function sanitizeCellValue(e){return null==e||e.length<1?"":(isNaN(e)&&(e=e.replace(/'/g,"&#39;")),e)}$.fn.dataTable.Api.register("MakeCellsEditable()",function(e){var a=this.table();$.fn.extend({updateEditableCell:function(e,a){var t=$(e).closest("table").DataTable().table(),i=t.row($(e).parents("tr")),c=t.cell($(e).closest("td")),l=$(e).val();c.data(l),a.onUpdate&&a.onUpdate(t,i,c)}}),"destroy"===e&&($(a.body()).off("click","td"),a=null),null!=a&&$(a.body()).on("click","td",function(){if(!$(a.body()).hasClass("processing")){var t=a.cell(this).index().column;if(e.columns&&e.columns.indexOf(t)>-1||!e.columns){var i=a.cell(this).node(),c=a.cell(this).data();if(c=sanitizeCellValue(c),!$(i).find("input").length&&!$(i).find("select").length){e.waitUpdate&&$(a.body()).addClass("processing");var l=getInputHtml(t,e,c);$(i).html(l.html),"input"==l.type?$(i).find("input").select().focus().on("focusout",function(){$(this).updateEditableCell(this,e)}):"list"==l.type&&$(i).find("select").selectpicker("toggle").on("hidden.bs.select",function(a){$(this).updateEditableCell(this,e)})}}}})});