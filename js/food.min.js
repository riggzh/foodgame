function init(e){initFunction();var a;try{var t=localStorage.getItem("data");a=JSON.parse(t)}catch(e){}if(private)$.ajax({cache:!1,success:function(t){$.ajax({cache:!1,success:function(i){t=$.extend(t,i);var c=generateData(e,t,a);initTables(c,a)},error:function(){var i=generateData(e,t,a);initTables(i,a)},url:"private/data/data3.json"})},error:function(){var t=generateData(e,null,a);initTables(t,a)},url:"private/data/data2.json"});else{var i=generateData(e,null,a);initTables(i,a)}}function initFunction(){var e=getParameterByName("a");e&&"cb8f8a72f7e4924a75cb75a4a59c0b8d61e70c0cb84f84edf7ede4c8"==lcode(e)&&(private=!0,cal=!0);var a=getParameterByName("c");a&&"519526da9fa86daa1536b8e280527306eda91dec4a0c56e2c9f64444"==lcode(a)&&(cal=!0)}function initTables(e,a){updateMenu(e,a),initRecipeTable(e),initChefTable(e),initEquipTable(e),initQuestTable(e),initImportExport(e),cal&&(initCalTables(e),$(".nav-tabs li").removeClass("hidden"),$("#chk-recipe-show-tags").parent(".btn").removeClass("hidden"),$("#chk-chef-show-tags").parent(".btn").removeClass("hidden")),initInfo(e),$(".loading").addClass("hidden"),$(".main-function").removeClass("hidden")}function initRecipeTable(e){reInitRecipeTable(e),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("recipe-table"))return!0;var i=$("#chk-recipe-rarity-1").prop("checked"),c=$("#chk-recipe-rarity-2").prop("checked"),r=$("#chk-recipe-rarity-3").prop("checked"),l=$("#chk-recipe-rarity-4").prop("checked"),s=$("#chk-recipe-rarity-5").prop("checked"),n=Math.floor(a[2])||0;return!!(i&&1==n||c&&2==n||r&&3==n||l&&4==n||s&&5==n)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){return e.nTable!=document.getElementById("recipe-table")||!!($("#chk-recipe-skill-stirfry").prop("checked")&&(Math.floor(a[3])||0)>0||$("#chk-recipe-skill-boil").prop("checked")&&(Math.floor(a[4])||0)>0||$("#chk-recipe-skill-knife").prop("checked")&&(Math.floor(a[5])||0)>0||$("#chk-recipe-skill-fry").prop("checked")&&(Math.floor(a[6])||0)>0||$("#chk-recipe-skill-bake").prop("checked")&&(Math.floor(a[7])||0)>0||$("#chk-recipe-skill-steam").prop("checked")&&(Math.floor(a[8])||0)>0)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("recipe-table"))return!0;var i=$("#recipe-table").DataTable().row(t).data();return!!($("#chk-recipe-category-veg").prop("checked")&&i.veg||$("#chk-recipe-category-meat").prop("checked")&&i.meat||$("#chk-recipe-category-creation").prop("checked")&&i.creation||$("#chk-recipe-category-fish").prop("checked")&&i.fish)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("recipe-table"))return!0;var i=Math.floor($("#input-recipe-price").val()),c=Math.floor(a[10])||0;return""==$("#input-recipe-price").val()||i<c}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("recipe-table"))return!0;var i=$("#chk-recipe-guest").prop("checked"),c=a[20];return!!(!i||i&&c)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("recipe-table"))return!0;var i=$("#chk-recipe-no-origin").prop("checked"),c=a[17];return!!(i||!i&&c)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("recipe-table"))return!0;for(var i=$.trim($("#input-recipe-guest-antique").val()),c=[21,22],r=0,l=c.length;r<l;r++)if(a[c[r]].indexOf(i)!==-1)return!0;return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("recipe-table"))return!0;var i=$("#chk-recipe-got").prop("checked"),c=a[24];return!!(!i||i&&c)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("recipe-table"))return!0;for(var i=$.trim($("#pane-recipes .search-box input").val()),c=[0,1,9,17,19,20],r=0,l=c.length;r<l;r++)if(0==c[r]){if(a[c[r]]==i)return!0}else if(17==c[r]){if(a[c[r]].indexOf(i)!==-1&&a[c[r]].indexOf("神级")==-1)return!0}else if(a[c[r]].indexOf(i)!==-1)return!0;return!1});for(var a in e.materials)$("#chk-recipe-show-material").append("<option value='"+e.materials[a].materialId+"'>"+e.materials[a].name+"</option>");for(var a in e.chefs)$("#chk-recipe-show-chef").append("<option value='"+e.chefs[a].chefId+"'>"+e.chefs[a].name+"</option>");$("#chk-recipe-show-material").selectpicker().on("changed.bs.select",function(){updateRecipesMaterialsData(e),reInitRecipeTable(e),initRecipeShow()}),$("#chk-recipe-show-chef").selectpicker().on("changed.bs.select",function(){updateRecipesChefsData(e),reInitRecipeTable(e),initRecipeShow()}),$("#chk-recipe-show-skill-diff").click(function(){$("#chk-recipe-show-chef").val().length&&(updateRecipesChefsData(e),reInitRecipeTable(e),initRecipeShow())}),$(".chk-recipe-show").click(function(){initRecipeShow(),updateMenuLocalData()}),$("#chk-recipe-show-all").click(function(){$(".btn:not(.hidden) .chk-recipe-show:checked").length==$(".btn:not(.hidden) .chk-recipe-show").length?$(".btn:not(.hidden) .chk-recipe-show").prop("checked",!1):$(".btn:not(.hidden) .chk-recipe-show").prop("checked",!0),initRecipeShow(),updateMenuLocalData()}),$('.chk-recipe-rarity input[type="checkbox"]').click(function(){$("#recipe-table").DataTable().draw()}),$(".chk-recipe-skill").click(function(){$(this).prop("checked")&&$("#chk-recipe-single-skill").prop("checked")&&$(".chk-recipe-skill").not(this).prop("checked",!1),$("#recipe-table").DataTable().draw()}),$("#chk-recipe-single-skill").change(function(){$(this).prop("checked")&&$(".chk-recipe-skill:checked").length>1&&($(".chk-recipe-skill").prop("checked",!1),$("#recipe-table").DataTable().draw())}),$("#chk-recipe-skill-all").click(function(){$("#chk-recipe-single-skill").prop("checked")&&$("#chk-recipe-single-skill").bootstrapToggle("off"),$(".chk-recipe-skill").prop("checked",!0),$("#recipe-table").DataTable().draw()}),$('.chk-recipe-category input[type="checkbox"]').click(function(){$("#recipe-table").DataTable().draw()}),$("#input-recipe-price").keyup(function(){$("#recipe-table").DataTable().draw()}),$("#input-recipe-guest-antique").keyup(function(){$("#chk-recipe-show-rank-guest").prop("checked")||($("#chk-recipe-show-rank-guest").prop("checked",!0),initRecipeShow()),$("#recipe-table").DataTable().draw()}),$("#chk-recipe-guest").click(function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-filter-guest").click(function(){$("#recipe-table").DataTable().rows().every(function(e,a,t){var i=this.data(),c=getRankGuestInfo(i,i.rank);i.rankGuestsVal=c.rankGuestsVal,i.rankGuestsDisp=c.rankGuestsDisp,this.data(i)}),$("#recipe-table").DataTable().draw()}),$("#chk-recipe-got").click(function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-no-origin").click(function(){$("#recipe-table").DataTable().draw()}),private&&($("#chk-recipe-show-origin").prop("checked",!1),$("#chk-recipe-show-unlock").prop("checked",!1),$("#chk-recipe-no-origin").closest(".box").removeClass("hidden")),initRecipeShow()}function reInitRecipeTable(e){var a=[{data:"recipeId"},{data:"name"},{data:{_:"rarity",display:"rarityDisp"}},{data:"stirfry"},{data:"boil"},{data:"knife"},{data:"fry"},{data:"bake"},{data:"steam"},{data:{_:"materialsVal",display:"materialsDisp"}},{data:"price"},{data:{_:"time",display:"timeDisp"}},{data:"limitVal"},{data:"totalPrice"},{data:{_:"totalTime",display:"totalTimeDisp"}},{data:"efficiency"},{data:"allMaterialsEff"},{data:"origin"},{data:"unlock"},{data:"tagsDisp",defaultContent:""},{data:"guestsDisp"},{data:{_:"rankGuestsVal",display:"rankGuestsDisp"}},{data:"gift"},{data:"rank",width:"31px"},{data:"got",width:"31px"}],t=20,i="",c=[];$.fn.DataTable.isDataTable("#recipe-table")&&(t=$("#pane-recipes #recipe-table_length select").val(),i=$("#pane-recipes .search-box input").val(),c=getTableOrder($("#recipe-table").DataTable(),a.length),$("#recipe-table").DataTable().MakeCellsEditable("destroy"),$("#recipe-table").DataTable().destroy()),$("#recipe-table").html($("#recipe-table-header").html());var r=$("#chk-recipe-show-material").val();for(var l in r)for(j in e.materials)if(r[l]==e.materials[j].materialId){$("#recipe-table thead tr").append("<th>"+e.materials[j].name+"/小时</th>"),a.push({data:"materialsEff."+l});break}var s=$("#chk-recipe-show-skill-diff").prop("checked"),n=$("#chk-recipe-show-chef").val();for(var l in n)for(j in e.chefs)if(n[l]==e.chefs[j].chefId){$("#recipe-table thead tr").append("<th>"+e.chefs[j].name+"</th>"),s&&$("#recipe-table thead tr").append("<th>神差值</th>"),$("#recipe-table thead tr").append("<th>效率</th>"),a.push({data:{_:"chefs."+l+".rankVal",display:"chefs."+l+".rankDisp"}}),s&&a.push({data:{_:"chefs."+l+".skillDiffVal",display:"chefs."+l+".skillDiffDisp"}}),a.push({data:"chefs."+l+".efficiency"});break}var o=$("#recipe-table").DataTable({data:e.recipes,columns:a,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"第 _PAGE_ 页 共 _PAGES_ 页 _TOTAL_ 个菜谱",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 个菜谱中过滤)"},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:t,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",deferRender:!0,order:c,autoWidth:!1});$("#pane-recipes div.search-box").html('<label>查找:<input type="search" value="'+i+'" class="form-control input-sm" placeholder="菜名 材料 贵客 符文 来源"></label>');var p=getRankOptions(),d=getGotOptions();o.MakeCellsEditable({columns:[23,24],inputTypes:[{column:23,type:"list",options:p},{column:24,type:"list",options:d}],onUpdate:function(e,a,t,i){var c=a.data(),r=getRankGuestInfo(c,c.rank);c.rankGuestsVal=r.rankGuestsVal,c.rankGuestsDisp=r.rankGuestsDisp,$(e.cell(a.index(),21).node()).html(c.rankGuestsDisp),updateRecipesLocalData()}}),$("#pane-recipes .search-box input").keyup(function(){o.draw()})}function updateRecipesMaterialsData(e){var a=$("#chk-recipe-show-material").val();if(a.length>0)for(var t in e.recipes){e.recipes[t].materialsEff=new Array;for(var i in a)for(var c in e.materials)if(a[i]==e.materials[c].materialId){var r=0;for(var l in e.recipes[t].materials)if(e.recipes[t].materials[l].material==e.materials[c].materialId){r=e.recipes[t].materials[l].quantity;break}var s=0;e.recipes[t].time>0&&(s=3600*r/e.recipes[t].time);var n=s?Math.floor(s):"";e.recipes[t].materialsEff.push(n);break}}}function updateRecipesChefsData(e){var a=$("#chk-chef-apply-equips").prop("checked"),t=$("#chk-recipe-show-skill-diff").prop("checked"),i=$("#chk-recipe-show-chef").val();if(i.length>0)for(var c in e.recipes){e.recipes[c].chefs=new Array;for(var r in i)for(var l in e.chefs)if(i[r]==e.chefs[l].chefId){var s=null;a&&(s=e.chefs[l].equip);var n=getRecipeResult(e.chefs[l],s,e.recipes[c],1,1,e.materials,null,0),o=new Object;if(o.rankVal=n.rankVal,o.rankDisp=n.rankDisp,o.efficiency=n.chefEff||"",t){var p=getSkillDiff(e.chefs[l],e.recipes[c],4);o.skillDiffDisp=p.disp,o.skillDiffVal=p.value}e.recipes[c].chefs.push(o);break}}}function getSkillDiff(e,a,t){var i=e.stirfryVal-a.stirfry*t,c=e.boilVal-a.boil*t,r=e.knifeVal-a.knife*t,l=e.fryVal-a.fry*t,s=e.bakeVal-a.bake*t,n=e.steamVal-a.steam*t,o="",p=0;i<0&&(o+="炒"+i+" ",p+=i),c<0&&(o+="煮"+c+" ",p+=c),r<0&&(o+="切"+r+" ",p+=r),l<0&&(o+="炸"+l+" ",p+=l),s<0&&(o+="烤"+s+" ",p+=s),n<0&&(o+="蒸"+n+" ",p+=n);var d=new Object;return d.disp=o,d.value=-p,d}function updateChefsRecipesData(e){var a=$("#chk-chef-apply-equips").prop("checked"),t=$("#chk-chef-show-recipe").val();if(t.length>0)for(var i in e.chefs){e.chefs[i].recipes=new Array;for(var c in t)for(var r in e.recipes)if(t[c]==e.recipes[r].recipeId){var l=null;a&&(l=e.chefs[i].equip);var s=getRecipeResult(e.chefs[i],l,e.recipes[r],1,1,e.materials,null,0),n=new Object;n.rankVal=s.rankVal,n.rankDisp=s.rankDisp,n.efficiency=s.chefEff||"",e.chefs[i].recipes.push(n)}}}function getTableOrder(e,a){var t=[],i=e.order();for(var c in i){var r=i[c][0];r<a&&t.push(i[c])}return t}function initChefTable(e){reInitChefTable(e);for(var a in e.recipes)$("#chk-chef-show-recipe").append("<option value='"+e.recipes[a].recipeId+"'>"+e.recipes[a].name+"</option>");$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("chef-table"))return!0;var i=$("#chk-chef-rarity-1").prop("checked"),c=$("#chk-chef-rarity-2").prop("checked"),r=$("#chk-chef-rarity-3").prop("checked"),l=$("#chk-chef-rarity-4").prop("checked"),s=$("#chk-chef-rarity-5").prop("checked"),n=Math.floor(a[2])||0;return!!(i&&1==n||c&&2==n||r&&3==n||l&&4==n||s&&5==n)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("chef-table"))return!0;var i=isNumeric($("#input-chef-stirfry").val())?$("#input-chef-stirfry").val():Number.NEGATIVE_INFINITY,c=Math.floor(a[3])||0,r=isNumeric($("#input-chef-boil").val())?$("#input-chef-boil").val():Number.NEGATIVE_INFINITY,l=Math.floor(a[4])||0,s=isNumeric($("#input-chef-knife").val())?$("#input-chef-knife").val():Number.NEGATIVE_INFINITY,n=Math.floor(a[5])||0,o=isNumeric($("#input-chef-fry").val())?$("#input-chef-fry").val():Number.NEGATIVE_INFINITY,p=Math.floor(a[6])||0,d=isNumeric($("#input-chef-bake").val())?$("#input-chef-bake").val():Number.NEGATIVE_INFINITY,u=Math.floor(a[7])||0,h=isNumeric($("#input-chef-steam").val())?$("#input-chef-steam").val():Number.NEGATIVE_INFINITY,f=Math.floor(a[8])||0;return i<=c&&r<=l&&s<=n&&o<=p&&d<=u&&h<=f}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("chef-table"))return!0;var i=$("#chk-chef-gender-male").prop("checked"),c=$("#chk-chef-gender-female").prop("checked"),r=a[14];return!!(i&&"男"==r||c&&"女"==r)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("chef-table"))return!0;var i=$("#chk-chef-no-origin").prop("checked"),c=a[15];return!!(i||!i&&c)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("chef-table"))return!0;var i=$("#chk-chef-got").prop("checked"),c=a[21];return!!(!i||i&&c)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("chef-table"))return!0;for(var i=$.trim($("#pane-chefs .search-box input").val()),c=[1,9,15,16,19],r=0,l=c.length;r<l;r++)if(a[c[r]].indexOf(i)!==-1)return!0;return!1}),$("#chk-chef-show-recipe").selectpicker().on("changed.bs.select",function(){updateChefsRecipesData(e),reInitChefTable(e),initChefShow()}),$(".chk-chef-show").click(function(){initChefShow(),updateMenuLocalData()}),$("#chk-chef-show-all").click(function(){$(".chk-chef-show:checked").length==$(".chk-chef-show").length?$(".chk-chef-show").prop("checked",!1):$(".chk-chef-show").prop("checked",!0),initChefShow(),updateMenuLocalData()}),$('.chk-chef-rarity input[type="checkbox"]').click(function(){$("#chef-table").DataTable().draw()}),$(".input-chef-skill").keyup(function(){$("#chef-table").DataTable().draw()}),$("#btn-chef-skill-clear").click(function(){$(".input-chef-skill").val(""),$("#chef-table").DataTable().draw()}),$('.chk-chef-gender input[type="checkbox"]').click(function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-got").click(function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-no-origin").click(function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-apply-ultimate").change(function(){$(this).prop("checked")?$(".chef-apply-ultimate").show():$(".chef-apply-ultimate").hide(),updateRecipeChefTable(e)}),$("#chk-chef-apply-ultimate-person").change(function(){updateRecipeChefTable(e)}),$("#chk-chef-apply-equips").change(function(){updateRecipeChefTable(e)}),$("#btn-chef-recal").click(function(){updateRecipeChefTable(e)}),private&&$("#chk-chef-no-origin").closest(".box").removeClass("hidden"),initChefShow()}function reInitChefTable(e){var a=[{data:{_:"chefId",display:"chefIdDisp"}},{data:"name"},{data:{_:"rarity",display:"rarityDisp"}},{data:{_:"stirfryVal",display:"stirfryDisp"}},{data:{_:"boilVal",display:"boilDisp"}},{data:{_:"knifeVal",display:"knifeDisp"}},{data:{_:"fryVal",display:"fryDisp"}},{data:{_:"bakeVal",display:"bakeDisp"}},{data:{_:"steamVal",display:"steamDisp"}},{data:"specialSkillDisp"},{data:"meat"},{data:"creation"},{data:"veg"},{data:"fish"},{data:"gender"},{data:"origin"},{data:"tagsDisp",defaultContent:""},{data:{_:"equipName",display:"equipDisp"}},{data:"ultimateGoal"},{data:"ultimateSkillDisp"},{data:"ultimate",width:"31px"},{data:"got",width:"31px"}],t=20,i="",c=[];$.fn.DataTable.isDataTable("#chef-table")&&(t=$("#pane-chefs #chef-table_length select").val(),i=$("#pane-chefs .search-box input").val(),c=getTableOrder($("#chef-table").DataTable(),a.length),$("#chef-table").DataTable().MakeCellsEditable("destroy"),$("#chef-table").DataTable().destroy()),$("#chef-table").html($("#chef-table-header").html());var r=$("#chk-chef-show-recipe").val();for(var l in r)for(var s in e.recipes)if(r[l]==e.recipes[s].recipeId){$("#chef-table thead tr").append("<th title='"+e.recipes[s].skillDisp+"'>"+e.recipes[s].name+"</th>").append("<th>效率</th>"),a.push({data:{_:"recipes."+l+".rankVal",display:"recipes."+l+".rankDisp"}}),a.push({data:"recipes."+l+".efficiency"});break}var n=$("#chef-table").DataTable({data:e.chefs,columns:a,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"第 _PAGE_ 页 共 _PAGES_ 页 _TOTAL_ 个厨师",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 个厨师中过滤)"},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:t,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",deferRender:!0,order:c,autoWidth:!1});$("#pane-chefs div.search-box").html('<label>查找:<input type="search" value="'+i+'" class="form-control input-sm" placeholder="名字 技能 来源"></label>');var o=getGotOptions(),p=getEquipsOptions(e.equips,e.skills);n.MakeCellsEditable({columns:[17,20,21],inputTypes:[{column:17,type:"list",search:!0,clear:!0,options:p},{column:20,type:"list",options:o},{column:21,type:"list",options:o}],onUpdate:function(a,t,i,c){if(17==i.index().column){var r=t.data(),l=null,s="";if(r.equipName)for(var n in e.equips)if(r.equipName==e.equips[n].name){l=e.equips[n],s=e.equips[n].name+"<br>"+e.equips[n].skillDisp;break}r.equip=l,r.equipDisp=s,$(i.node()).html(s)}17!=i.index().column&&20!=i.index().column||i.data()==c||$("#btn-chef-recal").removeClass("btn-default").addClass("btn-danger"),updateChefsLocalData()}}),$("#pane-chefs .search-box input").keyup(function(){n.draw()})}function initEquipTable(e){var a=[{data:"equipId"},{data:"name"},{data:{_:"rarity",display:"rarityDisp"}},{data:"skillDisp"},{data:"origin"}],t=$("#equip-table").DataTable({data:e.equips,columns:a,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"第 _PAGE_ 页 共 _PAGES_ 页 _TOTAL_ 个厨具",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 个厨具中过滤)"},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",deferRender:!0});$("#pane-equips div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="名字 技能 来源"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("equip-table"))return!0;var i=a[3];return!!($("#chk-equip-skill-stirfry-price").prop("checked")&&i.indexOf("炒类料理售价")>=0||$("#chk-equip-skill-boil-price").prop("checked")&&i.indexOf("煮类料理售价")>=0||$("#chk-equip-skill-knife-price").prop("checked")&&i.indexOf("切类料理售价")>=0||$("#chk-equip-skill-fry-price").prop("checked")&&i.indexOf("炸类料理售价")>=0||$("#chk-equip-skill-bake-price").prop("checked")&&i.indexOf("烤类料理售价")>=0||$("#chk-equip-skill-steam-price").prop("checked")&&i.indexOf("蒸类料理售价")>=0||$("#chk-equip-skill-meat-price").prop("checked")&&i.indexOf("肉类料理售价")>=0||$("#chk-equip-skill-creation-price").prop("checked")&&i.indexOf("面类料理售价")>=0||$("#chk-equip-skill-veg-price").prop("checked")&&i.indexOf("蔬菜料理售价")>=0||$("#chk-equip-skill-fish-price").prop("checked")&&i.indexOf("水产料理售价")>=0||$("#chk-equip-skill-sell-price").prop("checked")&&(i.indexOf("金币获得")>=0||i.indexOf("营业收入")>=0)||$("#chk-equip-skill-stirfry-skill").prop("checked")&&i.indexOf("炒技法")>=0||$("#chk-equip-skill-boil-skill").prop("checked")&&i.indexOf("煮技法")>=0||$("#chk-equip-skill-knife-skill").prop("checked")&&i.indexOf("切技法")>=0||$("#chk-equip-skill-fry-skill").prop("checked")&&i.indexOf("炸技法")>=0||$("#chk-equip-skill-bake-skill").prop("checked")&&i.indexOf("烤技法")>=0||$("#chk-equip-skill-steam-skill").prop("checked")&&i.indexOf("蒸技法")>=0||$("#chk-equip-skill-all-skill").prop("checked")&&i.indexOf("全技法")>=0||$("#chk-equip-skill-guest").prop("checked")&&i.indexOf("稀有客人")>=0||$("#chk-equip-skill-time").prop("checked")&&i.indexOf("开业时间")>=0||$("#chk-equip-skill-material-get").prop("checked")&&i.indexOf("素材获得")>=0||$("#chk-equip-skill-meat-skill").prop("checked")&&i.indexOf("肉类采集")>=0||$("#chk-equip-skill-creation-skill").prop("checked")&&i.indexOf("面类采集")>=0||$("#chk-equip-skill-veg-skill").prop("checked")&&i.indexOf("蔬菜采集")>=0||$("#chk-equip-skill-fish-skill").prop("checked")&&i.indexOf("水产采集")>=0||$("#chk-equip-skill-material-skill").prop("checked")&&i.indexOf("全采集")>=0)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("equip-table"))return!0;var i=$("#chk-equip-no-origin").prop("checked"),c=a[4];return!!(i||!i&&c)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("equip-table"))return!0;for(var i=$.trim($("#pane-equips .search-box input").val()),c=[1,3,4],r=0,l=c.length;r<l;r++)if(a[c[r]].indexOf(i)!==-1)return!0;return!1}),$(".chk-equip-show").click(function(){initEquipShow(t)}),$("#chk-equip-show-all").click(function(){$(".chk-equip-show:checked").length==$(".chk-equip-show").length?$(".chk-equip-show").prop("checked",!1):$(".chk-equip-show").prop("checked",!0),initEquipShow(t)}),$(".chk-equip-skill").click(function(){$(this).prop("checked")&&$("#chk-equip-single-skill").prop("checked")&&$(".chk-equip-skill").not(this).prop("checked",!1),t.draw()}),$("#chk-equip-single-skill").change(function(){$(this).prop("checked")&&$(".chk-equip-skill:checked").length>1&&($(".chk-equip-skill").prop("checked",!1),t.draw())}),$("#chk-equip-skill-all").click(function(){$("#chk-equip-single-skill").prop("checked")&&$("#chk-equip-single-skill").bootstrapToggle("off"),$(".chk-equip-skill").prop("checked",!0),t.draw()}),$("#chk-equip-no-origin").click(function(){t.draw()}),$("#pane-equips .search-box input").keyup(function(){t.draw()}),private&&$("#chk-equip-no-origin").closest(".box").removeClass("hidden"),initEquipShow(t)}function initQuestTable(e){var a=[{data:"questId"},{data:"goal"},{data:{_:"rewardsVal",display:"rewardsDisp"}}],t=getQuestsData(e.quests,$("#select-quest-type").val()),i=$("#quest-table").DataTable({data:t,columns:a,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"第 _PAGE_ 页 共 _PAGES_ 页 _TOTAL_ 个任务",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 个任务中过滤)"},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",deferRender:!0});$("#pane-quest div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="编号 任务 奖励"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("quest-table"))return!0;for(var i=$.trim($("#pane-quest .search-box input").val()),c=[0,1,2],r=0,l=c.length;r<l;r++)if(a[c[r]].indexOf(i)!==-1)return!0;return!1}),$("#pane-quest .search-box input").keyup(function(){i.draw()}),$("#select-quest-type").change(function(){var a=getQuestsData(e.quests,$(this).val());i.clear().rows.add(a).draw()})}function initImportExport(e){$("#btn-export").click(function(){$("#input-export-import").val(generateExportData())}),$("#btn-import").click(function(){$(this).prop("disabled",!0);var a=importData(e,$("#input-export-import").val());a?$("#input-export-import").val(""):alert("格式有误"),$(this).prop("disabled",!1)})}function importData(e,a){var t;try{t=JSON.parse(a)}catch(e){return!1}for(var i in e.recipes){for(var c in t.recipes)if(e.recipes[i].recipeId==t.recipes[c].id){if(t.recipes[c].hasOwnProperty("rank")){e.recipes[i].rank=t.recipes[c].rank;var r=getRankGuestInfo(e.recipes[i],e.recipes[i].rank);e.recipes[i].rankGuestsVal=r.rankGuestsVal,e.recipes[i].rankGuestsDisp=r.rankGuestsDisp}t.recipes[c].hasOwnProperty("got")&&(e.recipes[i].got=t.recipes[c].got);break}for(var c in t.recipesTags)if(e.recipes[i].recipeId==t.recipesTags[c].recipeId){e.recipes[i].tags=t.recipesTags[c].tags,e.recipes[i].tagsDisp=getTagsDisp(t.recipesTags[c].tags,t.tags);break}}for(var i in e.chefs){for(var c in t.chefs)if(e.chefs[i].chefId==t.chefs[c].id){if(t.chefs[c].hasOwnProperty("got")&&(e.chefs[i].got=t.chefs[c].got),t.chefs[c].hasOwnProperty("ult")&&(e.chefs[i].ultimate=t.chefs[c].ult),t.chefs[c].hasOwnProperty("equip")){for(var l in e.equips)if(t.chefs[c].equip==e.equips[l].equipId){e.chefs[i].equip=e.equips[l],e.chefs[i].equipName=e.equips[l].name,e.chefs[i].equipDisp=e.equips[l].name+"<br>"+e.equips[l].skillDisp;break}}else e.chefs[i].equip=null;break}t.tags&&(e.chefs[i].tagsDisp=getTagsDisp(e.chefs[i].tags,t.tags))}var s="";for(var i in t.rules){var n=!1;for(var c in e.rules)if(t.rules[i].Id==e.rules[c].Id){n=!0;break}n||(e.rules.push(t.rules[i]),s+="<option value='"+t.rules[i].Id+"'>"+t.rules[i].Title+"</option>")}$("#select-cal-rule").append(s).selectpicker("refresh"),updateMenu(e,t),t.decorationEffect&&(e.decorationEffect=t.decorationEffect,$("#input-cal-decoration").val(Number(t.decorationEffect).mul(100)||""));try{localStorage.setItem("data",generateExportData())}catch(e){}return e=getUpdateData(e),$("#recipe-table").DataTable().clear().rows.add(e.recipes).draw(),$("#chef-table").DataTable().clear().rows.add(e.chefs).draw(),initRecipeShow(),initChefShow(),$("#btn-chef-recal").removeClass("btn-danger").addClass("btn-default"),!0}function updateRecipesLocalData(){var e;try{var a=localStorage.getItem("data");e=JSON.parse(a)}catch(e){}e||(e=new Object),e.recipes=generateRecipesExportData();try{localStorage.setItem("data",JSON.stringify(e))}catch(e){}}function updateChefsLocalData(){var e;try{var a=localStorage.getItem("data");e=JSON.parse(a)}catch(e){}e||(e=new Object),e.chefs=generateChefsExportData();try{localStorage.setItem("data",JSON.stringify(e))}catch(e){}}function updateMenuLocalData(){var e;try{var a=localStorage.getItem("data");e=JSON.parse(a)}catch(e){}e||(e=new Object),e.menu=generateMenuExportData();try{localStorage.setItem("data",JSON.stringify(e))}catch(e){}}function updateDecorationLocalData(){var e;try{var a=localStorage.getItem("data");e=JSON.parse(a)}catch(e){}e||(e=new Object),e.decorationEffect=Number($("#input-cal-decoration").val()).div(100);try{localStorage.setItem("data",JSON.stringify(e))}catch(e){}}function generateExportData(){var e=new Object;return e.recipes=generateRecipesExportData(),e.chefs=generateChefsExportData(),e.menu=generateMenuExportData(),e.decorationEffect=Number($("#input-cal-decoration").val()).div(100),JSON.stringify(e)}function generateRecipesExportData(){var e=new Array,a=$("#recipe-table").DataTable().data().toArray();for(var t in a){var i=new Object;i.id=a[t].recipeId,i.rank=a[t].rank,i.got=a[t].got,e.push(i)}return e}function generateChefsExportData(){var e=new Array,a=$("#chef-table").DataTable().data().toArray();for(var t in a){var i=new Object;i.id=a[t].chefId,i.got=a[t].got,i.ult=a[t].ultimate,a[t].equip&&(i.equip=a[t].equip.equipId),e.push(i)}return e}function generateMenuExportData(){var e=new Object,a=new Object;a.id=$("#chk-recipe-show-id").prop("checked"),a.rarity=$("#chk-recipe-show-rarity").prop("checked"),a.skill=$("#chk-recipe-show-skill").prop("checked"),a.materials=$("#chk-recipe-show-materials").prop("checked"),a.price=$("#chk-recipe-show-price").prop("checked"),a.time=$("#chk-recipe-show-time").prop("checked"),a.limit=$("#chk-recipe-show-limit").prop("checked"),a.totalPrice=$("#chk-recipe-show-total-price").prop("checked"),a.totalTime=$("#chk-recipe-show-total-time").prop("checked"),a.efficiency=$("#chk-recipe-show-efficiency").prop("checked"),a.materialsEfficiency=$("#chk-recipe-show-materials-efficiency").prop("checked"),a.origin=$("#chk-recipe-show-origin").prop("checked"),a.unlock=$("#chk-recipe-show-unlock").prop("checked"),a.tags=$("#chk-recipe-show-tags").prop("checked"),a.guest=$("#chk-recipe-show-guest").prop("checked"),a.rankGuest=$("#chk-recipe-show-rank-guest").prop("checked"),a.rankAntique=$("#chk-recipe-show-rank-antique").prop("checked"),a.rank=$("#chk-recipe-show-rank").prop("checked"),a.got=$("#chk-recipe-show-got").prop("checked"),e.recipe=a;var t=new Object;return t.id=$("#chk-chef-show-id").prop("checked"),t.rarity=$("#chk-chef-show-rarity").prop("checked"),t.skill=$("#chk-chef-show-skill").prop("checked"),t.chefSkill=$("#chk-chef-show-chef-skill").prop("checked"),t.explore=$("#chk-chef-show-explore").prop("checked"),t.gender=$("#chk-chef-show-gender").prop("checked"),t.origin=$("#chk-chef-show-origin").prop("checked"),t.tags=$("#chk-chef-show-tags").prop("checked"),t.equip=$("#chk-chef-show-equip").prop("checked"),t.ultimateGoal=$("#chk-chef-show-ultimate-goal").prop("checked"),t.ultimateSkill=$("#chk-chef-show-ultimate-skill").prop("checked"),t.ultimate=$("#chk-chef-show-ultimate").prop("checked"),t.got=$("#chk-chef-show-got").prop("checked"),e.chef=t,e}function updateMenu(e,a){if(a&&a.menu){var t=a.menu.recipe;t&&($("#chk-recipe-show-id").prop("checked",t.id||!1),$("#chk-recipe-show-rarity").prop("checked",t.rarity||!1),$("#chk-recipe-show-skill").prop("checked",t.skill||!1),$("#chk-recipe-show-materials").prop("checked",t.materials||!1),$("#chk-recipe-show-price").prop("checked",t.price||!1),$("#chk-recipe-show-time").prop("checked",t.time||!1),$("#chk-recipe-show-limit").prop("checked",t.limit||!1),$("#chk-recipe-show-total-price").prop("checked",t.totalPrice||!1),$("#chk-recipe-show-total-time").prop("checked",t.totalTime||!1),$("#chk-recipe-show-efficiency").prop("checked",t.efficiency||!1),$("#chk-recipe-show-materials-efficiency").prop("checked",t.materialsEfficiency||!1),$("#chk-recipe-show-origin").prop("checked",t.origin||!1),$("#chk-recipe-show-unlock").prop("checked",t.unlock||!1),$("#chk-recipe-show-tags").prop("checked",t.tags||!1),$("#chk-recipe-show-guest").prop("checked",t.guest||!1),$("#chk-recipe-show-rank-guest").prop("checked",t.rankGuest||!1),$("#chk-recipe-show-rank-antique").prop("checked",t.rankAntique||!1),$("#chk-recipe-show-rank").prop("checked",t.rank||!1),$("#chk-recipe-show-got").prop("checked",t.got||!1));var i=a.menu.chef;i&&($("#chk-chef-show-id").prop("checked",i.id||!1),$("#chk-chef-show-rarity").prop("checked",i.rarity||!1),$("#chk-chef-show-skill").prop("checked",i.skill||!1),$("#chk-chef-show-chef-skill").prop("checked",i.chefSkill||!1),$("#chk-chef-show-explore").prop("checked",i.explore||!1),$("#chk-chef-show-gender").prop("checked",i.gender||!1),$("#chk-chef-show-origin").prop("checked",i.origin||!1),$("#chk-chef-show-tags").prop("checked",i.tags||!1),$("#chk-chef-show-equip").prop("checked",i.equip||!1),$("#chk-chef-show-ultimate-goal").prop("checked",i.ultimateGoal||!1),$("#chk-chef-show-ultimate-skill").prop("checked",i.ultimateSkill||!1),$("#chk-chef-show-ultimate").prop("checked",i.ultimate||!1),$("#chk-chef-show-got").prop("checked",i.got||!1))}}function initCalTables(e){initCalResultsTable(e),initCalRules(e),private&&($("#pane-cal").addClass("admin"),initCalRecipesTable(e),initCalChefsTable(e),initCalEquipsTable(e),initCalMaterialsTable(e),$.fn.dataTable.ext.order["dom-selected"]=function(e,a){return this.api().column(a,{order:"index"}).nodes().map(function(e,a){return $(e).parent("tr").hasClass("selected")?"1":"0"})})}function initCalRules(e){var a="";for(var t in e.rules)a+="<option value='"+e.rules[t].Id+"'>"+e.rules[t].Title+"</option>";$("#select-cal-rule").append(a).selectpicker("refresh").change(function(){
$("#btn-cal-rule-load").removeClass("btn-default").addClass("btn-danger")}),$("#input-cal-decoration").val(Number(e.decorationEffect).mul(100)||""),loadUltimate(e,!0),$("#btn-cal-rule-load").click(function(){var a=Math.floor($("#select-cal-rule").val());for(var t in e.rules)if(e.rules[t].Id==a){currentRule=e.rules[t];break}currentRule&&($("#btn-cal-rule-load").prop("disabled",!0),$(".loading").removeClass("hidden"),$(".cal-results-wrapper").addClass("hidden"),setTimeout(function(){loadRule(e,currentRule),setCalConfigData(currentRule),calRecipesResults(currentRule),initCalCustomOptions(currentRule,e),$(".loading").addClass("hidden"),$("#pane-cal-self-select").find(".cal-results-wrapper").removeClass("hidden"),$("#pane-cal-recipes-results").find(".cal-results-wrapper").removeClass("hidden"),$("#btn-cal-rule-load").prop("disabled",!1).removeClass("btn-danger").addClass("btn-default")},500))}),$("#btn-cal-update").click(function(){currentRule&&($("#btn-cal-decoration").prop("disabled",!0),$("#btn-cal-rule-load").prop("disabled",!0),$(".loading").removeClass("hidden"),$(".cal-results-wrapper").addClass("hidden"),setTimeout(function(){setCalConfigData(currentRule),calRecipesResults(currentRule),calCustomResults(currentRule,e),$(".loading").addClass("hidden"),$("#pane-cal-self-select").find(".cal-results-wrapper").removeClass("hidden"),$("#pane-cal-recipes-results").find(".cal-results-wrapper").removeClass("hidden"),$("#btn-cal-rule-load").prop("disabled",!1),$("#btn-cal-decoration").prop("disabled",!1)},500))}),$("#input-cal-decoration").keyup(function(){$("#btn-cal-update").removeClass("btn-default").addClass("btn-danger"),updateDecorationLocalData()}),$("#cal-ultimate input").keyup(function(){$("#btn-cal-update").removeClass("btn-default").addClass("btn-danger")}),$("#btn-cal-load-ultimate").click(function(){$("#btn-cal-update").removeClass("btn-default").addClass("btn-danger"),$("#cal-ultimate input").val(""),loadUltimate(e,!0)}),$("#btn-cal-load-all-ultimate").click(function(){$("#btn-cal-update").removeClass("btn-default").addClass("btn-danger"),$("#cal-ultimate input").val(""),loadUltimate(e,!1)}),$("#btn-cal-clear-ultimate").click(function(){$("#btn-cal-update").removeClass("btn-default").addClass("btn-danger"),$("#cal-ultimate input").val("")}),$("#btn-cal-clear-custom").click(function(){if(currentRule){var a=$("#cal-self-select-table").DataTable(),t=a.data().toArray();for(var i in t)t[i].chef.name="",t[i].equip.name="",t[i].recipe.data.name="";calCustomResults(currentRule,e)}}),private&&($("#chk-cal-no-origin-recipes").closest(".btn").removeClass("hidden"),$("#chk-cal-no-origin-recipes").click(function(){$("#btn-cal-rule-load").removeClass("btn-default").addClass("btn-danger")}),$("#btn-cal-set-num").closest(".box").removeClass("hidden"),$("#btn-cal-set-num").click(function(){var e=$("#cal-self-select-table").DataTable().data().toArray();$("#cal-recipes-table").DataTable().rows().deselect(),$("#cal-recipes-table").DataTable().rows().every(function(a,t,i){var c=this.data(),r="";for(var l in e)if(e[l].recipe.data.name==c.name){r=e[l].recipe.quantity,this.select();break}this.cell(a,".cal-td-input-quantity").data(r)})}))}function loadUltimate(e,a){var t;try{var i=localStorage.getItem("data");t=JSON.parse(i)}catch(e){}var c=getUltimateData(e.chefs,t,e.skills,!0,a,!1);for(var r in c)"全体厨师炒技法"!=c[r].type?"全体厨师煮技法"!=c[r].type?"全体厨师切技法"!=c[r].type?"全体厨师炸技法"!=c[r].type?"全体厨师烤技法"!=c[r].type?"全体厨师蒸技法"!=c[r].type?"全体厨师全技法"!=c[r].type?"全体男厨师全技法"!=c[r].type?"全体女厨师全技法"!=c[r].type?"2星菜谱上限"!=c[r].type?"3星菜谱上限"!=c[r].type?"3星菜谱售价"!=c[r].type?"4星菜谱售价"!=c[r].type?c[r].type.indexOf("探索")>-1||console.log(c[r].type):$("#input-cal-ultimate-4-price").val(c[r].addition.mul(100)):$("#input-cal-ultimate-3-price").val(c[r].addition.mul(100)):$("#input-cal-ultimate-3-limit").val(c[r].addition):$("#input-cal-ultimate-2-limit").val(c[r].addition):$("#input-cal-ultimate-female-skill").val(c[r].addition):$("#input-cal-ultimate-male-skill").val(c[r].addition):$("#input-cal-ultimate-all-skill").val(c[r].addition):$("#input-cal-ultimate-steam").val(c[r].addition):$("#input-cal-ultimate-bake").val(c[r].addition):$("#input-cal-ultimate-fry").val(c[r].addition):$("#input-cal-ultimate-knife").val(c[r].addition):$("#input-cal-ultimate-boil").val(c[r].addition):$("#input-cal-ultimate-stirfry").val(c[r].addition)}function setCalConfigData(e){$("#btn-cal-update").removeClass("btn-danger").addClass("btn-default"),e.decorationEffect=Number($("#input-cal-decoration").val()).div(100);var a=new Array,t=Number($("#input-cal-ultimate-stirfry").val());if(t){var i=new Object;i.type="全体厨师炒技法",i.addition=t,a.push(i)}var c=Number($("#input-cal-ultimate-boil").val());if(c){var i=new Object;i.type="全体厨师煮技法",i.addition=c,a.push(i)}var r=Number($("#input-cal-ultimate-knife").val());if(r){var i=new Object;i.type="全体厨师切技法",i.addition=r,a.push(i)}var l=Number($("#input-cal-ultimate-fry").val());if(l){var i=new Object;i.type="全体厨师炸技法",i.addition=l,a.push(i)}var s=Number($("#input-cal-ultimate-bake").val());if(s){var i=new Object;i.type="全体厨师烤技法",i.addition=s,a.push(i)}var n=Number($("#input-cal-ultimate-steam").val());if(n){var i=new Object;i.type="全体厨师蒸技法",i.addition=n,a.push(i)}var o=Number($("#input-cal-ultimate-all-skill").val());if(o){var i=new Object;i.type="全体厨师全技法",i.addition=o,a.push(i)}var p=Number($("#input-cal-ultimate-male-skill").val());if(p){var i=new Object;i.type="全体男厨师全技法",i.addition=p,a.push(i)}var d=Number($("#input-cal-ultimate-female-skill").val());if(d){var i=new Object;i.type="全体女厨师全技法",i.addition=d,a.push(i)}var u=Number($("#input-cal-ultimate-2-limit").val());if(u){var i=new Object;i.type="2星菜谱上限",i.addition=u,a.push(i)}var h=Number($("#input-cal-ultimate-3-limit").val());if(h){var i=new Object;i.type="3星菜谱上限",i.addition=h,a.push(i)}var f=Number($("#input-cal-ultimate-3-price").val());if(f){var i=new Object;i.type="3星菜谱售价",i.addition=f.div(100),a.push(i)}var k=Number($("#input-cal-ultimate-4-price").val());if(k){var i=new Object;i.type="4星菜谱售价",i.addition=k.div(100),a.push(i)}for(var m in e.recipes)setDataForRecipe(e.recipes[m],a);for(var m in e.chefs)setDataForChef(e.chefs[m],a,!1)}function loadRule(e,a){a.DisableDecorationEffect?($("#input-cal-decoration").prop("disabled",!0),$("#btn-cal-decoration").prop("disabled",!0)):($("#input-cal-decoration").prop("disabled",!1),$("#btn-cal-decoration").prop("disabled",!1));var t=JSON.parse(JSON.stringify(e.recipes)),i=JSON.parse(JSON.stringify(e.chefs)),c=JSON.parse(JSON.stringify(e.equips)),r=JSON.parse(JSON.stringify(e.materials)),l=new Array;for(var s in t)if((!private||$("#chk-cal-no-origin-recipes").prop("checked")||t[s].origin)&&!(t[s].rarity>a.CookbookRarityLimit)){if(a.RecipesTagsEffect.length>0)for(var n in t[s].tags)for(var o in a.RecipesTagsEffect)t[s].tags[n]==a.RecipesTagsEffect[o].TagID&&(t[s].addition=Number(t[s].addition).add(a.RecipesTagsEffect[o].Effect));if(a.RecipesEffect.length>0)for(var o in a.RecipesEffect)t[s].recipeId==a.RecipesEffect[o].RecipeID&&(t[s].addition=Number(t[s].addition).add(a.RecipesEffect[o].Effect));if(a.hasOwnProperty("RecipesSkillsEffect")&&a.RecipesSkillsEffect.length>0)for(var o in a.RecipesSkillsEffect)("stirfry"==a.RecipesSkillsEffect[o].Skill&&t[s].stirfry>0||"boil"==a.RecipesSkillsEffect[o].Skill&&t[s].boil>0||"knife"==a.RecipesSkillsEffect[o].Skill&&t[s].knife>0||"fry"==a.RecipesSkillsEffect[o].Skill&&t[s].fry>0||"bake"==a.RecipesSkillsEffect[o].Skill&&t[s].bake>0||"steam"==a.RecipesSkillsEffect[o].Skill&&t[s].steam>0)&&(t[s].addition=Number(t[s].addition).add(a.RecipesSkillsEffect[o].Effect));l.push(t[s])}var p=new Array;for(var s in i)if(i[s].origin&&!(i[s].rarity>a.ChefRarityLimit)){var d=!1;if(a.EnableChefTags.length>0){for(var n in a.EnableChefTags)if(i[s].tags.indexOf(a.EnableChefTags[n])>=0){d=!0;break}}else d=!0;if(d){if(a.ChefsTagsEffect.length>0)for(var n in i[s].tags)for(var o in a.ChefsTagsEffect)i[s].tags[n]==a.ChefsTagsEffect[o].TagID&&(i[s].addition=Number(i[s].addition).add(a.ChefsTagsEffect[o].Effect));p.push(i[s])}}var u=new Array;for(var s in c)c[s].origin&&u.push(c[s]);var h=new Array;for(var s in r){for(var n in a.MaterialsEffect)r[s].materialId==a.MaterialsEffect[n].MaterialID&&(r[s].addition=Number(r[s].addition).add(a.MaterialsEffect[n].Effect));for(var n in a.MaterialsNum)if(r[s].materialId==a.MaterialsNum[n].MaterialID){r[s].quantity=a.MaterialsNum[n].Num;break}h.push(r[s])}a.recipes=l,a.chefs=p,a.equips=u,a.materials=h,a.rest=h;for(var f=new Array,s=0;s<9;s++){var k=new Object;k.group=Math.floor(s/3),k.chef=new Object,k.recipe=new Object,k.recipe.data=new Object,k.equip=new Object,f.push(k)}$("#cal-self-select-table").DataTable().clear().rows.add(f).draw(),updateSum($("#cal-self-select-table").DataTable(),$("#pane-cal-self-select")),private&&($("#cal-recipes-table").DataTable().clear().rows.add(l).draw(),$("#cal-recipes-table").DataTable().rows().select(),$("#cal-chefs-table").DataTable().clear().rows.add(p).draw(),$("#cal-chefs-table").DataTable().rows().select(),$("#cal-materials-table").DataTable().clear().rows.add(h).draw(),$("#cal-materials-table").DataTable().rows().select(),$("#cal-equips-table").DataTable().clear().rows.add(u).draw(),$("#cal-equips-table").DataTable().rows().select())}function initCalCustomOptions(e,a){var t=getChefsOptions(e.chefs),i=getRecipesOptions(e),c=getEquipsOptions(e.equips,a.skills);$("#cal-self-select-table").DataTable().MakeCellsEditable("destroy"),$("#cal-self-select-table").DataTable().MakeCellsEditable({columns:[1,2,3,12],inputTypes:[{column:1,type:"list",search:!0,clear:!0,options:t},{column:2,type:"list",search:!0,clear:!0,options:c},{column:3,type:"list",search:!0,clear:!0,options:i}],onUpdate:function(t,i,c,r){var l=i.data().group;if($(c.node()).hasClass("cal-td-chef-name"))for(var s=0;s<3;s++)t.data()[3*l+s].chef.name=c.data();else if($(c.node()).hasClass("cal-td-equip-name"))for(var s=0;s<3;s++)t.data()[3*l+s].equip.name=c.data();else $(c.node()).hasClass("cal-td-recipe-name")&&c.data()!=r&&(i.data().recipe.quantity=0,i.data().recipe.setQuantity=!0);calCustomResults(e,a),$(t.body()).removeClass("processing")},waitUpdate:!0})}function calCustomResults(e,a){var t=$("#cal-self-select-table").DataTable(),i=t.data().toArray();for(var c in i){var r=new Object,l=i[c].chef.name||"";if(l){r.name=l;for(var s in e.chefs)if(e.chefs[s].name==l){r=JSON.parse(JSON.stringify(e.chefs[s]));break}}var n=getEquipInfo(i[c].equip.name,e.equips);i[c].equip=n,r.chefId&&setDataForChef2(r,n),i[c].chef=r;var o=new Object;o.data=new Object;var p=i[c].recipe.data.name?i[c].recipe.data.name:"";if(p){o.data.name=p,o.disp=p;for(var s in e.recipes)if(e.recipes[s].name==p){o.data=JSON.parse(JSON.stringify(e.recipes[s]));var d=i[c].recipe.quantity;d||(d=0);var u=getRecipeQuantity(o.data,e.materials,e);d>u&&(d=u),o.quantity=d,o.max=u,o.setQuantity=i[c].recipe.setQuantity;break}}i[c].recipe=o}var h=checkMaterials2(i,e.materials);for(var c in i)if(i[c].recipe.data.recipeId&&i[c].recipe.setQuantity){var f=getRecipeQuantity(i[c].recipe.data,h.materials,e),k=i[c].recipe.max-i[c].recipe.quantity;f>k&&(f=k),i[c].recipe.quantity=f,i[c].recipe.setQuantity=!1}for(var c in i)if(i[c].recipe.data.recipeId&&i[c].chef.chefId){var m=getRecipeResult(i[c].chef,i[c].equip,i[c].recipe.data,i[c].recipe.quantity,i[c].recipe.max,e.materials,e,e.decorationEffect);if(m.rankVal>0)i[c].recipe=m;else{var b=getSkillDiff(i[c].chef,i[c].recipe.data,1);i[c].recipe.disp+="<br><small>"+b.disp+"</small>"}}h=checkMaterials2(i,e.materials);for(var c in i)if(i[c].recipe.data.recipeId){var f=getRecipeQuantity(i[c].recipe.data,h.materials,e),k=i[c].recipe.max-i[c].recipe.quantity;f>k&&(f=k),i[c].recipe.available=f}t.clear().rows.add(i).draw(),updateSum(t,$("#pane-cal-self-select")),h.message&&$("#pane-cal-self-select").find(".selected-sum").append(" ("+h.message+")"),e.rest=h.materials,initCalCustomOptions(e,a)}function getRecipesOptions(e){var a=new Array;for(var t in e.menus){var i=new Object,c=getRecipeQuantity(e.menus[t].recipe.data,e.rest,e),r=getRecipeResult(null,null,e.menus[t].recipe.data,c,e.menus[t].recipe.max,e.materials,e,e.decorationEffect);i.display=e.menus[t].recipe.data.name,i.value=e.menus[t].recipe.data.name,i.subtext=r.totalScore+" / "+e.menus[t].recipe.totalScore,i.score=r.totalScore,a.push(i)}a.sort(function(e,a){return a.score-e.score});var i=new Object;return i.display="无菜谱",i.value="",i.class="hidden",a.unshift(i),a}function calRecipesResults(e){var a=new Array;for(var t in e.recipes){var i=getRecipeQuantity(e.recipes[t],e.materials,e);if(0!=i){var c=getRecipeResult(null,null,e.recipes[t],i,i,e.materials,e,e.decorationEffect),r=new Object;r.recipe=c,a.push(r)}}a.sort(function(e,a){return a.recipe.totalScore-e.recipe.totalScore}),e.menus=a,$("#cal-recipes-results-table").DataTable().clear().rows.add(a).draw()}function checkMaterials2(e,a){var t=JSON.parse(JSON.stringify(a));for(var i in e){var c=e[i].recipe;if(c.data.recipeId)for(var r in c.data.materials)for(var l in t)c.data.materials[r].material==t[l].materialId&&Number.isInteger(t[l].quantity)&&(t[l].quantity-=c.data.materials[r].quantity*c.quantity)}var s="";for(var l in t)t[l].quantity<0&&(s+=t[l].name+t[l].quantity);return{materials:t,message:s}}function initCalRecipesTable(e){var a=[{data:void 0,defaultContent:"",className:"select-checkbox",orderDataType:"dom-selected",width:"30px"},{data:"recipeId"},{data:"name"},{data:{_:"rarity",display:"rarityDisp"}},{data:"stirfry"},{data:"boil"},{data:"knife"},{data:"fry"},{data:"bake"},{data:"steam"},{data:{_:"materialsVal",display:"materialsDisp"}},{data:"price"},{data:"limitVal"},{data:"totalPrice"},{data:"origin"},{data:"tagsDisp",defaultContent:""},{data:"addition",className:"cal-td-input-addition",width:"38px"},{data:"customLimit",className:"cal-td-input-quantity",defaultContent:"",width:"38px"}],t=$("#cal-recipes-table").DataTable({data:new Array,columns:a,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"共 _MAX_ 个菜谱",infoEmpty:"没有数据",infoFiltered:"",select:{rows:{_:"选择了 %d 个菜谱",0:"选择了 %d 个菜谱",1:"选择了 %d 个菜谱"}}},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},autoWidth:!1,createdRow:function(e,a,t){$(e).addClass("rarity-"+a.rarity)}});$("#pane-cal-recipes div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="菜名 材料"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("cal-recipes-table"))return!0;for(var i=$.trim($("#pane-cal-recipes .search-box input").val()),c=[2,10,15],r=0,l=c.length;r<l;r++)if(a[c[r]].indexOf(i)!==-1)return!0;return!1}),t.MakeCellsEditable({columns:[16,17]}),$(".chk-cal-recipes-show").click(function(){initCalRecipesShow(t)}),$('.chk-cal-recipes-rarity input[type="checkbox"]').click(function(){var e=$(this).attr("data-rarity");$(this).prop("checked")?t.rows(".rarity-"+e).select():t.rows(".rarity-"+e).deselect()}),$("#pane-cal-recipes .search-box input").keyup(function(){t.draw()}),$("#btn-cal-recipes-select-all").click(function(){$('.chk-cal-recipes-rarity input[type="checkbox"]').prop("checked",!0),t.rows().select()}),$("#btn-cal-recipes-deselect-all").click(function(){$('.chk-cal-recipes-rarity input[type="checkbox"]').prop("checked",!1),t.rows().deselect()}),initCalRecipesShow(t)}function initCalChefsTable(e){var a=[{data:void 0,defaultContent:"",className:"select-checkbox",orderDataType:"dom-selected",width:"30px"},{data:{_:"chefId",display:"chefIdDisp"}},{data:"name"},{data:{_:"rarity",display:"rarityDisp"}},{data:{_:"stirfryVal",display:"stirfryDisp"}},{data:{_:"boilVal",display:"boilDisp"}},{data:{_:"knifeVal",display:"knifeDisp"}},{data:{_:"fryVal",display:"fryDisp"}},{data:{_:"bakeVal",display:"bakeDisp"}},{data:{_:"steamVal",display:"steamDisp"}},{data:"specialSkillDisp"},{data:"gender"},{data:"origin"},{data:"tagsDisp",defaultContent:""},{data:"addition",className:"cal-td-input-addition",width:"38px"},{data:"equipName",className:"cal-td-select-equip",width:"101px"}],t=$("#cal-chefs-table").DataTable({data:new Array,columns:a,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"共 _MAX_ 个厨师",infoEmpty:"没有数据",infoFiltered:"",select:{rows:{_:"选择了 %d 个厨师",0:"选择了 %d 个厨师",1:"选择了 %d 个厨师"}}},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},autoWidth:!1,createdRow:function(e,a,t){$(e).addClass("rarity-"+a.rarity)}});$("#pane-cal-chefs div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="名字 性别"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("cal-chefs-table"))return!0;for(var i=$.trim($("#pane-cal-chefs .search-box input").val()),c=[2,11,13],r=0,l=c.length;r<l;r++)if(a[c[r]].indexOf(i)!==-1)return!0;return!1});var i=getEquipsOptions(e.equips,e.skills);t.MakeCellsEditable({columns:[14,15],inputTypes:[{column:15,type:"list",search:!0,clear:!0,options:i}]}),$(".chk-cal-chefs-show").click(function(){initCalChefsShow(t)}),$('.chk-cal-chefs-rarity input[type="checkbox"]').click(function(){var e=$(this).attr("data-rarity");$(this).prop("checked")?t.rows(".rarity-"+e).select():t.rows(".rarity-"+e).deselect()}),$("#btn-cal-chefs-equip-clear").click(function(){t.rows().every(function(e,a,t){this.cell(e,".cal-td-select-equip").data("")})}),$("#pane-cal-chefs .search-box input").keyup(function(){t.draw()}),$("#btn-cal-chefs-select-all").click(function(){$('.chk-cal-chefs-rarity input[type="checkbox"]').prop("checked",!0),t.rows().select()}),$("#btn-cal-chefs-deselect-all").click(function(){$('.chk-cal-chefs-rarity input[type="checkbox"]').prop("checked",!1),t.rows().deselect()}),initCalChefsShow(t)}function initCalEquipsTable(e){var a=[{data:void 0,defaultContent:"",className:"select-checkbox",orderDataType:"dom-selected",width:"30px"},{data:"equipId"},{data:"name"},{data:{_:"rarity",display:"rarityDisp"}},{data:"skillDisp"},{data:"origin"}],t=$("#cal-equips-table").DataTable({data:new Array,columns:a,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"共 _MAX_ 个厨具",infoEmpty:"没有数据",infoFiltered:"",select:{rows:{_:"选择了 %d 个厨具",0:"选择了 %d 个厨具",1:"选择了 %d 个厨具"}}},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},order:[[4,"desc"]],autoWidth:!1,createdRow:function(e,a,t){$(e).addClass("rarity-"+a.rarity)}});$("#pane-cal-equips div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="名字 技能 来源"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("cal-equips-table"))return!0;for(var i=$.trim($("#pane-cal-equips .search-box input").val()),c=[2,4,5],r=0,l=c.length;r<l;r++)if(a[c[r]].indexOf(i)!==-1)return!0;return!1}),$(".chk-cal-equips-show").click(function(){initCalEquipsShow(t)}),$('.chk-cal-equips-rarity input[type="checkbox"]').click(function(){var e=$(this).attr("data-rarity");$(this).prop("checked")?t.rows(".rarity-"+e).select():t.rows(".rarity-"+e).deselect()}),$("#pane-cal-equips .search-box input").keyup(function(){t.draw()}),$("#btn-cal-equips-select-all").click(function(){$('.chk-cal-equips-origin input[type="checkbox"]').prop("checked",!0),t.rows().select()}),$("#btn-cal-equips-deselect-all").click(function(){$('.chk-cal-equips-origin input[type="checkbox"]').prop("checked",!1),t.rows().deselect()}),initCalEquipsShow(t)}function initCalMaterialsTable(e){var a=[{data:void 0,defaultContent:"",className:"select-checkbox",orderDataType:"dom-selected",width:"30px"},{data:"materialId"},{data:"name"},{data:{_:"rarity",display:"rarityDisp"}},{data:"origin"},{data:"quantity",className:"cal-td-input-quantity",width:"38px"},{data:"addition",className:"cal-td-input-addition",width:"38px"}],t=$("#cal-materials-table").DataTable({data:new Array,columns:a,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"共 _MAX_ 个食材",infoEmpty:"没有数据",infoFiltered:"",select:{rows:{_:"选择了 %d 个食材",0:"选择了 %d 个食材",1:"选择了 %d 个食材"}}},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},order:[[4,"desc"]],autoWidth:!1,createdRow:function(e,a,t){$(e).addClass("origin-"+a.originVal)}});$("#pane-cal-materials div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="名字 来源"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("cal-materials-table"))return!0;for(var i=$.trim($("#pane-cal-materials .search-box input").val()),c=[2,4],r=0,l=c.length;r<l;r++)if(a[c[r]].indexOf(i)!==-1)return!0;return!1}),t.MakeCellsEditable({columns:[5,6]}),$(".chk-cal-materials-show").click(function(){initCalMaterialsShow(t)}),$('.chk-cal-materials-origin input[type="checkbox"]').click(function(){var e=$(this).attr("data-origin");$(this).prop("checked")?t.rows(".origin-"+e).select():t.rows(".origin-"+e).deselect()}),$("#pane-cal-materials .search-box input").keyup(function(){t.draw()}),$("#btn-cal-materials-select-all").click(function(){$('.chk-cal-materials-origin input[type="checkbox"]').prop("checked",!0),t.rows().select()}),$("#btn-cal-materials-deselect-all").click(function(){$('.chk-cal-materials-origin input[type="checkbox"]').prop("checked",!1),t.rows().deselect()}),initCalMaterialsShow(t)}function initCalResultsTable(e){if($("#pane-cal-self-select").html($("#pane-cal-results-common").html()),$("#pane-cal-self-select .cal-results-table").prop("id","cal-self-select-table"),initCalResultTableCommon("self-select",$("#pane-cal-self-select"),e),$("#pane-cal-recipes-results").html($("#pane-cal-results-common").html()),$("#pane-cal-recipes-results .cal-results-table").prop("id","cal-recipes-results-table"),initCalResultTableCommon("recipes",$("#pane-cal-recipes-results"),e),private){$("#cal-optimal-results-place").html($("#pane-cal-results-common").html()),$("#cal-optimal-results-place .cal-results-table").prop("id","cal-optimal-results-table"),initCalResultTableCommon("optimal",$("#pane-cal-optimal-results"),e);var a;$(".btn-cal-results-cal").click(function(){if(!currentRule)return void alert("请加载规则");var t=$("#pane-cal-optimal-results");if("undefined"!=typeof a&&(a.terminate(),a=void 0),$(this).hasClass("stop"))return t.find(".cal-results-progress").addClass("hidden"),t.find(".btn-cal-results-cal.start").prop("disabled",!1),void t.find(".btn-cal-results-cal.stop").prop("disabled",!0);t.find(".btn-cal-results-cal.start").prop("disabled",!0),t.find(".btn-cal-results-cal.stop").prop("disabled",!1),t.find(".cal-results-wrapper").addClass("hidden"),t.find(".cal-results-progress .progress-bar").css("width","0%"),t.find(".cal-results-progress .progress-bar span").text("预处理中"),t.find(".cal-results-progress").removeClass("hidden"),a=new Worker("private/js/cal.js"),a.onmessage=function(e){e.data.progress?(t.find(".cal-results-progress .progress-bar").css("width",e.data.progress.value+"%"),t.find(".cal-results-progress .progress-bar span").text(e.data.progress.display)):e.data.menu?(e.data.message?t.find(".selected-sum").html(e.data.message):t.find(".selected-sum").html(""),$("#cal-optimal-results-table").DataTable().clear().rows.add(e.data.menu).draw(),updateSum($("#cal-optimal-results-table").DataTable(),t),t.find(".cal-results-wrapper").removeClass("hidden")):e.data.done&&(t.find(".btn-cal-results-cal.stop").prop("disabled",!0),t.find(".btn-cal-results-cal.start").prop("disabled",!1),t.find(".cal-results-progress").addClass("hidden"))};var i=$("#cal-recipes-table").DataTable().rows({selected:!0}).data().toArray(),c=$("#cal-chefs-table").DataTable().rows({selected:!0}).data().toArray(),r=$("#cal-equips-table").DataTable().rows({selected:!0}).data().toArray(),l=$("#cal-materials-table").DataTable().rows({selected:!0}).data().toArray(),s=$("#chk-cal-results-equips").prop("checked"),n=$("#chk-cal-results-equips-change").prop("checked");a.postMessage({mode:"optimal",rule:currentRule,recipes:i,chefs:c,equips:r,materials:l,odata:e,autoEquips:s,changeEquips:n})})}$("#pane-cal-results-common").remove()}function initCalResultTableCommon(e,a,t){var i=[{data:"group",defaultContent:""},{data:{_:"chef.name",display:"chef.disp"},className:"cal-td-chef-name",defaultContent:""},{data:{_:"equip.name",display:"equip.disp"},className:"cal-td-equip-name",defaultContent:""},{data:{_:"recipe.data.name",display:"recipe.disp"},className:"cal-td-recipe-name",defaultContent:""},{data:"recipe.data.stirfry",defaultContent:""},{data:"recipe.data.boil",defaultContent:""},{data:"recipe.data.knife",defaultContent:""},{data:"recipe.data.fry",defaultContent:""},{data:"recipe.data.bake",defaultContent:""},{data:"recipe.data.steam",defaultContent:""},{data:{_:"recipe.data.materialsVal",display:"recipe.data.materialsDisp"},defaultContent:""},{data:"recipe.data.origin",defaultContent:""},{data:"recipe.quantity",className:"cal-td-quantity",defaultContent:"",width:"38px"},{data:"recipe.available",defaultContent:""},{data:"recipe.max",defaultContent:""},{data:"recipe.data.price",defaultContent:""},{data:{_:"recipe.rankVal",display:"recipe.rankDisp"},defaultContent:""},{data:{_:"recipe.rankAddition",display:"recipe.rankAdditionDisp"},defaultContent:""},{data:{_:"recipe.chefSkillAddition",display:"recipe.chefSkillAdditionDisp"},defaultContent:""},{data:{_:"recipe.equipSkillAddition",display:"recipe.equipSkillAdditionDisp"},defaultContent:""},{data:{_:"recipe.otherAddition",display:"recipe.otherAdditionDisp"},defaultContent:""},{data:{_:"recipe.data.ultimateAddition",display:"recipe.data.ultimateAdditionDisp"},defaultContent:""},{data:{_:"recipe.decorationAddition",display:"recipe.decorationAdditionDisp"},defaultContent:""},{data:"recipe.totalPrice",defaultContent:""},{data:"recipe.totalRealPrice",defaultContent:""},{data:"recipe.totalBonusScore",defaultContent:""},{data:"recipe.totalScore",defaultContent:""},{data:{_:"recipe.totalTime",display:"recipe.totalTimeDisp"},defaultContent:""}],c=!0,r=!0,l=!0,s=[[26,"desc"]];"optimal"!=e&&"self-select"!=e||(c=!1,r=!1,l=!1,s=[]);var n=a.find(".cal-results-table").DataTable({data:new Array,columns:i,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 条",zeroRecords:"没有找到",info:"共 _TOTAL_ 条",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 条中过滤)"},paging:c,pagingType:"numbers",lengthMenu:[[5,10,20,50,100,-1],[5,10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-12'<'selected-sum'>>><'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",autoWidth:!1,info:r,ordering:l,order:s,rowsGroup:[0,1,2]});return a.find(".selected-sum").html(""),"recipes"==e&&(a.find("div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="菜名 材料"></label>'),a.find(".search-box input").keyup(function(){n.draw()}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t){if(e.nTable!=document.getElementById("cal-recipes-results-table"))return!0;for(var i=$.trim($("#pane-cal-recipes-results .search-box input").val()),c=[3,10],r=0,l=c.length;r<l;r++)if(a[c[r]].indexOf(i)!==-1)return!0;return!1})),a.find(".chk-cal-results-show").off("click").click(function(){initCalResultsShow(e,n,a),"self-select"==e&&calCustomResults(currentRule,t)}),initCalResultsShow(e,n,a),n}function updateSum(e,a){var t=e.columns(23).data().eq(0).reduce(function(e,a){return(e||0)+(a||0)},0),i="原售价："+t,c=e.columns(25).data().eq(0).reduce(function(e,a){return(e||0)+(a||0)},0);i+=" 规则分："+c;var r=e.columns(26).data().eq(0).reduce(function(e,a){return(e||0)+(a||0)},0);if(i+=" 总得分："+r,a.find(".chk-cal-results-show-total-time").prop("checked")){var l=e.columns(27).data().eq(0).reduce(function(e,a){return(e||0)+(a||0)},0);i+=" 总时间："+secondsToTime(l||0)}a.find(".selected-sum").html(i)}function generateData(e,a,t){var i=new Object;a&&(e.equips=e.equips.concat(a.equips),e.quests=e.quests.concat(a.quests),e.recipes=e.recipes.concat(a.recipes),e.chefs=e.chefs.concat(a.chefs),e.skills=e.skills.concat(a.skills),e.ultimateGoals=e.ultimateGoals.concat(a.ultimateGoals),e.rules=e.rules.concat(a.rules)),i.guests=e.guests,i.history=e.history,i.skills=e.skills,i.rules=e.rules,i.decorationEffect=0,t&&t.decorationEffect&&(i.decorationEffect=t.decorationEffect);var c=new Array;for(var r in e.materials){var l=e.materials[r];l.rarityDisp=getRarityDisp(e.materials[r].rarity),l.originVal=getOriginVal(e.materials[r].origin),l.addition="",l.quantity="",c.push(l)}i.materials=c;var s=new Array;for(var r in e.equips)if(e.equips[r].name){var n=e.equips[r];n.rarityDisp=getRarityDisp(e.equips[r].rarity);var o=getSkillInfo(e.skills,e.equips[r].skill);n.skillDisp=o.skillDisp,n.effect=o.skillEffect,s.push(n)}i.equips=s;var p=new Array;for(var r in e.quests)if(e.quests[r].goal){var d=e.quests[r],u="",h="";for(var f in e.quests[r].rewards)u+=e.quests[r].rewards[f].name,e.quests[r].rewards[f].quantity&&(u+="*"+e.quests[r].rewards[f].quantity),u+=" ",h+=e.quests[r].rewards[f].name;d.rewardsVal=h,d.rewardsDisp=u,p.push(d)}i.quests=p;var k=$("#chk-chef-apply-equips").prop("checked"),m=$("#chk-chef-apply-ultimate").prop("checked"),b=$("#chk-chef-apply-ultimate-person").prop("checked"),v=getUltimateData(e.chefs,t,e.skills,m,b,!0),g=new Array;for(var r in e.chefs)if(e.chefs[r].name){var y=e.chefs[r];y.gender=getGender(e.chefs[r]),y.meat=e.chefs[r].meat||"",y.creation=e.chefs[r].creation||"",y.veg=e.chefs[r].veg||"",y.fish=e.chefs[r].fish||"",y.addition="",y.chefIdDisp=e.chefs[r].chefId-2+" - "+e.chefs[r].chefId,y.rarityDisp=getRarityDisp(e.chefs[r].rarity);var o=getSkillInfo(e.skills,e.chefs[r].skill);y.specialSkillDisp=o.skillDisp,y.specialSkillEffect=o.skillEffect,a&&(y.tagsDisp=getTagsDisp(e.chefs[r].tags,a.tags));var w="",D="";if(e.chefs[r].rarity<5||private){for(var f in e.chefs[r].ultimateGoal){var T=!1;for(var q in e.ultimateGoals)if(e.chefs[r].ultimateGoal[f]==e.ultimateGoals[q].goalId){w+=e.ultimateGoals[q].goal+"<br>",T=!0;break}T||console.log(e.chefs[r].ultimateGoal[f])}var x=getSkillInfo(e.skills,e.chefs[r].ultimateSkill);D=x.skillDisp}if(y.ultimateGoal=w,y.ultimateSkillDisp=D,y.got="",y.ultimate="",y.equip=null,y.equipName="",y.equipDisp="",t)for(var f in t.chefs)if(e.chefs[r].chefId==t.chefs[f].id){if(t.chefs[f].hasOwnProperty("got")&&(y.got=t.chefs[f].got),t.chefs[f].hasOwnProperty("ult")&&(y.ultimate=t.chefs[f].ult),t.chefs[f].hasOwnProperty("equip"))for(var q in s)if(t.chefs[f].equip==s[q].equipId){y.equip=s[q],y.equipName=s[q].name,y.equipDisp=s[q].name+"<br><small>"+s[q].skillDisp+"</small>";break}break}setDataForChef(y,v,k),g.push(y)}i.chefs=g;var C=new Array;for(var r in e.recipes)if(e.recipes[r].name&&(e.recipes[r].origin||cal)){var E=new Object;if(E=e.recipes[r],E.stirfry=e.recipes[r].stirfry||"",E.boil=e.recipes[r].boil||"",E.knife=e.recipes[r].knife||"",E.fry=e.recipes[r].fry||"",E.bake=e.recipes[r].bake||"",E.steam=e.recipes[r].steam||"",E.addition="",E.skillDisp=getSkillDisp(e.recipes[r]),E.timeDisp=secondsToTime(e.recipes[r].time),E.rarityDisp=getRarityDisp(e.recipes[r].rarity),E.tags=[],E.tagsDisp="",a)for(var f in a.recipesTags)if(a.recipesTags[f].recipeId==e.recipes[r].recipeId){E.tags=a.recipesTags[f].tags,E.tagsDisp=getTagsDisp(a.recipesTags[f].tags,a.tags);break}if(setDataForRecipe(E,v),E.rank="",E.got="",t)for(var f in t.recipes)if(e.recipes[r].recipeId==t.recipes[f].id){t.recipes[f].hasOwnProperty("rank")&&(E.rank=t.recipes[f].rank),
t.recipes[f].hasOwnProperty("got")&&(E.got=t.recipes[f].got);break}E.efficiency=Math.floor(3600*e.recipes[r].price/e.recipes[r].time);var O=getMaterialsInfo(e.recipes[r],e.materials);E.materialsVal=O.materialsVal,E.materialsDisp=O.materialsDisp,E.veg=O.veg,E.meat=O.meat,E.creation=O.creation,E.fish=O.fish;var R=0;e.recipes[r].time>0&&(R=3600*O.materialsCount/e.recipes[r].time),E.allMaterialsEff=R?Math.floor(R):"";var I=getRankGuestInfo(e.recipes[r],E.rank);E.rankGuestsVal=I.rankGuestsVal,E.rankGuestsDisp=I.rankGuestsDisp;var S="";for(var N in e.guests)for(var _ in e.guests[N].gifts)if(e.recipes[r].name==e.guests[N].gifts[_].recipe){S+=e.guests[N].name+"-"+e.guests[N].gifts[_].antique+"<br>";break}E.guestsDisp=S,C.push(E)}return i.recipes=C,i}function updateRecipeChefTable(e){$(".loading").removeClass("hidden"),setTimeout(function(){e=getUpdateData(e),$("#recipe-table").DataTable().clear().rows.add(e.recipes).draw(!1),$("#chef-table").DataTable().clear().rows.add(e.chefs).draw(!1),$(".loading").addClass("hidden")},500),$("#btn-chef-recal").removeClass("btn-danger").addClass("btn-default")}function getUpdateData(e){var a;try{var t=localStorage.getItem("data");a=JSON.parse(t)}catch(e){}var i=$("#chk-chef-apply-equips").prop("checked"),c=$("#chk-chef-apply-ultimate").prop("checked"),r=$("#chk-chef-apply-ultimate-person").prop("checked"),l=getUltimateData(e.chefs,a,e.skills,c,r,!0);for(var s in e.chefs)setDataForChef(e.chefs[s],l,i);for(var s in e.recipes)setDataForRecipe(e.recipes[s],l);return updateRecipesChefsData(e),updateChefsRecipesData(e),e}function getQuestsData(e,a){var t=new Array;for(var i in e)e[i].type==a&&t.push(e[i]);return t}function getMaterialsInfo(e,a){var t=new Object,i="",c="",r=0,l=!1,s=!1,n=!1,o=!1;for(var p in e.materials)for(var d in a)if(e.materials[p].material==a[d].materialId){i+=a[d].name+"*"+e.materials[p].quantity+" ",c+=a[d].name,r+=e.materials[p].quantity,e.materials[p].origin=a[d].origin,"菜棚"==a[d].origin||"菜地"==a[d].origin||"森林"==a[d].origin?l=!0:"鸡舍"==a[d].origin||"猪圈"==a[d].origin||"牧场"==a[d].origin?s=!0:"作坊"==a[d].origin?n=!0:"鱼塘"==a[d].origin&&(o=!0);break}return t.materialsDisp=i,t.materialsVal=c,t.materialsCount=r,t.veg=l,t.meat=s,t.creation=n,t.fish=o,t}function getRarityDisp(e){for(var a="",t=0;t<e;t++)a+="&#x2605;";return a}function getTagsDisp(e,a){var t="";for(var i in e)for(var c in a)if(e[i]==a[c].Id){t+=a[c].name+" ";break}return t}function getOriginVal(e){var a=0;return"菜棚"==e?a=1:"菜地"==e?a=2:"森林"==e?a=3:"鸡舍"==e?a=4:"猪圈"==e?a=5:"牧场"==e?a=6:"作坊"==e?a=7:"鱼塘"==e&&(a=8),a}function getRankGuestInfo(e,a){var t="",i="",c=$("#chk-recipe-filter-guest").prop("checked");for(var r in e.guests)if(!c||!("优"==a&&0==r||"特"==a&&2!=r||"神"==a)){var l="";0==r?l="优":1==r?l="特":2==r&&(l="神"),t+=l+"-"+e.guests[r].guest+"<br>",i+=e.guests[r].guest}var s=new Object;return s.rankGuestsVal=i,s.rankGuestsDisp=t,s}function getUltimateData(e,a,t,i,c,r){var l=new Array;if(i)for(var s in e)if(e[s].ultimateSkill){var n=!1;if(c){if(a)for(var o in a.chefs)if(e[s].chefId==a.chefs[o].id&&"是"==a.chefs[o].ult){n=!0;break}}else(r||e[s].origin&&e[s].rarity<5)&&(n=!0);if(n)for(var p in t)if(e[s].ultimateSkill==t[p].skillId){for(var d in t[p].effect){var u=!1;for(var h in l)if(l[h].type==t[p].effect[d].type){l[h].addition=l[h].addition.add(t[p].effect[d].addition),u=!0;break}if(!u){var f=new Object;f.type=t[p].effect[d].type,f.addition=t[p].effect[d].addition,l.push(f)}}break}}return l}function setDataForChef(e,a,t){var i=0,c=0,r=0,l=0,s=0,n=0;for(var o in a)a[o].type.indexOf("全体厨师炒技法")>=0?i+=a[o].addition:a[o].type.indexOf("全体厨师烤技法")>=0?c+=a[o].addition:a[o].type.indexOf("全体厨师蒸技法")>=0?r+=a[o].addition:a[o].type.indexOf("全体厨师煮技法")>=0?l+=a[o].addition:a[o].type.indexOf("全体厨师炸技法")>=0?s+=a[o].addition:a[o].type.indexOf("全体厨师切技法")>=0?n+=a[o].addition:a[o].type.indexOf("全体厨师全技法")>=0?(i+=a[o].addition,c+=a[o].addition,r+=a[o].addition,l+=a[o].addition,s+=a[o].addition,n+=a[o].addition):a[o].type.indexOf("全体男厨师全技法")>=0?e.tags.indexOf(340001)>=0&&(i+=a[o].addition,c+=a[o].addition,r+=a[o].addition,l+=a[o].addition,s+=a[o].addition,n+=a[o].addition):a[o].type.indexOf("全体女厨师全技法")>=0&&e.tags.indexOf(340002)>=0&&(i+=a[o].addition,c+=a[o].addition,r+=a[o].addition,l+=a[o].addition,s+=a[o].addition,n+=a[o].addition);e.stirfryUltimateAddition=i,e.boilUltimateAddition=l,e.knifeUltimateAddition=n,e.fryUltimateAddition=s,e.bakeUltimateAddition=c,e.steamUltimateAddition=r;var p=null;t&&(p=e.equip),setDataForChef2(e,p)}function setDataForRecipe(e,a){e.limitVal=e.limit,e.ultimateAddition=0;for(var t in a)(a[t].type.indexOf("1星菜谱上限")>=0&&1==e.rarity||a[t].type.indexOf("2星菜谱上限")>=0&&2==e.rarity||a[t].type.indexOf("3星菜谱上限")>=0&&3==e.rarity||a[t].type.indexOf("4星菜谱上限")>=0&&4==e.rarity||a[t].type.indexOf("5星菜谱上限")>=0&&5==e.rarity)&&(e.limitVal+=a[t].addition),(a[t].type.indexOf("1星菜谱售价")>=0&&1==e.rarity||a[t].type.indexOf("2星菜谱售价")>=0&&2==e.rarity||a[t].type.indexOf("3星菜谱售价")>=0&&3==e.rarity||a[t].type.indexOf("4星菜谱售价")>=0&&4==e.rarity||a[t].type.indexOf("5星菜谱售价")>=0&&5==e.rarity)&&(e.ultimateAddition=e.ultimateAddition.add(a[t].addition));e.ultimateAdditionDisp=getAdditionDisp(e.ultimateAddition),e.totalPrice=e.price*e.limitVal,e.totalTime=e.time*e.limitVal,e.totalTimeDisp=secondsToTime(e.totalTime)}function getRankOptions(){var e=new Array,a=new Object;return a.display="",a.value="",e.push(a),a=new Object,a.display="优",a.value="优",e.push(a),a=new Object,a.display="特",a.value="特",e.push(a),a=new Object,a.display="神",a.value="神",e.push(a),e}function getGotOptions(){var e=new Array,a=new Object;return a.display="否",a.value="",e.push(a),a=new Object,a.display="是",a.value="是",e.push(a),e}function getEquipsOptions(e,a){var t=new Array,i=new Object;i.display="无厨具",i.subtext="",i.tokens="",i.value="",i.class="hidden",t.push(i);for(var c in e){var r=getSkillInfo(a,e[c].skill),l=r.skillDisp.replace(/<br>/g," "),i=new Object;i.display=e[c].name,i.subtext=l,i.tokens=e[c].name+l,i.value=e[c].name,t.push(i)}return t}function getChefsOptions(e){var a=new Array,t=new Object;t.display="无厨师",t.value="",t.class="hidden",a.push(t);for(var i in e){var t=new Object;t.display=e[i].name,t.value=e[i].name,a.push(t)}return a}function getSkillInfo(e,a){var t=new Object,i="",c=new Array,r=[];a.constructor===Array?r=a:a&&r.push(a);for(var l in r){var s=!1;for(var n in e)if(e[n].skillId==r[l]){for(var o in e[n].effect){var p=e[n].effect[o].type,d=e[n].effect[o].addition;i+=p,p.indexOf("稀有客人出现概率")>=0?(d>0&&(i+="+"),i+=getAdditionDisp(d)+"<br>"):(isNaN(d)?i+=d:d&&(d>0&&(i+="+"),i+=isInt(d)?d:getAdditionDisp(d)),i+="<br>"),c.push(e[n].effect[o])}s=!0;break}s||console.log(r[l])}return t.skillDisp=i,t.skillEffect=c,t}function getSkillDisp(e){var a="";return e.stirfry&&(a+="炒"+e.stirfry),e.boil&&(a+="煮"+e.boil),e.knife&&(a+="切"+e.knife),e.fry&&(a+="炸"+e.fry),e.bake&&(a+="烤"+e.bake),e.steam&&(a+="蒸"+e.steam),a}function getGender(e){return e.tags.indexOf(340001)>=0?"男":e.tags.indexOf(340002)>=0?"女":""}function initRecipeShow(){var e=$("#recipe-table").DataTable();e.column(0).visible($("#chk-recipe-show-id").prop("checked"),!1),e.column(2).visible($("#chk-recipe-show-rarity").prop("checked"),!1);var a=$("#chk-recipe-show-skill").prop("checked");e.column(3).visible(a,!1),e.column(4).visible(a,!1),e.column(5).visible(a,!1),e.column(6).visible(a,!1),e.column(7).visible(a,!1),e.column(8).visible(a,!1),e.column(9).visible($("#chk-recipe-show-materials").prop("checked"),!1),e.column(10).visible($("#chk-recipe-show-price").prop("checked"),!1),e.column(11).visible($("#chk-recipe-show-time").prop("checked"),!1),e.column(12).visible($("#chk-recipe-show-limit").prop("checked"),!1),e.column(13).visible($("#chk-recipe-show-total-price").prop("checked"),!1),e.column(14).visible($("#chk-recipe-show-total-time").prop("checked"),!1),e.column(15).visible($("#chk-recipe-show-efficiency").prop("checked"),!1),e.column(16).visible($("#chk-recipe-show-materials-efficiency").prop("checked"),!1),e.column(17).visible($("#chk-recipe-show-origin").prop("checked"),!1),e.column(18).visible($("#chk-recipe-show-unlock").prop("checked"),!1),cal?e.column(19).visible($("#chk-recipe-show-tags").prop("checked"),!1):e.column(19).visible(!1,!1),e.column(20).visible($("#chk-recipe-show-guest").prop("checked"),!1),e.column(21).visible($("#chk-recipe-show-rank-guest").prop("checked"),!1),e.column(22).visible($("#chk-recipe-show-rank-antique").prop("checked"),!1),e.column(23).visible($("#chk-recipe-show-rank").prop("checked"),!1),e.column(24).visible($("#chk-recipe-show-got").prop("checked"),!1),e.columns.adjust().draw(!1)}function initChefShow(){var e=$("#chef-table").DataTable();e.column(0).visible($("#chk-chef-show-id").prop("checked"),!1),e.column(2).visible($("#chk-chef-show-rarity").prop("checked"),!1);var a=$("#chk-chef-show-skill").prop("checked");e.column(3).visible(a,!1),e.column(4).visible(a,!1),e.column(5).visible(a,!1),e.column(6).visible(a,!1),e.column(7).visible(a,!1),e.column(8).visible(a,!1),e.column(9).visible($("#chk-chef-show-chef-skill").prop("checked"),!1);var t=$("#chk-chef-show-explore").prop("checked");e.column(10).visible(t,!1),e.column(11).visible(t,!1),e.column(12).visible(t,!1),e.column(13).visible(t,!1),e.column(14).visible($("#chk-chef-show-gender").prop("checked"),!1),e.column(15).visible($("#chk-chef-show-origin").prop("checked"),!1),cal?e.column(16).visible($("#chk-chef-show-tags").prop("checked"),!1):e.column(16).visible(!1,!1),e.column(17).visible($("#chk-chef-show-equip").prop("checked"),!1),e.column(18).visible($("#chk-chef-show-ultimate-goal").prop("checked"),!1),e.column(19).visible($("#chk-chef-show-ultimate-skill").prop("checked"),!1),e.column(20).visible($("#chk-chef-show-ultimate").prop("checked"),!1),e.column(21).visible($("#chk-chef-show-got").prop("checked"),!1),e.columns.adjust().draw(!1)}function initEquipShow(e){e.column(0).visible($("#chk-equip-show-id").prop("checked"),!1),e.column(2).visible($("#chk-equip-show-rarity").prop("checked"),!1),e.column(3).visible($("#chk-equip-show-skill").prop("checked"),!1),e.column(4).visible($("#chk-equip-show-origin").prop("checked"),!1),e.columns.adjust().draw(!1)}function initCalRecipesShow(e){e.column(1).visible($("#chk-cal-recipes-show-id").prop("checked"),!1),e.column(3).visible($("#chk-cal-recipes-show-rarity").prop("checked"),!1);var a=$("#chk-cal-recipes-show-skill").prop("checked");e.column(4).visible(a,!1),e.column(5).visible(a,!1),e.column(6).visible(a,!1),e.column(7).visible(a,!1),e.column(8).visible(a,!1),e.column(9).visible(a,!1),e.column(10).visible($("#chk-cal-recipes-show-material").prop("checked"),!1),e.column(11).visible($("#chk-cal-recipes-show-price").prop("checked"),!1),e.column(12).visible($("#chk-cal-recipes-show-limit").prop("checked"),!1),e.column(13).visible($("#chk-cal-recipes-show-total-price").prop("checked"),!1),e.column(14).visible($("#chk-cal-recipes-show-origin").prop("checked"),!1),e.column(15).visible($("#chk-cal-recipes-show-tags").prop("checked"),!1),e.columns.adjust().draw(!1)}function initCalChefsShow(e){e.column(1).visible($("#chk-cal-chefs-show-id").prop("checked"),!1),e.column(3).visible($("#chk-cal-chefs-show-rarity").prop("checked"),!1);var a=$("#chk-cal-chefs-show-skill").prop("checked");e.column(4).visible(a,!1),e.column(5).visible(a,!1),e.column(6).visible(a,!1),e.column(7).visible(a,!1),e.column(8).visible(a,!1),e.column(9).visible(a,!1),e.column(10).visible($("#chk-cal-chefs-show-chef-skill").prop("checked"),!1),e.column(11).visible($("#chk-cal-chefs-show-gender").prop("checked"),!1),e.column(12).visible($("#chk-cal-chefs-show-origin").prop("checked"),!1),e.column(13).visible($("#chk-cal-chefs-show-tags").prop("checked"),!1),e.columns.adjust().draw(!1)}function initCalEquipsShow(e){e.column(1).visible($("#chk-cal-equips-show-id").prop("checked"),!1),e.column(3).visible($("#chk-cal-equips-show-rarity").prop("checked"),!1),e.column(4).visible($("#chk-cal-equips-show-skill").prop("checked"),!1),e.column(5).visible($("#chk-cal-equips-show-origin").prop("checked"),!1),e.columns.adjust().draw(!1)}function initCalMaterialsShow(e){e.column(1).visible($("#chk-cal-materials-show-id").prop("checked"),!1),e.column(3).visible($("#chk-cal-materials-show-rarity").prop("checked"),!1),e.column(4).visible($("#chk-cal-materials-show-origin").prop("checked"),!1),e.columns.adjust().draw(!1)}function initCalResultsShow(e,a,t){a.column(0).visible(!1,!1),"recipes"==e?(t.find(".chk-cal-results-show-recipe-rank").prop("checked",!1).closest(".btn").addClass("hidden"),t.find(".chk-cal-results-show-recipe-rank-addition").prop("checked",!1).closest(".btn").addClass("hidden"),t.find(".chk-cal-results-show-chef-skill-addition").prop("checked",!1).closest(".btn").addClass("hidden"),t.find(".chk-cal-results-show-chef-equip-addition").prop("checked",!1).closest(".btn").addClass("hidden"),t.find(".chk-cal-results-show-recipe-real-total-price").prop("checked",!1).closest(".btn").addClass("hidden"),a.column(1).visible(!1,!1),a.column(2).visible(!1,!1),a.column(12).visible(!1,!1),a.column(13).visible(!1,!1)):"optimal"==e&&(a.column(13).visible(!1,!1),a.column(14).visible(!1,!1));var i=t.find(".chk-cal-results-show-recipe-skill").prop("checked");a.column(4).visible(i,!1),a.column(5).visible(i,!1),a.column(6).visible(i,!1),a.column(7).visible(i,!1),a.column(8).visible(i,!1),a.column(9).visible(i,!1),a.column(10).visible(t.find(".chk-cal-results-show-recipe-material").prop("checked"),!1),a.column(11).visible(t.find(".chk-cal-results-show-recipe-origin").prop("checked"),!1),a.column(15).visible(t.find(".chk-cal-results-show-recipe-price").prop("checked"),!1),a.column(16).visible(t.find(".chk-cal-results-show-recipe-rank").prop("checked"),!1),a.column(17).visible(t.find(".chk-cal-results-show-recipe-rank-addition").prop("checked"),!1),a.column(18).visible(t.find(".chk-cal-results-show-chef-skill-addition").prop("checked"),!1),a.column(19).visible(t.find(".chk-cal-results-show-chef-equip-addition").prop("checked"),!1),a.column(20).visible(t.find(".chk-cal-results-show-bonus-addition").prop("checked"),!1),a.column(21).visible(t.find(".chk-cal-results-show-ultimate-addition").prop("checked"),!1),a.column(22).visible(t.find(".chk-cal-results-show-decoration-addition").prop("checked"),!1),a.column(23).visible(t.find(".chk-cal-results-show-recipe-total-price").prop("checked"),!1),a.column(24).visible(t.find(".chk-cal-results-show-recipe-real-total-price").prop("checked"),!1),a.column(25).visible(t.find(".chk-cal-results-show-bonus-score").prop("checked"),!1),a.column(27).visible(t.find(".chk-cal-results-show-total-time").prop("checked"),!1),a.columns.adjust().draw(!1)}function initInfo(e){$("#pagination-history").pagination({dataSource:e.history,callback:function(e,a){var t=historyTemplate(e);$("#data-history").html(t)},pageSize:10,showPageNumbers:!1,showNavigator:!0,showPrevious:!0,showNext:!0})}function historyTemplate(e){var a="";return $.each(e,function(e,t){a+="<p>"+t+"</p>"}),a}function getInputHtml(e,a,t){var i,c,r;switch(r={type:"input",html:null,settings:null},a.inputTypes&&$.each(a.inputTypes,function(a,t){t.column==e&&(i=t,c=i.type.toLowerCase())}),r.settings=i,c){case"list":var l="data-live-search='false'";i.search&&(l="data-live-search='true'"),r.html="<select "+l+" data-width='fit' data-dropdown-align-right='auto' data-live-search-placeholder='查找' data-none-results-text='没有找到' data-none-selected-text=''>",$.each(i.options,function(e,a){r.html=r.html+"<option value='"+a.value+"'",a.tokens&&(r.html+=" data-tokens='"+a.tokens+"'"),a.subtext&&(r.html+=" data-subtext='"+a.subtext+"'"),a.class&&(r.html+=" class='"+a.class+"'"),t==a.value&&(r.html+=" selected"),r.html+=">"+a.display+"</option>"}),r.html=r.html+"</select>",r.type=c;break;default:r.html="<input class='form-control' value='"+t+"'></input>"}return r}function sanitizeCellValue(e){return"undefined"==typeof e||null===e||e.length<1?"":(isNaN(e)&&(e=e.replace(/'/g,"&#39;")),e)}function getParameterByName(e,a){a||(a=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),i=t.exec(a);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}function UpdateQueryString(e,a,t){t||(t=window.location.href);var i,c=new RegExp("([?&])"+e+"=.*?(&|#|$)(.*)","gi");if(c.test(t))return"undefined"!=typeof a&&null!==a?t.replace(c,"$1"+e+"="+a+"$2$3"):(i=t.split("#"),t=i[0].replace(c,"$1$3").replace(/(&|\?)$/,""),"undefined"!=typeof i[1]&&null!==i[1]&&(t+="#"+i[1]),t);if("undefined"!=typeof a&&null!==a){var r=t.indexOf("?")!==-1?"&":"?";return i=t.split("#"),t=i[0]+r+e+"="+a,"undefined"!=typeof i[1]&&null!==i[1]&&(t+="#"+i[1]),t}return t}$(function(){$.ajax({cache:!1,success:function(e){init(e)},url:"data/data.json"})});var private=!1,cal=!1,currentRule;$.fn.dataTable.Api.register("MakeCellsEditable()",function(e){var a=this.table();$.fn.extend({updateEditableCell:function(e,a){var t=$(e).closest("table").DataTable().table(),i=t.row($(e).parents("tr")),c=t.cell($(e).closest("td")),r=$(e),l=c.data(),s=r.val();c.data(s),a.onUpdate&&a.onUpdate(t,i,c,l)}}),"destroy"===e&&($(a.body()).removeClass("processing"),$(a.body()).off("click","td"),a=null),null!=a&&$(a.body()).on("click","td",function(){if(!$(a.body()).hasClass("processing")){var t=a.cell(this).index().column;if(e.columns&&e.columns.indexOf(t)>-1||!e.columns){var i=a.cell(this).node(),c=a.cell(this).data();if(c=sanitizeCellValue(c),!$(i).find("input").length&&!$(i).find("select").length){e.waitUpdate&&$(a.body()).addClass("processing");var r=getInputHtml(t,e,c);$(i).html(r.html),"input"==r.type?$(i).find("input").select().focus().on("focusout",function(){$(this).updateEditableCell(this,e)}):"list"==r.type&&($(i).find("select").selectpicker("hide").on("hidden.bs.select",function(a){$(this).updateEditableCell(this,e)}),setTimeout(function(){$(i).find("select").selectpicker("toggle").selectpicker("show")},0),r.settings.clear&&($("<div class='bs-actionsbox'><div class='btn-group btn-group-sm btn-block'><button type='button' class='btn btn-default btn-bs-clear'>清空</button></div></div>").insertBefore($(i).find("ul.dropdown-menu")),$(i).find(".btn-bs-clear").click(function(){$(i).find("select").selectpicker("val",""),$(i).find("select").selectpicker("hide"),$(this).updateEditableCell(this,e)})))}}}})});